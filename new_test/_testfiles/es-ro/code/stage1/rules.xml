<?xml version="1.0" encoding="UTF-8"?>
<!-- -*- nxml -*- -->
<transfer default="chunk">
  <section-def-cats>

    <def-cat n="nom">
      <cat-item tags="n.*"/>
      <cat-item tags="np.al.*"/>
      <cat-item tags="np.loc.*"/>
    </def-cat>

    <def-cat n="ant">
      <cat-item tags="np.ant.*"/>
    </def-cat>

    <def-cat n="loc">
      <cat-item tags="np.loc.*"/>
    </def-cat>

    <def-cat n="adj">
      <cat-item tags="adj.*"/>
      <cat-item tags="adj.pos.*"/>
    </def-cat>

    <def-cat n="adjec">
      <cat-item tags="adj.*"/>
      <cat-item tags="adj.pos.*"/>
      <cat-item tags="vblex.pp.*"/>
      <cat-item tags="vbmod.pp.*"/>
      <cat-item tags="vbhaver.pp.*"/>
      <cat-item tags="vbser.pp.*"/>
    </def-cat>

    <def-cat n="detnodef">
      <cat-item tags="det.dem.*"/>
      <cat-item tags="det.ind.*"/>
      <cat-item tags="det.pos.*"/>
      <cat-item tags="predet.*"/>
    </def-cat>

    <def-cat n="det">
      <cat-item tags="det.dem.*"/>
      <cat-item tags="det.def.*"/>
      <cat-item tags="det.ind.*"/>
      <cat-item tags="det.pos.*"/>
      <cat-item tags="predet.*"/>
    </def-cat>



    <def-cat n="detdef">
      <cat-item tags="det.def.*"/>
    </def-cat>


    <def-cat n="percent">
      <cat-item tags="num.percent"/>
    </def-cat>

    <def-cat n="num">
      <cat-item tags="num.*"/>
      <cat-item tags="num"/>
    </def-cat>

    <def-cat n="numeral">
      <cat-item tags="num.*"/>
    </def-cat>

    <def-cat n="cifra">
      <cat-item tags="num"/>
    </def-cat>

    <def-cat n="prep">
      <cat-item tags="pr"/>
    </def-cat>

    <def-cat n="prnperssubj"><!-- pronoms personals-->
      <cat-item lemma="yo" tags="prn.*"/>
      <cat-item lemma="tú" tags="prn.*"/>
      <cat-item lemma="él" tags="prn.*"/>
      <cat-item lemma="nosotros" tags="prn.*"/>
      <cat-item lemma="vosotros" tags="prn.*"/>
    </def-cat>

    <def-cat n="prnsubj"><!-- prn no personals que poden ser subjecte-->
      <cat-item tags="prn.tn.*"/>
      <cat-item lemma="quién" tags="prn.itg.*"/>
      <cat-item lemma="que" tags="prn.itg.*"/>
      <cat-item lemma="el cual" tags="prn.itg.*"/>
    </def-cat>

    <def-cat n="prnitg">
      <cat-item tags="prn.itg.*"/>
    </def-cat>

    <def-cat n="rel">
      <cat-item tags="prn.rel.*"/>
      <cat-item tags="rel.*"/>
    </def-cat>

    <def-cat n="prnenc">
      <cat-item tags="prn.enc.*"/>
    </def-cat>

    <def-cat n="prnpro">
      <cat-item tags="prn.pro.*"/>
    </def-cat>

    <def-cat n="ser">
      <cat-item tags="vbser.prs.*"/>
      <cat-item tags="vbser.fts.*"/>
      <cat-item tags="vbser.pis.*"/>
      <cat-item tags="vbser.pii.*"/>
      <cat-item tags="vbser.ifi.*"/>
      <cat-item tags="vbser.imp.*"/>
      <cat-item tags="vbser.fti.*"/>
      <cat-item tags="vbser.cni.*"/>
      <cat-item tags="vbser.pri.*"/>
    </def-cat>

    <def-cat n="aux">
<!--verbs que fan d'aux seguits de pp-->
      <cat-item tags="vbhaver.*"/>
    </def-cat>

    <def-cat n="imp">
      <cat-item tags="vblex.imp.*"/>
      <cat-item tags="vbser.imp.*"/>
      <cat-item tags="vbhaver.imp.*"/>
      <cat-item tags="vbmod.imp.*"/>
    </def-cat>

    <def-cat n="ger">
      <cat-item tags="vblex.ger"/>
      <cat-item tags="vbser.ger"/>
      <cat-item tags="vbhaver.ger"/>
      <cat-item tags="vbmod.ger"/>
    </def-cat>

    <def-cat n="verbm">
<!--verb modal -->
      <cat-item tags="vbmod.*"/>
    </def-cat>

    <def-cat n="verbm_inf_ger">
<!--verb modal, infinitiu o gerundi -->
      <cat-item tags="vbmod.inf"/>
      <cat-item tags="vbmod.ger"/>
    </def-cat>

    <def-cat n="irpres">
      <cat-item lemma="ir" tags="vblex.pri.*"/>
    </def-cat>

    <def-cat n="haver">
      <cat-item tags="vbhaver.*"/>
    </def-cat>

    <def-cat n="estar">
      <cat-item lemma="estar" tags="vblex.*"/>
    </def-cat>

    <def-cat n="tener">
      <cat-item lemma="tener" tags="vblex.*"/>
      <cat-item lemma="tener" tags="vbmod.*"/>
    </def-cat>

    <def-cat n="verbpers">
      <cat-item tags="vblex.cni.*"/>
      <cat-item tags="vblex.fti.*"/>
      <cat-item tags="vblex.ifi.*"/>
      <cat-item tags="vblex.imp.*"/>
      <cat-item tags="vblex.pii.*"/>
      <cat-item tags="vblex.pis.*"/>
      <cat-item tags="vblex.pri.*"/>
      <cat-item tags="vblex.prs.*"/>
      <cat-item tags="vblex.fts.*"/>
      <cat-item tags="vbser.cni.*"/>
      <cat-item tags="vbser.fti.*"/>
      <cat-item tags="vbser.ifi.*"/>
      <cat-item tags="vbser.imp.*"/>
      <cat-item tags="vbser.pii.*"/>
      <cat-item tags="vbser.pis.*"/>
      <cat-item tags="vbser.pri.*"/>
      <cat-item tags="vbser.prs.*"/>
      <cat-item tags="vbser.fts.*"/>
      <cat-item tags="vbhaver.cni.*"/>
      <cat-item tags="vbhaver.fti.*"/>
      <cat-item tags="vbhaver.ifi.*"/>
      <cat-item tags="vbhaver.imp.*"/>
      <cat-item tags="vbhaver.pii.*"/>
      <cat-item tags="vbhaver.pis.*"/>
      <cat-item tags="vbhaver.pri.*"/>
      <cat-item tags="vbhaver.prs.*"/>
      <cat-item tags="vbhaver.fts.*"/>
      <cat-item tags="vbmod.cni.*"/>
      <cat-item tags="vbmod.fti.*"/>
      <cat-item tags="vbmod.ifi.*"/>
      <cat-item tags="vbmod.imp.*"/>
      <cat-item tags="vbmod.pii.*"/>
      <cat-item tags="vbmod.pis.*"/>
      <cat-item tags="vbmod.pri.*"/>
      <cat-item tags="vbmod.prs.*"/>
      <cat-item tags="vbmod.fts.*"/>
      <cat-item tags="vblex.pron.cni.*"/>
      <cat-item tags="vblex.pron.fti.*"/>
      <cat-item tags="vblex.pron.ifi.*"/>
      <cat-item tags="vblex.pron.imp.*"/>
      <cat-item tags="vblex.pron.pii.*"/>
      <cat-item tags="vblex.pron.pis.*"/>
      <cat-item tags="vblex.pron.pri.*"/>
      <cat-item tags="vblex.pron.prs.*"/>
    </def-cat>

    <def-cat n="auxpers">
      <cat-item tags="vbser.cni.*"/>
      <cat-item tags="vbser.fti.*"/>
      <cat-item tags="vbser.ifi.*"/>
      <cat-item tags="vbser.imp.*"/>
      <cat-item tags="vbser.pii.*"/>
      <cat-item tags="vbser.pis.*"/>
      <cat-item tags="vbser.pri.*"/>
      <cat-item tags="vbser.prs.*"/>
      <cat-item tags="vbhaver.cni.*"/>
      <cat-item tags="vbhaver.fti.*"/>
      <cat-item tags="vbhaver.ifi.*"/>
      <cat-item tags="vbhaver.imp.*"/>
      <cat-item tags="vbhaver.pii.*"/>
      <cat-item tags="vbhaver.pis.*"/>
      <cat-item tags="vbhaver.pri.*"/>
      <cat-item tags="vbhaver.prs.*"/>
    </def-cat>

    <def-cat n="auxinf">
<!--       <cat-item tags="vbser.inf"/> -->
      <cat-item tags="vbhaver.inf"/>
    </def-cat>

    <def-cat n="pp">
      <cat-item tags="vblex.pp.*"/>
      <cat-item tags="vbser.pp.*"/>
      <cat-item tags="vbmod.pp.*"/>
      <cat-item tags="vbhaver.pp.*"/>
<!--ATENCIÓ CANVI -->
    </def-cat>

    <def-cat n="inf">
      <cat-item tags="vblex.inf"/>
      <cat-item tags="vblex.pron.inf"/>
      <cat-item tags="vbser.inf"/>
      <cat-item tags="vbhaver.inf"/>
      <cat-item tags="vbmod.inf"/>
    </def-cat>

    <def-cat n="adv_preadv">
      <cat-item tags="adv"/>
      <cat-item tags="preadv"/>
    </def-cat>

    <def-cat n="adv">
      <cat-item tags="adv"/>
    </def-cat>

    <def-cat n="advitg">
      <cat-item tags="adv.itg"/>
    </def-cat>

    <def-cat n="no">
      <cat-item lemma="no" tags="adv"/>
    </def-cat>

    <def-cat n="cnjcoo">
      <cat-item lemma="y" tags="cnjcoo"/>
      <cat-item lemma="o" tags="cnjcoo"/>
      <cat-item lemma="pero" tags="cnjcoo"/>
    </def-cat>

    <def-cat n="cnj">
      <cat-item tags="cnjcoo"/>
      <cat-item tags="cnjsub"/>
      <cat-item tags="cnjadv"/>
    </def-cat>

    <def-cat n="como">
      <cat-item lemma="como" tags="adv"/>
    </def-cat>

    <def-cat n="por">
      <cat-item lemma="por" tags="pr"/>
    </def-cat>

    <def-cat n="a">
      <cat-item lemma="a" tags="pr"/>
    </def-cat>

    <def-cat n="de">
      <cat-item lemma="de" tags="pr"/>
    </def-cat>

    <def-cat n="cada">
      <cat-item lemma="cada" tags="det.ind.mf.sg"/>
    </def-cat>

    <def-cat n="todo">
      <cat-item lemma="todo" tags="predet.*"/>
    </def-cat>

    <def-cat n="que">
      <cat-item lemma="que" tags="cnjsub"/>
    </def-cat>


    <def-cat n="sent">
      <cat-item tags="sent"/>
    </def-cat>

    <def-cat n="coma">
      <cat-item tags="cm"/>
    </def-cat>

    <def-cat n="lquest">
      <cat-item tags="lquest"/>
    </def-cat>

  </section-def-cats>
  <section-def-attrs>
    <def-attr n="a_nom">
      <attr-item tags="n"/>
      <attr-item tags="n.acr"/>
      <attr-item tags="np.ant"/>
      <attr-item tags="np.al"/>
    </def-attr>

    <def-attr n="a_np_acr">
      <attr-item tags="np"/>
      <attr-item tags="acr"/>
    </def-attr>

    <def-attr n="a_adj">
      <attr-item tags="adj"/>
      <attr-item tags="adj.sint"/>
      <attr-item tags="adj.sint.comp"/>
      <attr-item tags="adj.sint.sup"/>
      <attr-item tags="adj.pos"/>
      <attr-item tags="adj.itg"/>
      <attr-item tags="adj.ind"/>
      <attr-item tags="vblex.pp"/>
      <attr-item tags="vbmod.pp"/>
      <attr-item tags="vbhaver.pp"/>
      <attr-item tags="vbser.pp"/>
    </def-attr>

    <def-attr n="a_det">
      <attr-item tags="det.dem"/>
      <attr-item tags="det.ind"/>
      <attr-item tags="det.def"/>
      <attr-item tags="det.pos"/>
      <attr-item tags="det.qnt"/>
      <attr-item tags="det.itg"/>
      <attr-item tags="det.ord"/>
      <attr-item tags="predet"/>
      <attr-item tags="predet.def"/>
      <attr-item tags="num"/>
    </def-attr>

    <def-attr n="a_num">
      <attr-item tags="num"/>
      <attr-item tags="num.percent"/>
    </def-attr>

    <def-attr n="a_verb">
      <attr-item tags="vblex"/>
      <attr-item tags="vbser"/>
      <attr-item tags="vbhaver"/>
      <attr-item tags="vbmod"/>
      <attr-item tags="vaux"/>
    </def-attr>

    <def-attr n="pron">
      <attr-item tags="pron"/>
    </def-attr>

    <def-attr n="sep">
      <attr-item tags="sep"/>
    </def-attr>

    <def-attr n="a_adv">
      <attr-item tags="adv"/>
      <attr-item tags="preadv"/>
      <attr-item tags="adv.itg"/>
    </def-attr>

    <def-attr n="a_pp">
      <attr-item tags="vblex.pp"/>
      <attr-item tags="vbser.pp"/>
      <attr-item tags="vbmod.pp"/>
      <attr-item tags="vblex.sep.pp"/>
      <attr-item tags="vbser.sep.pp"/>
      <attr-item tags="vbmod.sep.pp"/>
      <attr-item tags="vaux.pp"/>
      <attr-item tags="vbhaver.pp"/>
    </def-attr>

    <def-attr n="a_prn">
      <attr-item tags="prn"/>
    </def-attr>

    <def-attr n="a_rel">
      <attr-item tags="rel"/>
      <attr-item tags="rel.aa"/>
      <attr-item tags="rel.an"/>
      <attr-item tags="rel.nn"/>
      <attr-item tags="rel.adv"/>
    </def-attr>

    <def-attr n="tipus_prn">
      <attr-item tags="subj"/>
      <attr-item tags="rel"/>
      <attr-item tags="rel.adv"/>
      <attr-item tags="rel.nn"/>
      <attr-item tags="obj"/>
      <attr-item tags="tn"/>
      <attr-item tags="tn.ref"/>
      <attr-item tags="itg"/>
      <attr-item tags="pos"/>
      <attr-item tags="ref"/>
      <attr-item tags="enc"/>
      <attr-item tags="enc.ref"/>
      <attr-item tags="pro"/>
      <attr-item tags="tn.pos"/>
    </def-attr>

    <def-attr n="tipoenc_pro">
      <attr-item tags="ref"/>
<!--
      <attr-item tags="ref.p3.mf.sp"/>
      <attr-item tags="p1.mf.pl"/>
      <attr-item tags="p1.mf.sg"/>
      <attr-item tags="p2.mf.pl"/>
      <attr-item tags="p2.mf.sg"/>
      <attr-item tags="p3.f.pl"/>
      <attr-item tags="p3.f.sg"/>
      <attr-item tags="p3.mf.pl"/>
      <attr-item tags="p3.mf.sg"/>
      <attr-item tags="p3.m.pl"/>
      <attr-item tags="p3.m.sg"/>
      <attr-item tags="p3.nt"/>
      <attr-item tags="mf.sg"/>
      <attr-item tags="adv"/>
-->
    </def-attr>

    <def-attr n="pers">
      <attr-item tags="p1"/>
      <attr-item tags="p2"/>
      <attr-item tags="p3"/>
    </def-attr>

    <def-attr n="gen">
      <attr-item tags="m"/>
      <attr-item tags="f"/>
      <attr-item tags="mf"/>
      <attr-item tags="mn"/>
      <attr-item tags="fn"/>
      <attr-item tags="mfn"/>
      <attr-item tags="nt"/>
      <attr-item tags="GD"/>
    </def-attr>

    <def-attr n="gen_sense_mf">
      <attr-item tags="m"/>
      <attr-item tags="f"/>
      <attr-item tags="GD"/>
      <attr-item tags="nt"/>
    </def-attr>

    <def-attr n="gen_mf">
      <attr-item tags="mf"/>
    </def-attr>

    <def-attr n="nbr">
      <attr-item tags="sg"/>
      <attr-item tags="pl"/>
      <attr-item tags="sp"/>
      <attr-item tags="ND"/>
    </def-attr>


    <def-attr n="nbr_sense_sp">
      <attr-item tags="sg"/>
      <attr-item tags="pl"/>
      <attr-item tags="ND"/>
    </def-attr>

    <def-attr n="nbr_sp">
      <attr-item tags="sp"/>
    </def-attr>

    <def-attr n="temps">
      <attr-item tags="cni"/>
      <attr-item tags="fts"/>
      <attr-item tags="fti"/>
      <attr-item tags="ifi"/>
      <attr-item tags="imp"/>
      <attr-item tags="pii"/>
      <attr-item tags="pis"/>
      <attr-item tags="pri"/>
      <attr-item tags="prs"/>
      <attr-item tags="pp"/><!-- ? -->
      <attr-item tags="ger"/><!-- ? -->
      <attr-item tags="inf"/><!-- ? -->
    </def-attr>

    <def-attr n="neg">
      <attr-item tags="NEG"/>
    </def-attr>

  </section-def-attrs>
  <section-def-vars>
    <def-var n="nbr_pp"/>
    <def-var n="gen_pp"/>
    <def-var n="etiq_aux"/>
    <def-var n="etiq_det"/>
    <def-var n="concorden"/>
    <def-var n="numero" v="&lt;sg&gt;"/>
    <def-var n="genero" v="&lt;m&gt;"/>
    <def-var n="caso" v="&lt;nom&gt;"/>

    <def-var n="numero_pp" v="&lt;sg&gt;"/>
    <def-var n="genero_pp" v="&lt;m&gt;"/>

    <def-var n="concDet"/>
    <def-var n="concAdj"/>
    <def-var n="concPrimero"/>
    <def-var n="concSegundo"/>
    <def-var n="concTercero"/>
    <def-var n="interrogativa"/>
    <def-var n="exclamativa"/>
    <def-var n="caseFirstWord"/>
    <def-var n="lema"/>
    <def-var n="EOS" v="true"/>
    <def-var n="paraula1"/>
    <def-var n="SVnegatiu"/>
    <def-var n="auxiliar"/>
    <def-var n="verbfinal"/>
    <def-var n="prepfinal"/>
    <def-var n="temps_chunk"/>
    <def-var n="lema_SV"/>
  </section-def-vars>

  <section-def-lists>

    <def-list n="lista">
      <list-item v="xxx"/>
    </def-list>

    <def-list n="verbs_dg">
      <list-item v="da"/>
      <list-item v="oferi"/>
      <list-item v="spune"/>
      <list-item v="explica"/>
      <list-item v="permiti"/>
    </def-list>


    <def-list n="verbs_mov">
      <list-item v="acercar"/>
      <list-item v="bajar"/>
      <list-item v="caminar"/>
      <list-item v="correr"/>
      <list-item v="dirigir"/>
      <list-item v="emigrar"/>
      <list-item v="entrar"/>
      <list-item v="inmigrar"/>
      <list-item v="llegar"/>
      <list-item v="llevar"/>
      <list-item v="marchar"/>
      <list-item v="mover"/>
      <list-item v="pasar"/>
      <list-item v="regresar"/>
      <list-item v="salir"/>
      <list-item v="subir"/>
      <list-item v="trasladar"/>
      <list-item v="venir"/>
      <list-item v="viajar"/>
      <list-item v="volver"/>
      <list-item v="ir"/>
    </def-list>


  </section-def-lists>

  <section-def-macros>

    <def-macro n="set-case-prep1" npar="1">
      <choose>
        <when>
          <test>
            <in caseless="yes">
              <clip pos="1" side="tl" part="lemh"/>
              <list n="verbs_dg"/>
            </in>
          </test>
          <let>
            <var n="caso"/>
            <lit-tag v="dg"/>
          </let>
        </when>
        <when>
          <test>
            <in caseless="yes">
              <clip pos="1" side="sl" part="lemh"/>
              <list n="verbs_mov"/>
            </in>
          </test>
          <let>
            <var n="prepfinal"/>
            <concat>
              <lit v="la"/>
              <lit-tag v="pr"/>
            </concat>
          </let>
        </when>
        <otherwise>
          <let>
            <var n="caso"/>
            <lit-tag v="nom"/>
          </let>
          <let>
            <var n="prepfinal"/>
            <concat>
              <lit v="pe"/>
              <lit-tag v="pr"/>
            </concat>
          </let>
        </otherwise>
      </choose>
    </def-macro>

 <def-macro n="firstWord" npar="1">
      <let>
        <var n="caseFirstWord" />
        <case-of pos="1" side="sl" part="lem" />
      </let>
      <choose>
        <when>
          <test>
            <equal>
              <case-of pos="1" side="sl" part="lem" />
              <lit v="Aa" />
            </equal>
          </test>
          <choose>
            <when>
              <test>
                <and>
                  <equal>
                    <clip pos="1" side="sl" part="a_np_acr" />
                    <lit v="" />
                  </equal>
                  <equal>
                    <clip pos="1" side="sl" part="a_num" />
                    <lit v="" />
                  </equal>
                </and>
              </test>
              <modify-case>
                <clip pos="1" side="tl" part="lem"/>
                <lit v="aa"/>
              </modify-case>
            </when>
          </choose>
        </when>
        <when>
          <test>
            <equal>
              <case-of pos="1" side="sl" part="lem" />
              <lit v="AA" />
            </equal>
          </test>
          <choose>
            <when>
              <test> <and>
                <equal>
                  <clip pos="1" side="tl" part="a_np_acr" />
                  <lit v="" />
                </equal>
                <equal>
                  <clip pos="1" side="sl" part="a_num" />
                  <lit v="" />
                </equal>
              </and> </test> 
              <choose>
                <when>
                  <test>
                    <equal>
                      <var n="EOS" />
                      <lit v="true" />
                    </equal>
                  </test>
                  <let>
                    <var n="caseFirstWord" />
                    <lit v="Aa" />
                  </let>
                </when>
              </choose>
            </when>
          </choose>
        </when>
      </choose>
      <let>
	<var n="EOS"/>
	<lit v="false"/>
      </let>
    </def-macro>
    

<!--

    <def-macro n="firstWord" npar="1">
      <choose>
        <when>
          <test>
            <equal>
              <clip pos="1" side="sl" part="a_np_acr"/>
              <lit v=""/>
            </equal>
          </test>
          <choose>
            <when>
              <test>
                <equal>
                  <var n="EOS"/>
                  <lit v="true"/>
                </equal>
              </test>
              <modify-case>
                <clip pos="1" side="tl" part="lem"/>
                <lit v="aa"/>
              </modify-case>
              <let>
                <var n="caseFirstWord"/>
                <lit v="Aa"/>
              </let>
            </when>
          </choose>
        </when>
        <otherwise>
          <let>
            <var n="caseFirstWord"/>
            <lit v="aa"/>
          </let>
        </otherwise>
      </choose>
      <let>
        <var n="EOS"/>
        <lit v="false"/>
      </let>
    </def-macro>-->

    <def-macro n="f_bcond" npar="2">
<!--Per mirar si el blanc conté o no format. Cal posar aquesta funció en les regles en què desaparegui alguna paraula, per tal de decidir si el blanc de la paraula eliminada s'ha d'eliminar o conservar. Si conté format cal conservar-la, si no en conté cal eliminar-la perquè no apareguin dos espais seguits. -->
      <choose>
        <when>
          <test>
            <not>
              <equal>
                <b pos="1"/>
                <lit v=" "/>
              </equal>
            </not>
          </test>
          <out>
            <b pos="1"/>
          </out>
        </when>
      </choose>
    </def-macro>


  <def-macro n="mod-gen" npar="1">
           <choose>
	     <when>
               <test>
               <and>
                 <or>
                 <equal>
                   <clip pos="1" side="tl" part="gen"/>
                   <lit-tag v="f"/>
                 </equal>
                 <equal>
                   <clip pos="1" side="tl" part="gen"/>
                   <lit-tag v="nt"/>
                 </equal>
		  </or>                 
                 <equal>
                   <clip pos="1" side="tl" part="nbr"/>
                   <lit-tag v="pl"/>
                 </equal>
               </and>
              </test>
               <let>
               <clip pos="1" side="tl" part="gen"/>
               <lit-tag v="fn"/>
               </let>
	     </when>
	     <when>
               <test>
               <and>
		<or>
                 <equal>
                   <clip pos="1" side="tl" part="gen"/>
                   <lit-tag v="m"/>
                 </equal>
                 <equal>
                   <clip pos="1" side="tl" part="gen"/>
                   <lit-tag v="nt"/>
                 </equal>
		</or>                 
                 <equal>
                   <clip pos="1" side="tl" part="nbr"/>
                   <lit-tag v="sg"/>
                 </equal>
               </and>
              </test>
               <let>
               <clip pos="1" side="tl" part="gen"/>
               <lit-tag v="mn"/>
               </let>
	     </when>
	     <when>
               <test>
                 <equal>
                   <clip pos="1" side="tl" part="gen"/>
                   <lit-tag v="mf"/>
                 </equal>                 
              </test>
               <let>
               <clip pos="1" side="tl" part="gen"/>
               <lit-tag v="mfn"/>
               </let>
	     </when>
	     </choose>
  </def-macro>

  <def-macro n="mod-gen-pp" npar="1">
           <choose>
	     <when>
               <test>
               <and>
                 <or>
                 <equal>
                   <var n="genero_pp"/>
                   <lit-tag v="f"/>
                 </equal>
                 <equal>
                   <var n="genero_pp"/>
                   <lit-tag v="nt"/>
                 </equal>
		  </or>                 
                 <equal>
                   <var n="numero_pp"/>
                   <lit-tag v="pl"/>
                 </equal>
               </and>
              </test>
               <let>
               <var n="genero_pp"/>
               <lit-tag v="fn"/>
               </let>
	     </when>
	     <when>
               <test>
               <and>
		<or>
                 <equal>
                   <var n="genero_pp"/>
                   <lit-tag v="m"/>
                 </equal>
                 <equal>
                   <var n="genero_pp"/>
                   <lit-tag v="nt"/>
                 </equal>
		</or>                 
                 <equal>
                   <var n="numero_pp"/>
                   <lit-tag v="sg"/>
                 </equal>
               </and>
              </test>
               <let>
               <var n="genero_pp"/>
               <lit-tag v="mn"/>
               </let>
	     </when>
	     <when>
               <test>
                 <equal>
                   <var n="genero_pp"/>
                   <lit-tag v="mf"/>
                 </equal>                 
              </test>
               <let>
               <var n="genero_pp"/>
               <lit-tag v="mfn"/>
               </let>
	     </when>
	     </choose>
  </def-macro>


    <def-macro n="f_concord1" npar="1">
      <choose>
<!--To determine value of variables of gender and
                 number and propagate to other rules.  Variables are
                 not used again in this rule -->
        <when>
          <test>
            <equal>
              <clip pos="1" side="tl" part="gen"/>
              <lit-tag v="m"/>
            </equal>
          </test>
          <let>
            <var n="genero"/>
            <lit-tag v="m"/>
          </let>
        </when>
        <when>
          <test>
            <equal>
              <clip pos="1" side="tl" part="gen"/>
              <lit-tag v="f"/>
            </equal>
          </test>
          <let>
            <var n="genero"/>
            <lit-tag v="f"/>
          </let>
        </when>
        <when>
          <test>
            <equal>
              <clip pos="1" side="tl" part="gen"/>
              <lit-tag v="nt"/>
            </equal>
          </test>
          <let>
            <var n="genero"/>
            <lit-tag v="nt"/>
          </let>
        </when>
      </choose>
      <choose>
        <when>
          <test>
            <equal>
              <clip pos="1" side="tl" part="nbr"/>
              <lit-tag v="sg"/>
            </equal>
          </test>
          <let>
            <var n="numero"/>
            <lit-tag v="sg"/>
          </let>
        </when>
        <when>
          <test>
            <equal>
              <clip pos="1" side="tl" part="nbr"/>
              <lit-tag v="pl"/>
            </equal>
          </test>
          <let>
            <var n="numero"/>
            <lit-tag v="pl"/>
          </let>
        </when>
      </choose>
      <choose>
        <when>
          <test>
<!-- If word has GD or ND, we try to assign the
              gender or number of the previous rule. If there is no
              value for the gender or number variable from previous
              rules, gender will be masculine and number singular.-->
            <equal>
              <clip pos="1" side="tl" part="gen"/>
              <lit-tag v="GD"/>
            </equal>
          </test>
          <choose>
            <when>
              <test>
                <equal>
                  <var n="genero"/>
                  <lit-tag v="f"/>
                </equal>
              </test>
              <let>
                <clip pos="1" side="tl" part="gen"/>
                <lit-tag v="f"/>
              </let>
            </when>
            <when>
              <test>
                <equal>
                  <var n="genero"/>
                  <lit-tag v="m"/>
                </equal>
              </test>
              <let>
                <clip pos="1" side="tl" part="gen"/>
                <lit-tag v="m"/>
              </let>
            </when>
            <otherwise>
              <let>
                <clip pos="1" side="tl" part="gen"/>
                <lit-tag v="nt"/>
              </let>
            </otherwise>
          </choose>
        </when>
      </choose>
      <choose>
        <when>
          <test>
            <equal>
              <clip pos="1" side="tl" part="nbr"/>
              <lit-tag v="ND"/>
            </equal>
          </test>
          <choose>
            <when>
              <test>
                <equal>
                  <var n="numero"/>
                  <lit-tag v="pl"/>
                </equal>
              </test>
              <let>
                <clip pos="1" side="tl" part="nbr"/>
                <lit-tag v="pl"/>
              </let>
            </when>
            <otherwise>
              <let>
                <clip pos="1" side="tl" part="nbr"/>
                <lit-tag v="sg"/>
              </let>
            </otherwise>
          </choose>
        </when>
      </choose>
    </def-macro>


    <def-macro n="f_concord2" npar="2">
      <choose>
        <when>
          <test>
<!-- do the main and second parameter gender agree?-->
            <and>
              <or>
                <equal>
                  <clip pos="2" side="sl" part="gen"/>
                  <clip pos="1" side="sl" part="gen"/>
                </equal>
                <equal>
                  <clip pos="2" side="sl" part="gen"/>
                  <lit-tag v="mf"/>
                </equal>
                <equal>
                  <clip pos="1" side="sl" part="gen"/>
                  <lit-tag v="mf"/>
                </equal>
              </or>
              <or>
                <equal>
<!-- do the main and second parameter number agree?-->
                  <clip pos="2" side="sl" part="nbr"/>
                  <clip pos="1" side="sl" part="nbr"/>
                </equal>
                <equal>
                  <clip pos="2" side="sl" part="nbr"/>
                  <lit-tag v="sp"/>
                </equal>
                <equal>
                  <clip pos="1" side="sl" part="nbr"/>
                  <lit-tag v="sp"/>
                </equal>
              </or>
            </and>
          </test>
          <let>
            <var n="concPrimero"/>
            <lit v="true"/>
          </let>
<!-- there is gender and number agreement-->
        </when>
        <otherwise>
          <let>
            <var n="concPrimero"/>
            <lit v="false"/>
          </let>
<!-- there isn't gender and number agreement-->
        </otherwise>
      </choose>
      <choose>
        <when>
          <test>
<!-- Propagate the main parameter gender if it has been modified during the translation  -->
            <and>
              <not>
                <equal>
                  <clip pos="1" side="tl" part="gen"/>
                  <clip pos="1" side="sl" part="gen"/>
                </equal>
              </not>
              <not>
                <equal>
                  <clip pos="1" side="tl" part="gen"/>
                  <lit-tag v="mf"/>
                </equal>
              </not>
              <not>
                <equal>
                  <clip pos="1" side="tl" part="gen"/>
                  <lit-tag v="GD"/>
                </equal>
              </not>
            </and>
          </test>
          <choose>
            <when>
              <test>
                <and>
                  <not>
                    <equal>
                      <clip pos="2" side="tl" part="gen"/>
                      <lit-tag v="mf"/>
                    </equal>
                  </not>
                  <not>
                    <and>
                      <equal>
                        <clip pos="2" side="sl" part="gen"/>
                        <lit-tag v="mf"/>
                      </equal>
                      <not>
                        <equal>
                          <clip pos="2" side="tl" part="gen"/>
                          <lit-tag v="GD"/>
                        </equal>
                      </not>
                    </and>
                  </not>
                  <equal>
                    <var n="concPrimero"/>
                    <lit v="true"/>
                  </equal>
                </and>
              </test>
              <let>
                <clip pos="2" side="tl" part="gen"/>
                <clip pos="1" side="tl" part="gen"/>
              </let>
            </when>
          </choose>
        </when>
      </choose>
      <choose>
        <when>
          <test>
<!-- Propagate the main parameter number if it has been modified during the translation  -->
            <and>
              <not>
                <equal>
                  <clip pos="1" side="tl" part="nbr"/>
                  <clip pos="1" side="sl" part="nbr"/>
                </equal>
              </not>
              <not>
                <equal>
                  <clip pos="1" side="tl" part="nbr"/>
                  <lit-tag v="sp"/>
                </equal>
              </not>
              <not>
                <equal>
                  <clip pos="1" side="tl" part="nbr"/>
                  <lit-tag v="ND"/>
                </equal>
              </not>
            </and>
          </test>
          <choose>
            <when>
              <test>
                <and>
                  <not>
                    <equal>
                      <clip pos="2" side="tl" part="nbr"/>
                      <lit-tag v="sp"/>
                    </equal>
                  </not>
                  <not>
                    <and>
                      <equal>
                        <clip pos="2" side="sl" part="nbr"/>
                        <lit-tag v="sp"/>
                      </equal>
                      <not>
                        <equal>
                          <clip pos="2" side="tl" part="nbr"/>
                          <lit-tag v="ND"/>
                        </equal>
                      </not>
                    </and>
                  </not>
                  <equal>
                    <var n="concPrimero"/>
                    <lit v="true"/>
                  </equal>
                </and>
              </test>
              <let>
                <clip pos="2" side="tl" part="nbr"/>
                <clip pos="1" side="tl" part="nbr"/>
              </let>
            </when>
          </choose>
        </when>
      </choose>
      <choose>
        <when>
          <test>
<!-- Which is the rule general gender? -->
            <equal>
              <clip pos="1" side="tl" part="gen"/>
              <lit-tag v="m"/>
            </equal>
          </test>
          <let>
            <var n="genero"/>
            <lit-tag v="m"/>
          </let>
        </when>
        <when>
          <test>
            <equal>
              <clip pos="1" side="tl" part="gen"/>
              <lit-tag v="f"/>
            </equal>
          </test>
          <let>
            <var n="genero"/>
            <lit-tag v="f"/>
          </let>
        </when>
        <when>
          <test>
            <equal>
              <clip pos="2" side="tl" part="gen"/>
              <lit-tag v="m"/>
            </equal>
          </test>
          <let>
            <var n="genero"/>
            <lit-tag v="m"/>
          </let>
        </when>
        <when>
          <test>
            <equal>
              <clip pos="2" side="tl" part="gen"/>
              <lit-tag v="f"/>
            </equal>
          </test>
          <let>
            <var n="genero"/>
            <lit-tag v="f"/>
          </let>
        </when>
        <when>
          <test>
            <and>
              <equal>
                <clip pos="1" side="tl" part="gen"/>
                <lit-tag v="mf"/>
              </equal>
              <not>
                <equal>
                  <clip pos="1" side="sl" part="gen"/>
                  <lit-tag v="mf"/>
                </equal>
              </not>
            </and>
          </test>
          <let>
            <var n="genero"/>
            <clip pos="1" side="sl" part="gen"/>
          </let>
        </when>
        <when>
          <test>
            <and>
              <equal>
                <clip pos="2" side="tl" part="gen"/>
                <lit-tag v="mf"/>
              </equal>
              <not>
                <equal>
                  <clip pos="2" side="sl" part="gen"/>
                  <lit-tag v="mf"/>
                </equal>
              </not>
            </and>
          </test>
          <let>
            <var n="genero"/>
            <clip pos="2" side="sl" part="gen"/>
          </let>
        </when>
        <otherwise>
          <let>
            <var n="genero"/>
            <lit-tag v="m"/>
          </let>
        </otherwise>
      </choose>
      <choose>
        <when>
<!-- Which is the rule general number? -->
          <test>
            <equal>
              <clip pos="1" side="tl" part="nbr"/>
              <lit-tag v="sg"/>
            </equal>
          </test>
          <let>
            <var n="numero"/>
            <lit-tag v="sg"/>
          </let>
        </when>
        <when>
          <test>
            <equal>
              <clip pos="1" side="tl" part="nbr"/>
              <lit-tag v="pl"/>
            </equal>
          </test>
          <let>
            <var n="numero"/>
            <lit-tag v="pl"/>
          </let>
        </when>
        <when>
          <test>
            <equal>
              <clip pos="2" side="tl" part="nbr"/>
              <lit-tag v="sg"/>
            </equal>
          </test>
          <let>
            <var n="numero"/>
            <lit-tag v="sg"/>
          </let>
        </when>
        <when>
          <test>
            <equal>
              <clip pos="2" side="tl" part="nbr"/>
              <lit-tag v="pl"/>
            </equal>
          </test>
          <let>
            <var n="numero"/>
            <lit-tag v="pl"/>
          </let>
        </when>
        <when>
          <test>
            <and>
              <equal>
                <clip pos="1" side="tl" part="nbr"/>
                <lit-tag v="sp"/>
              </equal>
              <not>
                <equal>
                  <clip pos="1" side="sl" part="nbr"/>
                  <lit-tag v="sp"/>
                </equal>
              </not>
            </and>
          </test>
          <let>
            <var n="numero"/>
            <clip pos="1" side="sl" part="nbr"/>
          </let>
        </when>
        <when>
          <test>
            <and>
              <equal>
                <clip pos="2" side="tl" part="nbr"/>
                <lit-tag v="sp"/>
              </equal>
              <not>
                <equal>
                  <clip pos="2" side="sl" part="nbr"/>
                  <lit-tag v="sp"/>
                </equal>
              </not>
            </and>
          </test>
          <let>
            <var n="numero"/>
            <clip pos="2" side="sl" part="nbr"/>
          </let>
        </when>
        <otherwise>
          <let>
            <var n="numero"/>
            <lit-tag v="sg"/>
          </let>
        </otherwise>
      </choose>
      <choose>
<!-- Determine gender and number value if they are undetermined -->
        <when>
          <test>
            <equal>
              <clip pos="1" side="tl" part="gen"/>
              <lit-tag v="GD"/>
            </equal>
          </test>
          <let>
            <clip pos="1" side="tl" part="gen"/>
            <var n="genero"/>
          </let>
        </when>
      </choose>
      <choose>
        <when>
          <test>
            <equal>
              <clip pos="2" side="tl" part="gen"/>
              <lit-tag v="GD"/>
            </equal>
          </test>
          <let>
            <clip pos="2" side="tl" part="gen"/>
            <var n="genero"/>
          </let>
        </when>
      </choose>
      <choose>
        <when>
          <test>
            <equal>
              <clip pos="1" side="tl" part="nbr"/>
              <lit-tag v="ND"/>
            </equal>
          </test>
          <let>
            <clip pos="1" side="tl" part="nbr"/>
            <var n="numero"/>
          </let>
        </when>
      </choose>
      <choose>
        <when>
          <test>
            <equal>
              <clip pos="2" side="tl" part="nbr"/>
              <lit-tag v="ND"/>
            </equal>
          </test>
          <let>
            <clip pos="2" side="tl" part="nbr"/>
            <var n="numero"/>
          </let>
        </when>
      </choose>
    </def-macro>


    <def-macro n="f_concord3" npar="3">
      <choose>
<!-- Look if in source language there is concordance between first and second element -->
        <when>
          <test>
            <and>
              <or>
                <equal>
                  <clip pos="2" side="sl" part="gen"/>
                  <clip pos="1" side="sl" part="gen"/>
                </equal>
                <equal>
                  <clip pos="2" side="sl" part="gen"/>
                  <lit-tag v="mf"/>
                </equal>
                <equal>
                  <clip pos="1" side="sl" part="gen"/>
                  <lit-tag v="mf"/>
                </equal>
              </or>
              <or>
                <equal>
                  <clip pos="2" side="sl" part="nbr"/>
                  <clip pos="1" side="sl" part="nbr"/>
                </equal>
                <equal>
                  <clip pos="2" side="sl" part="nbr"/>
                  <lit-tag v="sp"/>
                </equal>
                <equal>
                  <clip pos="1" side="sl" part="nbr"/>
                  <lit-tag v="sp"/>
                </equal>
              </or>
            </and>
          </test>
          <let>
            <var n="concPrimero"/>
            <lit v="true"/>
          </let>
        </when>
        <otherwise>
          <let>
            <var n="concPrimero"/>
            <lit v="false"/>
          </let>
        </otherwise>
      </choose>
      <choose>
<!-- Look if in source language there is concordance between second and third element -->
        <when>
          <test>
            <and>
              <or>
                <equal>
                  <clip pos="3" side="sl" part="gen"/>
                  <clip pos="1" side="sl" part="gen"/>
                </equal>
                <equal>
                  <clip pos="3" side="sl" part="gen"/>
                  <lit-tag v="mf"/>
                </equal>
                <equal>
                  <clip pos="1" side="sl" part="gen"/>
                  <lit-tag v="mf"/>
                </equal>
              </or>
              <or>
                <equal>
                  <clip pos="3" side="sl" part="nbr"/>
                  <clip pos="1" side="sl" part="nbr"/>
                </equal>
                <equal>
                  <clip pos="3" side="sl" part="nbr"/>
                  <lit-tag v="sp"/>
                </equal>
                <equal>
                  <clip pos="1" side="sl" part="nbr"/>
                  <lit-tag v="sp"/>
                </equal>
              </or>
            </and>
          </test>
          <let>
            <var n="concSegundo"/>
            <lit v="true"/>
          </let>
        </when>
        <otherwise>
          <let>
            <var n="concSegundo"/>
            <lit v="false"/>
          </let>
        </otherwise>
      </choose>
      <choose>
<!-- Propagate the main parameter gender if it has been modified during the translation -->
        <when>
          <test>
            <and>
              <not>
                <equal>
                  <clip pos="1" side="tl" part="gen"/>
                  <clip pos="1" side="sl" part="gen"/>
                </equal>
              </not>
              <not>
                <equal>
                  <clip pos="1" side="tl" part="gen"/>
                  <lit-tag v="mf"/>
                </equal>
              </not>
              <not>
                <equal>
                  <clip pos="1" side="tl" part="gen"/>
                  <lit-tag v="GD"/>
                </equal>
              </not>
            </and>
          </test>
          <choose>
            <when>
              <test>
                <and>
                  <not>
                    <equal>
                      <clip pos="2" side="tl" part="gen"/>
                      <lit-tag v="mf"/>
                    </equal>
                  </not>
                  <not>
                    <and>
                      <equal>
                        <clip pos="2" side="sl" part="gen"/>
                        <lit-tag v="mf"/>
                      </equal>
                      <not>
                        <equal>
                          <clip pos="2" side="tl" part="gen"/>
                          <lit-tag v="GD"/>
                        </equal>
                      </not>
                    </and>
                  </not>
                  <equal>
                    <var n="concPrimero"/>
                    <lit v="true"/>
                  </equal>
                </and>
              </test>
              <let>
                <clip pos="2" side="tl" part="gen"/>
                <clip pos="1" side="tl" part="gen"/>
              </let>
            </when>
          </choose>
          <choose>
            <when>
              <test>
                <and>
                  <not>
                    <equal>
                      <clip pos="3" side="tl" part="gen"/>
                      <lit-tag v="mf"/>
                    </equal>
                  </not>
                  <not>
                    <and>
                      <equal>
                        <clip pos="3" side="sl" part="gen"/>
                        <lit-tag v="mf"/>
                      </equal>
                      <not>
                        <equal>
                          <clip pos="3" side="tl" part="gen"/>
                          <lit-tag v="GD"/>
                        </equal>
                      </not>
                    </and>
                  </not>
                  <equal>
                    <var n="concSegundo"/>
                    <lit v="true"/>
                  </equal>
                </and>
              </test>
              <let>
                <clip pos="3" side="tl" part="gen"/>
                <clip pos="1" side="tl" part="gen"/>
              </let>
            </when>
          </choose>
        </when>
      </choose>
      <choose>
<!-- Propagate the main parameter number if it has been modified during the translation -->
        <when>
          <test>
            <and>
              <not>
                <equal>
                  <clip pos="1" side="tl" part="nbr"/>
                  <clip pos="1" side="sl" part="nbr"/>
                </equal>
              </not>
              <not>
                <equal>
                  <clip pos="1" side="tl" part="nbr"/>
                  <lit-tag v="sp"/>
                </equal>
              </not>
              <not>
                <equal>
                  <clip pos="1" side="tl" part="nbr"/>
                  <lit-tag v="ND"/>
                </equal>
              </not>
            </and>
          </test>
          <choose>
            <when>
              <test>
                <and>
                  <not>
                    <equal>
                      <clip pos="2" side="tl" part="nbr"/>
                      <lit-tag v="sp"/>
                    </equal>
                  </not>
                  <not>
                    <and>
                      <equal>
                        <clip pos="2" side="sl" part="nbr"/>
                        <lit-tag v="sp"/>
                      </equal>
                      <not>
                        <equal>
                          <clip pos="2" side="tl" part="nbr"/>
                          <lit-tag v="ND"/>
                        </equal>
                      </not>
                    </and>
                  </not>
                  <equal>
                    <var n="concPrimero"/>
                    <lit v="true"/>
                  </equal>
                </and>
              </test>
              <let>
                <clip pos="2" side="tl" part="nbr"/>
                <clip pos="1" side="tl" part="nbr"/>
              </let>
            </when>
          </choose>
          <choose>
            <when>
              <test>
                <and>
                  <not>
                    <equal>
                      <clip pos="3" side="tl" part="nbr"/>
                      <lit-tag v="sp"/>
                    </equal>
                  </not>
                  <not>
                    <and>
                      <equal>
                        <clip pos="3" side="sl" part="nbr"/>
                        <lit-tag v="sp"/>
                      </equal>
                      <not>
                        <equal>
                          <clip pos="3" side="tl" part="nbr"/>
                          <lit-tag v="ND"/>
                        </equal>
                      </not>
                    </and>
                  </not>
                  <equal>
                    <var n="concSegundo"/>
                    <lit v="true"/>
                  </equal>
                </and>
              </test>
              <let>
                <clip pos="3" side="tl" part="nbr"/>
                <clip pos="1" side="tl" part="nbr"/>
              </let>
            </when>
          </choose>
        </when>
      </choose>
      <choose>
<!-- Determine the rule general gender. Priority order: main, second and third element -->
        <when>
          <test>
            <equal>
              <clip pos="1" side="tl" part="gen"/>
              <lit-tag v="m"/>
            </equal>
          </test>
          <let>
            <var n="genero"/>
            <lit-tag v="m"/>
          </let>
        </when>
        <when>
          <test>
            <equal>
              <clip pos="1" side="tl" part="gen"/>
              <lit-tag v="f"/>
            </equal>
          </test>
          <let>
            <var n="genero"/>
            <lit-tag v="f"/>
          </let>
        </when>
        <when>
          <test>
            <equal>
              <clip pos="2" side="tl" part="gen"/>
              <lit-tag v="m"/>
            </equal>
          </test>
          <let>
            <var n="genero"/>
            <lit-tag v="m"/>
          </let>
        </when>
        <when>
          <test>
            <equal>
              <clip pos="2" side="tl" part="gen"/>
              <lit-tag v="f"/>
            </equal>
          </test>
          <let>
            <var n="genero"/>
            <lit-tag v="f"/>
          </let>
        </when>
        <when>
          <test>
            <equal>
              <clip pos="3" side="tl" part="gen"/>
              <lit-tag v="m"/>
            </equal>
          </test>
          <let>
            <var n="genero"/>
            <lit-tag v="m"/>
          </let>
        </when>
        <when>
          <test>
            <equal>
              <clip pos="3" side="tl" part="gen"/>
              <lit-tag v="f"/>
            </equal>
          </test>
          <let>
            <var n="genero"/>
            <lit-tag v="f"/>
          </let>
        </when>
        <when>
          <test>
            <and>
              <equal>
                <clip pos="1" side="tl" part="gen"/>
                <lit-tag v="mf"/>
              </equal>
              <not>
                <equal>
                  <clip pos="1" side="sl" part="gen"/>
                  <lit-tag v="mf"/>
                </equal>
              </not>
            </and>
          </test>
          <let>
            <var n="genero"/>
            <clip pos="1" side="sl" part="gen"/>
          </let>
        </when>
        <when>
          <test>
            <and>
              <equal>
                <clip pos="2" side="tl" part="gen"/>
                <lit-tag v="mf"/>
              </equal>
              <not>
                <equal>
                  <clip pos="2" side="sl" part="gen"/>
                  <lit-tag v="mf"/>
                </equal>
              </not>
            </and>
          </test>
          <let>
            <var n="genero"/>
            <clip pos="2" side="sl" part="gen"/>
          </let>
        </when>
        <when>
          <test>
            <and>
              <equal>
                <clip pos="3" side="tl" part="gen"/>
                <lit-tag v="mf"/>
              </equal>
              <not>
                <equal>
                  <clip pos="3" side="sl" part="gen"/>
                  <lit-tag v="mf"/>
                </equal>
              </not>
            </and>
          </test>
          <let>
            <var n="genero"/>
            <clip pos="3" side="sl" part="gen"/>
          </let>
        </when>
        <otherwise>
          <let>
            <var n="genero"/>
            <lit-tag v="m"/>
          </let>
        </otherwise>
      </choose>
      <choose>
<!-- Determine the rule general number. Priority order: main, second and third element -->
        <when>
          <test>
            <equal>
              <clip pos="1" side="tl" part="nbr"/>
              <lit-tag v="sg"/>
            </equal>
          </test>
          <let>
            <var n="numero"/>
            <lit-tag v="sg"/>
          </let>
        </when>
        <when>
          <test>
            <equal>
              <clip pos="1" side="tl" part="nbr"/>
              <lit-tag v="pl"/>
            </equal>
          </test>
          <let>
            <var n="numero"/>
            <lit-tag v="pl"/>
          </let>
        </when>
        <when>
          <test>
            <equal>
              <clip pos="2" side="tl" part="nbr"/>
              <lit-tag v="sg"/>
            </equal>
          </test>
          <let>
            <var n="numero"/>
            <lit-tag v="sg"/>
          </let>
        </when>
        <when>
          <test>
            <equal>
              <clip pos="2" side="tl" part="nbr"/>
              <lit-tag v="pl"/>
            </equal>
          </test>
          <let>
            <var n="numero"/>
            <lit-tag v="pl"/>
          </let>
        </when>
        <when>
          <test>
            <equal>
              <clip pos="3" side="tl" part="nbr"/>
              <lit-tag v="sg"/>
            </equal>
          </test>
          <let>
            <var n="numero"/>
            <lit-tag v="sg"/>
          </let>
        </when>
        <when>
          <test>
            <equal>
              <clip pos="3" side="tl" part="nbr"/>
              <lit-tag v="pl"/>
            </equal>
          </test>
          <let>
            <var n="numero"/>
            <lit-tag v="pl"/>
          </let>
        </when>
        <when>
          <test>
            <and>
              <equal>
                <clip pos="1" side="tl" part="nbr"/>
                <lit-tag v="sp"/>
              </equal>
              <not>
                <equal>
                  <clip pos="1" side="sl" part="nbr"/>
                  <lit-tag v="sp"/>
                </equal>
              </not>
            </and>
          </test>
          <let>
            <var n="numero"/>
            <clip pos="1" side="sl" part="nbr"/>
          </let>
        </when>
        <when>
          <test>
            <and>
              <equal>
                <clip pos="2" side="tl" part="nbr"/>
                <lit-tag v="sp"/>
              </equal>
              <not>
                <equal>
                  <clip pos="2" side="sl" part="nbr"/>
                  <lit-tag v="sp"/>
                </equal>
              </not>
            </and>
          </test>
          <let>
            <var n="numero"/>
            <clip pos="2" side="sl" part="nbr"/>
          </let>
        </when>
        <when>
          <test>
            <and>
              <equal>
                <clip pos="3" side="tl" part="nbr"/>
                <lit-tag v="sp"/>
              </equal>
              <not>
                <equal>
                  <clip pos="3" side="sl" part="nbr"/>
                  <lit-tag v="sp"/>
                </equal>
              </not>
            </and>
          </test>
          <let>
            <var n="numero"/>
            <clip pos="3" side="sl" part="nbr"/>
          </let>
        </when>
        <otherwise>
          <let>
            <var n="numero"/>
            <lit-tag v="sg"/>
          </let>
        </otherwise>
      </choose>
      <choose>
<!-- Assign values to GD and ND -->
        <when>
          <test>
            <equal>
              <clip pos="1" side="tl" part="gen"/>
              <lit-tag v="GD"/>
            </equal>
          </test>
          <let>
            <clip pos="1" side="tl" part="gen"/>
            <var n="genero"/>
          </let>
        </when>
      </choose>
      <choose>
        <when>
          <test>
            <equal>
              <clip pos="2" side="tl" part="gen"/>
              <lit-tag v="GD"/>
            </equal>
          </test>
          <let>
            <clip pos="2" side="tl" part="gen"/>
            <var n="genero"/>
          </let>
        </when>
      </choose>
      <choose>
        <when>
          <test>
            <equal>
              <clip pos="3" side="tl" part="gen"/>
              <lit-tag v="GD"/>
            </equal>
          </test>
          <let>
            <clip pos="3" side="tl" part="gen"/>
            <var n="genero"/>
          </let>
        </when>
      </choose>
      <choose>
        <when>
          <test>
            <equal>
              <clip pos="1" side="tl" part="nbr"/>
              <lit-tag v="ND"/>
            </equal>
          </test>
          <let>
            <clip pos="1" side="tl" part="nbr"/>
            <var n="numero"/>
          </let>
        </when>
      </choose>
      <choose>
        <when>
          <test>
            <equal>
              <clip pos="2" side="tl" part="nbr"/>
              <lit-tag v="ND"/>
            </equal>
          </test>
          <let>
            <clip pos="2" side="tl" part="nbr"/>
            <var n="numero"/>
          </let>
        </when>
      </choose>
      <choose>
        <when>
          <test>
            <equal>
              <clip pos="3" side="tl" part="nbr"/>
              <lit-tag v="ND"/>
            </equal>
          </test>
          <let>
            <clip pos="3" side="tl" part="nbr"/>
            <var n="numero"/>
          </let>
        </when>
      </choose>
    </def-macro>
    <def-macro n="f_concord4" npar="4">
      <choose>
        <when>
          <test>
            <and>
              <or>
                <equal>
                  <clip pos="2" side="sl" part="gen"/>
                  <clip pos="1" side="sl" part="gen"/>
                </equal>
                <equal>
                  <clip pos="2" side="sl" part="gen"/>
                  <lit-tag v="mf"/>
                </equal>
                <equal>
                  <clip pos="1" side="sl" part="gen"/>
                  <lit-tag v="mf"/>
                </equal>
              </or>
              <or>
                <equal>
                  <clip pos="2" side="sl" part="nbr"/>
                  <clip pos="1" side="sl" part="nbr"/>
                </equal>
                <equal>
                  <clip pos="2" side="sl" part="nbr"/>
                  <lit-tag v="sp"/>
                </equal>
                <equal>
                  <clip pos="1" side="sl" part="nbr"/>
                  <lit-tag v="sp"/>
                </equal>
              </or>
            </and>
          </test>
          <let>
            <var n="concPrimero"/>
            <lit v="true"/>
          </let>
        </when>
        <otherwise>
          <let>
            <var n="concPrimero"/>
            <lit v="false"/>
          </let>
        </otherwise>
      </choose>
      <choose>
        <when>
          <test>
            <and>
              <or>
                <equal>
                  <clip pos="3" side="sl" part="gen"/>
                  <clip pos="1" side="sl" part="gen"/>
                </equal>
                <equal>
                  <clip pos="3" side="sl" part="gen"/>
                  <lit-tag v="mf"/>
                </equal>
                <equal>
                  <clip pos="1" side="sl" part="gen"/>
                  <lit-tag v="mf"/>
                </equal>
              </or>
              <or>
                <equal>
                  <clip pos="3" side="sl" part="nbr"/>
                  <clip pos="1" side="sl" part="nbr"/>
                </equal>
                <equal>
                  <clip pos="3" side="sl" part="nbr"/>
                  <lit-tag v="sp"/>
                </equal>
                <equal>
                  <clip pos="1" side="sl" part="nbr"/>
                  <lit-tag v="sp"/>
                </equal>
              </or>
            </and>
          </test>
          <let>
            <var n="concSegundo"/>
            <lit v="true"/>
          </let>
        </when>
        <otherwise>
          <let>
            <var n="concSegundo"/>
            <lit v="false"/>
          </let>
        </otherwise>
      </choose>
      <choose>
        <when>
          <test>
            <and>
              <or>
                <equal>
                  <clip pos="4" side="sl" part="gen"/>
                  <clip pos="1" side="sl" part="gen"/>
                </equal>
                <equal>
                  <clip pos="4" side="sl" part="gen"/>
                  <lit-tag v="mf"/>
                </equal>
                <equal>
                  <clip pos="1" side="sl" part="gen"/>
                  <lit-tag v="mf"/>
                </equal>
              </or>
              <or>
                <equal>
                  <clip pos="4" side="sl" part="nbr"/>
                  <clip pos="1" side="sl" part="nbr"/>
                </equal>
                <equal>
                  <clip pos="4" side="sl" part="nbr"/>
                  <lit-tag v="sp"/>
                </equal>
                <equal>
                  <clip pos="1" side="sl" part="nbr"/>
                  <lit-tag v="sp"/>
                </equal>
              </or>
            </and>
          </test>
          <let>
            <var n="concTercero"/>
            <lit v="true"/>
          </let>
        </when>
        <otherwise>
          <let>
            <var n="concTercero"/>
            <lit v="false"/>
          </let>
        </otherwise>
      </choose>
      <choose>
        <when>
          <test>
            <and>
              <not>
                <equal>
                  <clip pos="1" side="tl" part="gen"/>
                  <clip pos="1" side="sl" part="gen"/>
                </equal>
              </not>
              <not>
                <equal>
                  <clip pos="1" side="tl" part="gen"/>
                  <lit-tag v="mf"/>
                </equal>
              </not>
              <not>
                <equal>
                  <clip pos="1" side="tl" part="gen"/>
                  <lit-tag v="GD"/>
                </equal>
              </not>
            </and>
          </test>
          <choose>
            <when>
              <test>
                <and>
                  <not>
                    <equal>
                      <clip pos="2" side="tl" part="gen"/>
                      <lit-tag v="mf"/>
                    </equal>
                  </not>
                  <not>
                    <and>
                      <equal>
                        <clip pos="2" side="sl" part="gen"/>
                        <lit-tag v="mf"/>
                      </equal>
                      <not>
                        <equal>
                          <clip pos="2" side="tl" part="gen"/>
                          <lit-tag v="GD"/>
                        </equal>
                      </not>
                    </and>
                  </not>
                  <equal>
                    <var n="concPrimero"/>
                    <lit v="true"/>
                  </equal>
                </and>
              </test>
              <let>
                <clip pos="2" side="tl" part="gen"/>
                <clip pos="1" side="tl" part="gen"/>
              </let>
            </when>
          </choose>
          <choose>
            <when>
              <test>
                <and>
                  <not>
                    <equal>
                      <clip pos="3" side="tl" part="gen"/>
                      <lit-tag v="mf"/>
                    </equal>
                  </not>
                  <not>
                    <and>
                      <equal>
                        <clip pos="3" side="sl" part="gen"/>
                        <lit-tag v="mf"/>
                      </equal>
                      <not>
                        <equal>
                          <clip pos="3" side="tl" part="gen"/>
                          <lit-tag v="GD"/>
                        </equal>
                      </not>
                    </and>
                  </not>
                  <equal>
                    <var n="concSegundo"/>
                    <lit v="true"/>
                  </equal>
                </and>
              </test>
              <let>
                <clip pos="3" side="tl" part="gen"/>
                <clip pos="1" side="tl" part="gen"/>
              </let>
            </when>
          </choose>
          <choose>
            <when>
              <test>
                <and>
                  <not>
                    <equal>
                      <clip pos="4" side="tl" part="gen"/>
                      <lit-tag v="mf"/>
                    </equal>
                  </not>
                  <not>
                    <and>
                      <equal>
                        <clip pos="4" side="sl" part="gen"/>
                        <lit-tag v="mf"/>
                      </equal>
                      <not>
                        <equal>
                          <clip pos="4" side="tl" part="gen"/>
                          <lit-tag v="GD"/>
                        </equal>
                      </not>
                    </and>
                  </not>
                  <equal>
                    <var n="concTercero"/>
                    <lit v="true"/>
                  </equal>
                </and>
              </test>
              <let>
                <clip pos="4" side="tl" part="gen"/>
                <clip pos="1" side="tl" part="gen"/>
              </let>
            </when>
          </choose>
        </when>
      </choose>
      <choose>
        <when>
          <test>
            <and>
              <not>
                <equal>
                  <clip pos="1" side="tl" part="nbr"/>
                  <clip pos="1" side="sl" part="nbr"/>
                </equal>
              </not>
              <not>
                <equal>
                  <clip pos="1" side="tl" part="nbr"/>
                  <lit-tag v="sp"/>
                </equal>
              </not>
              <not>
                <equal>
                  <clip pos="1" side="tl" part="nbr"/>
                  <lit-tag v="ND"/>
                </equal>
              </not>
            </and>
          </test>
          <choose>
            <when>
              <test>
                <and>
                  <not>
                    <equal>
                      <clip pos="2" side="tl" part="nbr"/>
                      <lit-tag v="sp"/>
                    </equal>
                  </not>
                  <not>
                    <and>
                      <equal>
                        <clip pos="2" side="sl" part="nbr"/>
                        <lit-tag v="sp"/>
                      </equal>
                      <not>
                        <equal>
                          <clip pos="2" side="tl" part="nbr"/>
                          <lit-tag v="ND"/>
                        </equal>
                      </not>
                    </and>
                  </not>
                  <equal>
                    <var n="concPrimero"/>
                    <lit v="true"/>
                  </equal>
                </and>
              </test>
              <let>
                <clip pos="2" side="tl" part="nbr"/>
                <clip pos="1" side="tl" part="nbr"/>
              </let>
            </when>
          </choose>
          <choose>
            <when>
              <test>
                <and>
                  <not>
                    <equal>
                      <clip pos="3" side="tl" part="nbr"/>
                      <lit-tag v="sp"/>
                    </equal>
                  </not>
                  <not>
                    <and>
                      <equal>
                        <clip pos="3" side="sl" part="nbr"/>
                        <lit-tag v="sp"/>
                      </equal>
                      <not>
                        <equal>
                          <clip pos="3" side="tl" part="nbr"/>
                          <lit-tag v="ND"/>
                        </equal>
                      </not>
                    </and>
                  </not>
                  <equal>
                    <var n="concSegundo"/>
                    <lit v="true"/>
                  </equal>
                </and>
              </test>
              <let>
                <clip pos="3" side="tl" part="nbr"/>
                <clip pos="1" side="tl" part="nbr"/>
              </let>
            </when>
          </choose>
          <choose>
            <when>
              <test>
                <and>
                  <not>
                    <equal>
                      <clip pos="4" side="tl" part="nbr"/>
                      <lit-tag v="sp"/>
                    </equal>
                  </not>
                  <not>
                    <and>
                      <equal>
                        <clip pos="4" side="sl" part="nbr"/>
                        <lit-tag v="sp"/>
                      </equal>
                      <not>
                        <equal>
                          <clip pos="4" side="tl" part="nbr"/>
                          <lit-tag v="ND"/>
                        </equal>
                      </not>
                    </and>
                  </not>
                  <equal>
                    <var n="concTercero"/>
                    <lit v="true"/>
                  </equal>
                </and>
              </test>
              <let>
                <clip pos="4" side="tl" part="nbr"/>
                <clip pos="1" side="tl" part="nbr"/>
              </let>
            </when>
          </choose>
        </when>
      </choose>
      <choose>
        <when>
          <test>
            <equal>
              <clip pos="1" side="tl" part="gen"/>
              <lit-tag v="m"/>
            </equal>
          </test>
          <let>
            <var n="genero"/>
            <lit-tag v="m"/>
          </let>
        </when>
        <when>
          <test>
            <equal>
              <clip pos="1" side="tl" part="gen"/>
              <lit-tag v="f"/>
            </equal>
          </test>
          <let>
            <var n="genero"/>
            <lit-tag v="f"/>
          </let>
        </when>
        <when>
          <test>
            <equal>
              <clip pos="2" side="tl" part="gen"/>
              <lit-tag v="m"/>
            </equal>
          </test>
          <let>
            <var n="genero"/>
            <lit-tag v="m"/>
          </let>
        </when>
        <when>
          <test>
            <equal>
              <clip pos="2" side="tl" part="gen"/>
              <lit-tag v="f"/>
            </equal>
          </test>
          <let>
            <var n="genero"/>
            <lit-tag v="f"/>
          </let>
        </when>
        <when>
          <test>
            <equal>
              <clip pos="3" side="tl" part="gen"/>
              <lit-tag v="m"/>
            </equal>
          </test>
          <let>
            <var n="genero"/>
            <lit-tag v="m"/>
          </let>
        </when>
        <when>
          <test>
            <equal>
              <clip pos="3" side="tl" part="gen"/>
              <lit-tag v="f"/>
            </equal>
          </test>
          <let>
            <var n="genero"/>
            <lit-tag v="f"/>
          </let>
        </when>
        <when>
          <test>
            <equal>
              <clip pos="4" side="tl" part="gen"/>
              <lit-tag v="m"/>
            </equal>
          </test>
          <let>
            <var n="genero"/>
            <lit-tag v="m"/>
          </let>
        </when>
        <when>
          <test>
            <equal>
              <clip pos="4" side="tl" part="gen"/>
              <lit-tag v="f"/>
            </equal>
          </test>
          <let>
            <var n="genero"/>
            <lit-tag v="f"/>
          </let>
        </when>
        <otherwise>
          <let>
            <var n="genero"/>
            <lit-tag v="m"/>
          </let>
        </otherwise>
      </choose>
      <choose>
        <when>
          <test>
            <equal>
              <clip pos="1" side="tl" part="nbr"/>
              <lit-tag v="sg"/>
            </equal>
          </test>
          <let>
            <var n="numero"/>
            <lit-tag v="sg"/>
          </let>
        </when>
        <when>
          <test>
            <equal>
              <clip pos="1" side="tl" part="nbr"/>
              <lit-tag v="pl"/>
            </equal>
          </test>
          <let>
            <var n="numero"/>
            <lit-tag v="pl"/>
          </let>
        </when>
        <when>
          <test>
            <equal>
              <clip pos="2" side="tl" part="nbr"/>
              <lit-tag v="sg"/>
            </equal>
          </test>
          <let>
            <var n="numero"/>
            <lit-tag v="sg"/>
          </let>
        </when>
        <when>
          <test>
            <equal>
              <clip pos="2" side="tl" part="nbr"/>
              <lit-tag v="pl"/>
            </equal>
          </test>
          <let>
            <var n="numero"/>
            <lit-tag v="pl"/>
          </let>
        </when>
        <when>
          <test>
            <equal>
              <clip pos="3" side="tl" part="nbr"/>
              <lit-tag v="sg"/>
            </equal>
          </test>
          <let>
            <var n="numero"/>
            <lit-tag v="sg"/>
          </let>
        </when>
        <when>
          <test>
            <equal>
              <clip pos="3" side="tl" part="nbr"/>
              <lit-tag v="pl"/>
            </equal>
          </test>
          <let>
            <var n="numero"/>
            <lit-tag v="pl"/>
          </let>
        </when>
        <when>
          <test>
            <equal>
              <clip pos="4" side="tl" part="nbr"/>
              <lit-tag v="sg"/>
            </equal>
          </test>
          <let>
            <var n="numero"/>
            <lit-tag v="sg"/>
          </let>
        </when>
        <when>
          <test>
            <equal>
              <clip pos="4" side="tl" part="nbr"/>
              <lit-tag v="pl"/>
            </equal>
          </test>
          <let>
            <var n="numero"/>
            <lit-tag v="pl"/>
          </let>
        </when>
        <otherwise>
          <let>
            <var n="numero"/>
            <lit-tag v="sg"/>
          </let>
        </otherwise>
      </choose>
      <choose>
        <when>
          <test>
            <equal>
              <clip pos="1" side="tl" part="gen"/>
              <lit-tag v="GD"/>
            </equal>
          </test>
          <let>
            <clip pos="1" side="tl" part="gen"/>
            <var n="genero"/>
          </let>
        </when>
      </choose>
      <choose>
        <when>
          <test>
            <equal>
              <clip pos="2" side="tl" part="gen"/>
              <lit-tag v="GD"/>
            </equal>
          </test>
          <let>
            <clip pos="2" side="tl" part="gen"/>
            <var n="genero"/>
          </let>
        </when>
      </choose>
      <choose>
        <when>
          <test>
            <equal>
              <clip pos="3" side="tl" part="gen"/>
              <lit-tag v="GD"/>
            </equal>
          </test>
          <let>
            <clip pos="3" side="tl" part="gen"/>
            <var n="genero"/>
          </let>
        </when>
      </choose>
      <choose>
        <when>
          <test>
            <equal>
              <clip pos="4" side="tl" part="gen"/>
              <lit-tag v="GD"/>
            </equal>
          </test>
          <let>
            <clip pos="4" side="tl" part="gen"/>
            <var n="genero"/>
          </let>
        </when>
      </choose>
      <choose>
        <when>
          <test>
            <equal>
              <clip pos="1" side="tl" part="nbr"/>
              <lit-tag v="ND"/>
            </equal>
          </test>
          <let>
            <clip pos="1" side="tl" part="nbr"/>
            <var n="numero"/>
          </let>
        </when>
      </choose>
      <choose>
        <when>
          <test>
            <equal>
              <clip pos="2" side="tl" part="nbr"/>
              <lit-tag v="ND"/>
            </equal>
          </test>
          <let>
            <clip pos="2" side="tl" part="nbr"/>
            <var n="numero"/>
          </let>
        </when>
      </choose>
      <choose>
        <when>
          <test>
            <equal>
              <clip pos="3" side="tl" part="nbr"/>
              <lit-tag v="ND"/>
            </equal>
          </test>
          <let>
            <clip pos="3" side="tl" part="nbr"/>
            <var n="numero"/>
          </let>
        </when>
      </choose>
      <choose>
        <when>
          <test>
            <equal>
              <clip pos="4" side="tl" part="nbr"/>
              <lit-tag v="ND"/>
            </equal>
          </test>
          <let>
            <clip pos="4" side="tl" part="nbr"/>
            <var n="numero"/>
          </let>
        </when>
      </choose>
    </def-macro>


 <def-macro n="conj_verb2" npar="2"><!--conjuga un verb analitico -->
	<choose>
	  <when>
	    <test>
                <and> 
                  <equal>
		    <clip pos="1" side="sl" part="lemh"/>
		    <lit v="haber"/>
		  </equal>
                  <equal>
		    <clip pos="1" side="sl" part="temps"/>
		    <lit-tag v="pri"/>
		  </equal>
                  <equal>
		    <clip pos="2" side="sl" part="temps"/>
		    <lit-tag v="pp"/>
		  </equal>
		</and>
	    </test>
	    <let>
	      <var n="temps_chunk"/>
	      <clip pos="2" side="tl" part="temps"/>
	    </let>
	    <let>
	      <var n="lema_SV"/>
	      <lit v="verbcj"/>
	    </let>
	    <let>
	      <var n="genero_pp"/>
	      <var n="genero"/>
	    </let>
	    <let>
	      <var n="numero_pp"/>
	      <var n="numero"/>
	    </let>
	    <call-macro n="mod-gen-pp">
              <with-param pos="2"/>
	    </call-macro>
	    <let>
	      <var n="verbfinal"/>
	      <concat>
                <lit v="avea"/>
                <lit-tag v="vbavea.pri"/>
                <clip pos="1" side="tl" part="pers"/>
                <clip pos="1" side="tl" part="nbr"/>
                <lit v="$ ^"/>
		<clip pos="2" side="tl" part="lemh"/>
		<clip pos="2" side="tl" part="a_verb"/>
                <lit-tag v="pp"/>
                <var n="genero_pp"/>
                <var n="numero_pp"/>
                <clip pos="2" side="tl" part="lemq"/>
	      </concat>
	    </let>
	  </when>
	  <when>
	    <test>
                <and> 
                  <equal>
		    <clip pos="1" side="sl" part="lemh"/>
		    <lit v="haber"/>
		  </equal>
                  <equal>
		    <clip pos="1" side="sl" part="temps"/>
		    <lit-tag v="cni"/>
		  </equal>
                  <equal>
		    <clip pos="2" side="sl" part="temps"/>
		    <lit-tag v="pp"/>
		  </equal>
		</and>
	    </test>
	    <let>
	      <var n="temps_chunk"/>
	      <clip pos="2" side="tl" part="temps"/>
	    </let>
	    <let>
	      <var n="lema_SV"/>
	      <lit v="verbcj"/>
	    </let>
	    <let>
	      <var n="genero_pp"/>
	      <var n="genero"/>
	    </let>
	    <let>
	      <var n="numero_pp"/>
	      <var n="numero"/>
	    </let>
	    <call-macro n="mod-gen-pp">
              <with-param pos="2"/>
	    </call-macro>
	    <let>
	      <var n="verbfinal"/>
	      <concat>
                <lit v="avea"/>
                <lit-tag v="vbavea.cni"/>
                <clip pos="1" side="tl" part="pers"/>
                <clip pos="1" side="tl" part="nbr"/>
                <lit v="$ ^"/>
                <lit v="fi"/>
                <lit-tag v="vblex.inf"/>
                <lit v="$ ^"/>
		<clip pos="2" side="tl" part="lemh"/>
		<clip pos="2" side="tl" part="a_verb"/>
                <lit-tag v="pp"/>
                <var n="genero_pp"/>
                <var n="numero_pp"/>
                <clip pos="2" side="tl" part="lemq"/>
	      </concat>
	    </let>
	  </when>

	  <when>
	    <test>
                <and> 
                  <equal>
		    <clip pos="1" side="sl" part="lemh"/>
		    <lit v="haber"/>
		  </equal>
                  <equal>
		    <clip pos="1" side="sl" part="temps"/>
		    <lit-tag v="pii"/>
		  </equal>
                  <equal>
		    <clip pos="2" side="sl" part="temps"/>
		    <lit-tag v="pp"/>
		  </equal>
		</and>
	    </test>
	    <let>
	      <var n="temps_chunk"/>
	      <lit-tag v="pper"/>
	    </let>
	    <let>
	      <var n="lema_SV"/>
	      <lit v="verbcj"/>
	    </let>
	    <let>
	      <var n="verbfinal"/>
	      <concat>
		<clip pos="2" side="tl" part="lemh"/>
		<clip pos="2" side="tl" part="a_verb"/>
                <lit-tag v="pper"/>
                <clip pos="1" side="tl" part="pers"/>
                <clip pos="1" side="tl" part="nbr"/>
                <clip pos="2" side="tl" part="lemq"/>
	      </concat>
	    </let>
	  </when>

<!--
	  <otherwise>
	    <let>
	      <var n="temps_chunk"/>
	      <clip pos="2" side="tl" part="temps"/>
	    </let>
	    <let>
	      <var n="lema_SV"/>
	      <lit v="verbcj"/>
	    </let>
	    <let>
	      <var n="verbfinal"/>
	      <concat>
                <clip pos="1" side="tl" part="whole"/>
                <lit v="$ ^"/>
		<clip pos="2" side="tl" part="whole"/>
	      </concat>
	    </let>
	  </otherwise>
-->

	</choose>
 </def-macro>
 <def-macro n="conj_verb1" npar="1"><!--conjuga un verb -->

	<choose>
	  <when>
	    <test>
                  <equal>
		    <clip pos="1" side="sl" part="temps"/>
		    <lit-tag v="pri"/>
		  </equal>
	    </test>
	    <let>
	      <var n="temps_chunk"/>
	      <clip pos="1" side="tl" part="temps"/>
	    </let>
	    <let>
	      <var n="lema_SV"/>
	      <lit v="verbcj"/>
	    </let>
	    <let>
	      <var n="verbfinal"/>
	      <concat>
		<clip pos="1" side="tl" part="lemh"/>
		<clip pos="1" side="tl" part="a_verb"/>
                <clip pos="1" side="tl" part="temps"/>
                <clip pos="1" side="tl" part="pers"/>
                <clip pos="1" side="tl" part="nbr"/>
                <clip pos="1" side="tl" part="lemq"/>
	      </concat>
	    </let>
	  </when>
	  <when>
	    <test>
                <or>
                  <equal>
		    <clip pos="1" side="sl" part="temps"/>
		    <lit-tag v="ifi"/>
		  </equal>
                  <equal>
		    <clip pos="1" side="sl" part="temps"/>
		    <lit-tag v="pii"/>
		  </equal>
		</or>
	    </test>
	    <let>
	      <var n="temps_chunk"/>
	      <clip pos="1" side="tl" part="temps"/>
	    </let>
	    <let>
	      <var n="lema_SV"/>
	      <lit v="verbcj"/>
	    </let>
	    <let>
	      <var n="genero_pp"/>
	      <var n="genero"/>
	    </let>
	    <let>
	      <var n="numero_pp"/>
	      <var n="numero"/>
	    </let>
	    <call-macro n="mod-gen-pp">
              <with-param pos="1"/>
	    </call-macro>
	    <let>
	      <var n="verbfinal"/>
	      <concat>
                <lit v="avea"/>
                <lit-tag v="vbavea.pri"/>
                <clip pos="1" side="tl" part="pers"/>
                <clip pos="1" side="tl" part="nbr"/>
                <lit v="$ ^"/>
		<clip pos="1" side="tl" part="lemh"/>
		<clip pos="1" side="tl" part="a_verb"/>
                <lit-tag v="pp"/>
                <var n="genero_pp"/>
                <var n="numero_pp"/>
                <clip pos="1" side="tl" part="lemq"/>
	      </concat>
	    </let>
	  </when>
	  <when>
	    <test>
              <equal>
                <clip pos="1" side="sl" part="temps"/>
                <lit-tag v="fti"/>
              </equal>
	    </test>
	    <let>
	      <var n="temps_chunk"/>
	      <clip pos="1" side="tl" part="temps"/>
	    </let>
	    <let>
	      <var n="lema_SV"/>
	      <lit v="verbcj"/>
	    </let>
	    <let>
	      <var n="verbfinal"/>
	      <concat>
                <lit v="vrea"/>
                <lit-tag v="vaux.pri"/>
                <clip pos="1" side="sl" part="pers"/>
                <clip pos="1" side="sl" part="nbr"/>
                <lit v="$ ^"/>
		<clip pos="1" side="tl" part="lemh"/>
		<clip pos="1" side="tl" part="a_verb"/>
                <lit-tag v="inf"/>
                <clip pos="1" side="tl" part="lemq"/>
	      </concat>
	    </let>
	  </when>
	  <when>
	    <test>
              <equal>
                <clip pos="1" side="sl" part="temps"/>
                <lit-tag v="cni"/>
              </equal>
	    </test>
	    <let>
	      <var n="temps_chunk"/>
	      <clip pos="1" side="tl" part="temps"/>
	    </let>
	    <let>
	      <var n="lema_SV"/>
	      <lit v="verbcj"/>
	    </let>
	    <let>
	      <var n="verbfinal"/>
	      <concat>
                <lit v="avea"/>
                <lit-tag v="vbavea"/>
                <clip pos="1" side="tl" part="temps"/>
                <clip pos="1" side="tl" part="pers"/>
                <clip pos="1" side="tl" part="nbr"/>
                <lit v="$ ^"/>
		<clip pos="1" side="tl" part="lemh"/>
		<clip pos="1" side="tl" part="a_verb"/>
                <lit-tag v="inf"/>
                <clip pos="1" side="tl" part="lemq"/>
	      </concat>
	    </let>
	  </when>
          <otherwise>
	    <let>
	      <var n="temps_chunk"/>
	      <clip pos="1" side="tl" part="temps"/>
	    </let>
	    <let>
	      <var n="lema_SV"/>
	      <lit v="verbcj"/>
	    </let>
	    <let>
	      <var n="verbfinal"/>
	      <concat>
		<clip pos="1" side="tl" part="lemh"/>
		<clip pos="1" side="tl" part="a_verb"/>
                <clip pos="1" side="tl" part="temps"/>
                <clip pos="1" side="tl" part="pers"/>
                <clip pos="1" side="tl" part="nbr"/>
                <clip pos="1" side="tl" part="lemq"/>
	      </concat>
	    </let>
          </otherwise>
	</choose>
    </def-macro>


  </section-def-macros>
  <section-rules>

<!--*************************************** REGLES DE SN ******************************************** -->
    <rule comment="REGLA: NOM">
      <pattern>
        <pattern-item n="nom"/>
      </pattern>
      <action>
        <call-macro n="firstWord">
          <with-param pos="1"/>
        </call-macro>
        <call-macro n="f_concord1">
           <with-param pos="1"/>
        </call-macro>
        <out>
          <chunk name="nom" case="caseFirstWord">
            <tags>
              <tag><lit-tag v="SN"/></tag>
	      <tag><var n="caso"/></tag>
            </tags>
            <lu>
              <clip pos="1" side="tl" part="lemh"/>
              <clip pos="1" side="tl" part="a_nom"/>
              <clip pos="1" side="tl" part="gen"/>
              <clip pos="1" side="tl" part="nbr"/>
              <lit-tag v="2.ind"/>
              <clip pos="1" side="tl" part="lemq"/>
            </lu>
          </chunk>
        </out>
      </action>
    </rule>

    <rule comment="REGLA: ADJECTIU">
      <pattern>
        <pattern-item n="adjec"/>
      </pattern>
      <action>
        <call-macro n="firstWord">
          <with-param pos="1"/>
        </call-macro>
        <call-macro n="f_concord1">
          <with-param pos="1"/>
        </call-macro>
	<call-macro n="mod-gen">
	  <with-param pos="1"/>
	</call-macro>
	<choose>
          <when>
            <test>
              <or>
                <equal>
                  <clip pos="1" side="tl" part="a_adj"/>
                  <lit-tag v="vblex.pp"/>
                </equal>
                <equal>
                  <clip pos="1" side="tl" part="a_adj"/>
                  <lit-tag v="vbmod.pp"/>
                </equal>
                <equal>
                  <clip pos="1" side="tl" part="a_adj"/>
                  <lit-tag v="vaux.pp"/>
                </equal>
                <equal>
                  <clip pos="1" side="tl" part="a_adj"/>
                  <lit-tag v="vbser.pp"/>
                </equal>
                <equal>
                  <clip pos="1" side="tl" part="a_adj"/>
                  <lit-tag v="vbhaver.pp"/>
                </equal>
              </or>
            </test>
            <out>
              <chunk name="pp" case="caseFirstWord">
                <tags>
                  <tag><lit-tag v="SA"/></tag>
                </tags>
                <lu>
                  <clip pos="1" side="tl" part="lemh"/>
                  <clip pos="1" side="tl" part="a_adj"/>
                  <clip pos="1" side="tl" part="gen"/>
                  <clip pos="1" side="tl" part="nbr"/>
                  <clip pos="1" side="tl" part="lemq"/>
                </lu>
              </chunk>
            </out>
          </when>
          <otherwise>
            <out>
              <chunk name="adj" case="caseFirstWord">
                <tags>
                  <tag><lit-tag v="SA"/></tag>
                  <tag><var n="caso"/></tag>
                </tags>
                <lu>
                  <clip pos="1" side="tl" part="lemh"/>
                  <clip pos="1" side="tl" part="a_adj"/>
                  <clip pos="1" side="tl" part="gen"/>
                  <clip pos="1" side="tl" part="nbr"/>
                  <lit-tag v="2.ind"/>
                  <clip pos="1" side="tl" part="lemq"/>
                </lu>
              </chunk>
            </out>
          </otherwise>
        </choose>
      </action>
    </rule>
 
    <rule comment="ADV">
      <pattern>
        <pattern-item n="adv_preadv"/>
      </pattern>
      <action>
        <call-macro n="firstWord">
          <with-param pos="1"/>
        </call-macro>
        <out>
          <chunk name="adv" case="caseFirstWord">
            <tags>
              <tag><clip pos="1" side="tl" part="a_adv"/></tag>
            </tags>
            <lu>
              <clip pos="1" side="tl" part="lem"/>
              <clip pos="1" side="tl" part="a_adv"/>
            </lu>
          </chunk>
        </out>
      </action>
    </rule>
    

    <rule comment="NUMERAL">
      <pattern>
        <pattern-item n="numeral"/>
      </pattern>
      <action>
       <call-macro n="firstWord">
          <with-param pos="1"/>
       </call-macro>
      <call-macro n="f_concord1">
          <with-param pos="1"/>
        </call-macro>

        <out>
          <chunk name="num" case="caseFirstWord">
            <tags>
              <tag>
                <lit-tag v="SN"/>
              </tag>
              <tag>
                <var n="genero"/>
              </tag>
              <tag>
                <var n="numero"/>
              </tag>
            </tags>
            <lu>
              <clip pos="1" side="tl" part="lem"/>
              <clip pos="1" side="tl" part="a_num"/>
              <clip pos="1" side="tl" part="gen"/>
              <clip pos="1" side="tl" part="nbr"/>
            </lu>
          </chunk>
        </out>
      </action>
    </rule>



    <rule comment="REGLA: DET NOM">
      <pattern>
        <pattern-item n="det"/>
        <pattern-item n="nom"/>
      </pattern>
      <action>
        <call-macro n="firstWord">
          <with-param pos="1"/>
        </call-macro>
        <call-macro n="f_concord2">
          <with-param pos="2"/>
          <with-param pos="1"/>
        </call-macro>
        <choose>
          <when>
            <test>
                <equal>
                  <clip pos="1" side="sl" part="a_det"/>
                  <lit-tag v="det.def"/>
                </equal>
            </test>
            <out>
              <chunk name="nomdef" case="caseFirstWord">
                <tags>
		  <tag><lit-tag v="SN"/></tag>
		  <tag><var n="caso"/></tag>
		</tags>
                <lu>
                  <clip pos="2" side="tl" part="lemh"/>
                  <clip pos="2" side="tl" part="a_nom"/>
                  <clip pos="2" side="tl" part="gen"/>
                  <clip pos="2" side="tl" part="nbr"/>
                  <lit-tag v="2.def"/>
                  <clip pos="2" side="tl" part="lemq"/>
                </lu>
              </chunk>
            </out>
          </when>
          <otherwise>
            <choose>
              <when>
                <test>
                  <or>
                    <equal>
                      <clip pos="1" side="sl" part="a_det"/>
                      <lit-tag v="det.dem"/>
                    </equal>
                    <equal>
                      <clip pos="1" side="sl" part="a_det"/>
                      <lit-tag v="det.ind"/>
                    </equal>
                  </or>
                </test>
		<call-macro n="mod-gen">
		  <with-param pos="1"/>
		</call-macro>
                <out>
                  <chunk name="det_nom" case="caseFirstWord">
                    <tags>
                      <tag><lit-tag v="SN"/></tag>
		      <tag><var n="caso"/></tag>
                    </tags>
                    <lu>
                      <clip pos="1" side="tl" part="lem"/>
                      <clip pos="1" side="tl" part="a_det"/>
                      <clip pos="1" side="tl" part="gen"/>
                      <clip pos="1" side="tl" part="nbr"/>
                      <lit-tag v="2"/>
                    </lu>
                    <b pos="1"/>
                    <lu>
                      <clip pos="2" side="tl" part="lemh"/>
                      <clip pos="2" side="tl" part="a_nom"/>
                      <clip pos="2" side="tl" part="gen"/>
                      <clip pos="2" side="tl" part="nbr"/>
		      <!--
                      <lit-tag v="nom.def"/>
		      -->
                      <lit-tag v="nom.ind"/>
                      <clip pos="2" side="tl" part="lemq"/>
                    </lu>
                  </chunk>
                </out>
              </when>
              <otherwise>
	    <choose>
              <when>
                <test>
                    <equal>
                      <clip pos="1" side="sl" part="a_det"/>
                      <lit-tag v="det.pos"/>
                    </equal>
                </test>
		<call-macro n="mod-gen">
		  <with-param pos="1"/>
		</call-macro>
                <out>
                  <chunk name="nom_adj" case="caseFirstWord">
                    <tags>
                      <tag><lit-tag v="SN"/></tag>
                      <tag><var n="caso"/></tag>
                    </tags>
                    <lu>
                      <clip pos="2" side="tl" part="lemh"/>
                      <clip pos="2" side="tl" part="a_nom"/>
                      <clip pos="2" side="tl" part="gen"/>
                      <clip pos="2" side="tl" part="nbr"/>
                      <lit-tag v="2.def"/>
                      <clip pos="2" side="tl" part="lemq"/>
                    </lu>
                    <b pos="1"/>
                    <lu>
                      <clip pos="1" side="tl" part="lem"/>
                      <lit-tag v="adj.pos"/>
                      <clip pos="1" side="tl" part="gen"/>
                      <clip pos="1" side="tl" part="nbr"/>
		      <lit-tag v="nom.ind"/>	
                    </lu>
                  </chunk>
                </out>
              </when>
            </choose>
            </otherwise>
            </choose>
          </otherwise>
        </choose>
      </action>
    </rule>

    <rule comment="REGLA: todo DET NOM">
      <pattern>
        <pattern-item n="todo"/>
        <pattern-item n="det"/>
        <pattern-item n="nom"/>
      </pattern>
      <action>
        <call-macro n="firstWord">
          <with-param pos="1"/>
        </call-macro>
        <call-macro n="f_concord2">
          <with-param pos="3"/>
          <with-param pos="2"/>
        </call-macro>
        <choose>
          <when>
            <test>
                <equal>
                  <clip pos="2" side="sl" part="a_det"/>
                  <lit-tag v="det.def"/>
                </equal>
            </test>
            <out>
              <chunk name="predet_nomdef" case="caseFirstWord">
                <tags>
		  <tag><lit-tag v="SN"/></tag>
		  <tag><var n="caso"/></tag>
		</tags>
		<lu>
                  <clip pos="1" side="tl" part="lemh"/>
                  <clip pos="1" side="tl" part="a_det"/>
                  <clip pos="1" side="tl" part="gen"/>
                  <clip pos="1" side="tl" part="nbr"/>
                  <lit-tag v="2"/>
                  <clip pos="1" side="tl" part="lemq"/>
		</lu>
		<b pos="1"/>
                <lu>
                  <clip pos="3" side="tl" part="lemh"/>
                  <clip pos="3" side="tl" part="a_nom"/>
                  <clip pos="3" side="tl" part="gen"/>
                  <clip pos="3" side="tl" part="nbr"/>
                  <lit-tag v="2.def"/>
                  <clip pos="3" side="tl" part="lemq"/>
                </lu>
              </chunk>
            </out>
          </when>
          <otherwise>
            <choose>
              <when>
                <test>
                  <or>
                    <equal>
                      <clip pos="2" side="sl" part="a_det"/>
                      <lit-tag v="det.dem"/>
                    </equal>
                    <equal>
                      <clip pos="2" side="sl" part="a_det"/>
                      <lit-tag v="det.ind"/>
                    </equal>
                  </or>
                </test>
		<call-macro n="mod-gen">
		  <with-param pos="2"/>
		</call-macro>
                <out>
                  <chunk name="predet_det_nom" case="caseFirstWord">
                    <tags>
                      <tag><lit-tag v="SN"/></tag>
		      <tag><var n="caso"/></tag>
                    </tags>
		    <lu>
                      <clip pos="1" side="tl" part="lemh"/>
                      <clip pos="1" side="tl" part="a_det"/>
                      <clip pos="1" side="tl" part="gen"/>
                      <clip pos="1" side="tl" part="nbr"/>
                      <lit-tag v="2"/>
                      <clip pos="1" side="tl" part="lemq"/>
		    </lu>
                    <b pos="1"/>
                    <lu>
                      <clip pos="2" side="tl" part="lem"/>
                      <clip pos="2" side="tl" part="a_det"/>
                      <clip pos="2" side="tl" part="gen"/>
                      <clip pos="2" side="tl" part="nbr"/>
                      <lit-tag v="2"/>
                    </lu>
                    <b pos="2"/>
                    <lu>
                      <clip pos="3" side="tl" part="lemh"/>
                      <clip pos="3" side="tl" part="a_nom"/>
                      <clip pos="3" side="tl" part="gen"/>
                      <clip pos="3" side="tl" part="nbr"/>
                      <lit-tag v="nom.ind"/>
                      <clip pos="3" side="tl" part="lemq"/>
                    </lu>
                  </chunk>
                </out>
              </when>
              <otherwise>
	    <choose>
              <when>
                <test>
                    <equal>
                      <clip pos="2" side="sl" part="a_det"/>
                      <lit-tag v="det.pos"/>
                    </equal>
                </test>
		<call-macro n="mod-gen">
		  <with-param pos="2"/>
		</call-macro>
                <out>
                  <chunk name="predet_nom_adj" case="caseFirstWord">
                    <tags>
                      <tag><lit-tag v="SN"/></tag>
                    </tags>
		    <lu>
                      <clip pos="1" side="tl" part="lemh"/>
                      <clip pos="1" side="tl" part="a_det"/>
                      <clip pos="1" side="tl" part="gen"/>
                      <clip pos="1" side="tl" part="nbr"/>
                      <lit-tag v="nom"/>
                      <clip pos="1" side="tl" part="lemq"/>
		    </lu>
                    <b pos="1"/>
                    <lu>
                      <clip pos="3" side="tl" part="lemh"/>
                      <clip pos="3" side="tl" part="a_nom"/>
                      <clip pos="3" side="tl" part="gen"/>
                      <clip pos="3" side="tl" part="nbr"/>
                      <lit-tag v="nom.def"/>
                      <clip pos="3" side="tl" part="lemq"/>
                    </lu>
                    <b pos="2"/>
                    <lu>
                      <clip pos="2" side="tl" part="lem"/>
                      <lit-tag v="adj.pos"/>
                      <clip pos="2" side="tl" part="gen"/>
                      <clip pos="2" side="tl" part="nbr"/>
		      <lit-tag v="nom.ind"/>	
                    </lu>
                  </chunk>
                </out>
              </when>
            </choose>
            </otherwise>
            </choose>
          </otherwise>
        </choose>
      </action>
    </rule>

    <rule comment="REGLA: a ANT">
      <pattern>
        <pattern-item n="a"/>
        <pattern-item n="ant"/>
      </pattern>
      <action>
        <call-macro n="firstWord">
          <with-param pos="1"/>
        </call-macro>
        <let>
          <var n="caso"/>
          <lit-tag v="nom"/>
        </let>
            <out>
              <chunk name="pe_ant" case="caseFirstWord">
                <tags>
		  <tag><lit-tag v="SN"/></tag>
		  <tag><var n="caso"/></tag>
		</tags>
		<lu>
                  <lit v="pe"/>
		  <lit-tag v="pr"/>
		</lu>
		<b pos="1"/>
                <lu>
                  <clip pos="2" side="tl" part="lemh"/>
                  <clip pos="2" side="tl" part="a_nom"/>
                  <clip pos="2" side="tl" part="gen"/>
                  <clip pos="2" side="tl" part="lemq"/>
                </lu>
              </chunk>
            </out>
      </action>
    </rule>




    <rule comment="REGLA: a DET NOM">
      <pattern>
        <pattern-item n="a"/>
        <pattern-item n="det"/>
        <pattern-item n="nom"/>
      </pattern>
      <action>
        <call-macro n="firstWord">
          <with-param pos="1"/>
        </call-macro>
        <call-macro n="f_concord2">
          <with-param pos="3"/>
          <with-param pos="2"/>
        </call-macro>
<!--
        <let>
          <var n="caso"/>
          <lit-tag v="dg"/>
        </let>
-->
        <choose>
          <when>
            <test>
                <equal>
                  <clip pos="2" side="sl" part="a_det"/>
                  <lit-tag v="det.def"/>
                </equal>
            </test>
            <out>
              <chunk name="nomdef" case="caseFirstWord">
                <tags>
		  <tag><lit-tag v="SN"/></tag>
		  <tag><var n="caso"/></tag>
		</tags>
		<b pos="1"/>
                <lu>
                  <clip pos="3" side="tl" part="lemh"/>
                  <clip pos="3" side="tl" part="a_nom"/>
                  <clip pos="3" side="tl" part="gen"/>
                  <clip pos="3" side="tl" part="nbr"/>
                  <lit-tag v="2.def"/>
                  <clip pos="3" side="tl" part="lemq"/>
                </lu>
              </chunk>
            </out>
          </when>
          <otherwise>
            <choose>
              <when>
                <test>
                  <or>
                    <equal>
                      <clip pos="2" side="sl" part="a_det"/>
                      <lit-tag v="det.dem"/>
                    </equal>
                    <equal>
                      <clip pos="2" side="sl" part="a_det"/>
                      <lit-tag v="det.ind"/>
                    </equal>
                  </or>
                </test>
		<call-macro n="mod-gen">
		  <with-param pos="2"/>
		</call-macro>
                <out>
                  <chunk name="det_nom" case="caseFirstWord">
                    <tags>
                      <tag><lit-tag v="SN"/></tag>
		      <tag><var n="caso"/></tag>
                    </tags>
                    <lu>
                      <clip pos="2" side="tl" part="lem"/>
                      <clip pos="2" side="tl" part="a_det"/>
                      <clip pos="2" side="tl" part="gen"/>
                      <clip pos="2" side="tl" part="nbr"/>
                      <lit-tag v="2"/>
                    </lu>
                    <b pos="1"/>
                    <lu>
                      <clip pos="3" side="tl" part="lemh"/>
                      <clip pos="3" side="tl" part="a_nom"/>
                      <clip pos="3" side="tl" part="gen"/>
                      <clip pos="3" side="tl" part="nbr"/>
                      <lit-tag v="nom.ind"/>
                      <clip pos="3" side="tl" part="lemq"/>
                    </lu>
                  </chunk>
                </out>
              </when>
              <otherwise>
	    <choose>
              <when>
                <test>
                    <equal>
                      <clip pos="2" side="sl" part="a_det"/>
                      <lit-tag v="det.pos"/>
                    </equal>
                </test>
		<call-macro n="mod-gen">
		  <with-param pos="2"/>
		</call-macro>
                <out>
                  <chunk name="nom_adj" case="caseFirstWord">
                    <tags>
                      <tag><lit-tag v="SN"/></tag>
                    </tags>
                    <lu>
                      <clip pos="3" side="tl" part="lemh"/>
                      <clip pos="3" side="tl" part="a_nom"/>
                      <clip pos="3" side="tl" part="gen"/>
                      <clip pos="3" side="tl" part="nbr"/>
                      <lit-tag v="nom.def"/>
                      <clip pos="3" side="tl" part="lemq"/>
                    </lu>
                    <b pos="1"/>
                    <lu>
                      <clip pos="2" side="tl" part="lem"/>
                      <lit-tag v="adj.pos"/>
                      <clip pos="2" side="tl" part="gen"/>
                      <clip pos="2" side="tl" part="nbr"/>
		      <lit-tag v="nom.ind"/>	
                    </lu>
                  </chunk>
                </out>
              </when>
            </choose>
            </otherwise>
            </choose>
          </otherwise>
        </choose>
      </action>
    </rule>



    <rule comment="REGLA: de DET NOM">
      <pattern>
        <pattern-item n="de"/>
        <pattern-item n="det"/>
        <pattern-item n="nom"/>
      </pattern>
      <action>
        <call-macro n="firstWord">
          <with-param pos="1"/>
        </call-macro>
        <call-macro n="f_concord2">
          <with-param pos="3"/>
          <with-param pos="2"/>
        </call-macro>
        <let>
          <var n="caso"/>
          <lit-tag v="dg"/>
        </let>
        <choose>
          <when>
            <test>
                <equal>
                  <clip pos="2" side="sl" part="a_det"/>
                  <lit-tag v="det.def"/>
                </equal>
            </test>
            <out>
              <chunk name="nomdef" case="caseFirstWord">
                <tags>
		  <tag><lit-tag v="SN"/></tag>
		  <tag><var n="caso"/></tag>
		</tags>
		<b pos="1"/>
                <lu>
                  <clip pos="3" side="tl" part="lemh"/>
                  <clip pos="3" side="tl" part="a_nom"/>
                  <clip pos="3" side="tl" part="gen"/>
                  <clip pos="3" side="tl" part="nbr"/>
                  <lit-tag v="2.def"/>
                  <clip pos="3" side="tl" part="lemq"/>
                </lu>
              </chunk>
            </out>
          </when>
          <otherwise>
            <choose>
              <when>
                <test>
                  <or>
                    <equal>
                      <clip pos="2" side="sl" part="a_det"/>
                      <lit-tag v="det.dem"/>
                    </equal>
                    <equal>
                      <clip pos="2" side="sl" part="a_det"/>
                      <lit-tag v="det.ind"/>
                    </equal>
                  </or>
                </test>
		<call-macro n="mod-gen">
		  <with-param pos="2"/>
		</call-macro>
                <out>
                  <chunk name="det_nom" case="caseFirstWord">
                    <tags>
                      <tag><lit-tag v="SN"/></tag>
		      <tag><var n="caso"/></tag>
                    </tags>
                    <lu>
                      <clip pos="2" side="tl" part="lem"/>
                      <clip pos="2" side="tl" part="a_det"/>
                      <clip pos="2" side="tl" part="gen"/>
                      <clip pos="2" side="tl" part="nbr"/>
                      <lit-tag v="2"/>
                    </lu>
                    <b pos="1"/>
                    <lu>
                      <clip pos="3" side="tl" part="lemh"/>
                      <clip pos="3" side="tl" part="a_nom"/>
                      <clip pos="3" side="tl" part="gen"/>
                      <clip pos="3" side="tl" part="nbr"/>
                      <lit-tag v="nom.ind"/>
                      <clip pos="3" side="tl" part="lemq"/>
                    </lu>
                  </chunk>
                </out>
              </when>
              <otherwise>
	    <choose>
              <when>
                <test>
                    <equal>
                      <clip pos="2" side="sl" part="a_det"/>
                      <lit-tag v="det.pos"/>
                    </equal>
                </test>
		<call-macro n="mod-gen">
		  <with-param pos="2"/>
		</call-macro>
                <out>
                  <chunk name="nom_adj" case="caseFirstWord">
                    <tags>
                      <tag><lit-tag v="SN"/></tag>
                    </tags>
                    <lu>
                      <clip pos="3" side="tl" part="lemh"/>
                      <clip pos="3" side="tl" part="a_nom"/>
                      <clip pos="3" side="tl" part="gen"/>
                      <clip pos="3" side="tl" part="nbr"/>
                      <lit-tag v="nom.def"/>
                      <clip pos="3" side="tl" part="lemq"/>
                    </lu>
                    <b pos="1"/>
                    <lu>
                      <clip pos="2" side="tl" part="lem"/>
                      <lit-tag v="adj.pos"/>
                      <clip pos="2" side="tl" part="gen"/>
                      <clip pos="2" side="tl" part="nbr"/>
		      <lit-tag v="nom.ind"/>	
                    </lu>
                  </chunk>
                </out>
              </when>
            </choose>
            </otherwise>
            </choose>
          </otherwise>
        </choose>
      </action>
    </rule>

    <rule comment="REGLA: DET NOM de todo">
      <pattern>
        <pattern-item n="det"/>
        <pattern-item n="nom"/>
        <pattern-item n="de"/>
        <pattern-item n="todo"/>
      </pattern>
      <action>
        <call-macro n="firstWord">
          <with-param pos="1"/>
        </call-macro>
        <call-macro n="f_concord2">
          <with-param pos="2"/>
          <with-param pos="1"/>
        </call-macro>
        <choose>
          <when>
            <test>
                <equal>
                  <clip pos="1" side="sl" part="a_det"/>
                  <lit-tag v="det.def"/>
                </equal>
            </test>
            <out>
              <chunk name="nomdef" case="caseFirstWord">
                <tags>
		  <tag><lit-tag v="SN"/></tag>
		  <tag><var n="caso"/></tag>
		</tags>
                <lu>
                  <clip pos="2" side="tl" part="lemh"/>
                  <clip pos="2" side="tl" part="a_nom"/>
                  <clip pos="2" side="tl" part="gen"/>
                  <clip pos="2" side="tl" part="nbr"/>
                  <lit-tag v="2.def"/>
                  <clip pos="2" side="tl" part="lemq"/>
                </lu>
		<b pos="1"/>
		<lu>
                  <lit v="tuturor"/>
                  <lit-tag v="predet.def.mf.sp"/>
                  <lit-tag v="2"/>
                </lu>
              </chunk>
            </out>
          </when>
          <otherwise>
            <choose>
              <when>
                <test>
                  <or>
                    <equal>
                      <clip pos="1" side="sl" part="a_det"/>
                      <lit-tag v="det.dem"/>
                    </equal>
                    <equal>
                      <clip pos="1" side="sl" part="a_det"/>
                      <lit-tag v="det.ind"/>
                    </equal>
                  </or>
                </test>
		<call-macro n="mod-gen">
		  <with-param pos="1"/>
		</call-macro>
                <out>
                  <chunk name="det_nom" case="caseFirstWord">
                    <tags>
                      <tag><lit-tag v="SN"/></tag>
		      <tag><var n="caso"/></tag>
                    </tags>
                    <lu>
                      <clip pos="1" side="tl" part="lem"/>
                      <clip pos="1" side="tl" part="a_det"/>
                      <clip pos="1" side="tl" part="gen"/>
                      <clip pos="1" side="tl" part="nbr"/>
                      <lit-tag v="2"/>
                    </lu>
                    <b pos="1"/>
                    <lu>
                      <clip pos="2" side="tl" part="lemh"/>
                      <clip pos="2" side="tl" part="a_nom"/>
                      <clip pos="2" side="tl" part="gen"/>
                      <clip pos="2" side="tl" part="nbr"/>
                      <lit-tag v="nom.def"/>
                      <clip pos="2" side="tl" part="lemq"/>
                    </lu>
                    <b pos="2"/>
                    <lu>
                      <lit v="tuturor"/>
                      <lit-tag v="predet.def.mf.sp"/>
                      <lit-tag v="2"/>
                    </lu>
                  </chunk>
                </out>
              </when>
              <otherwise>
	    <choose>
              <when>
                <test>
                    <equal>
                      <clip pos="1" side="sl" part="a_det"/>
                      <lit-tag v="det.pos"/>
                    </equal>
                </test>
		<call-macro n="mod-gen">
		  <with-param pos="1"/>
		</call-macro>
                <out>
                  <chunk name="nom_adj" case="caseFirstWord">
                    <tags>
                      <tag><lit-tag v="SN"/></tag>
                    </tags>
                    <lu>
                      <clip pos="2" side="tl" part="lemh"/>
                      <clip pos="2" side="tl" part="a_nom"/>
                      <clip pos="2" side="tl" part="gen"/>
                      <clip pos="2" side="tl" part="nbr"/>
                      <lit-tag v="nom.def"/>
                      <clip pos="2" side="tl" part="lemq"/>
                    </lu>
                    <b pos="1"/>
                    <lu>
                      <clip pos="1" side="tl" part="lem"/>
                      <lit-tag v="adj.pos"/>
                      <clip pos="1" side="tl" part="gen"/>
                      <clip pos="1" side="tl" part="nbr"/>
		      <lit-tag v="nom.ind"/>	
                    </lu>
                    <b pos="2"/>
                    <lu>
                      <lit v="tuturor"/>
                      <lit-tag v="predet.def.mf.sp"/>
                      <lit-tag v="2"/>
                    </lu>
                  </chunk>
                </out>
              </when>
            </choose>
            </otherwise>
            </choose>
          </otherwise>
        </choose>
      </action>
    </rule>


    <rule comment="REGLA: a DET NOM de todo">
      <pattern>
        <pattern-item n="a"/>
        <pattern-item n="det"/>
        <pattern-item n="nom"/>
        <pattern-item n="de"/>
        <pattern-item n="todo"/>
      </pattern>
      <action>
        <call-macro n="firstWord">
          <with-param pos="1"/>
        </call-macro>
        <call-macro n="f_concord2">
          <with-param pos="3"/>
          <with-param pos="2"/>
        </call-macro>
<!--
        <let>
          <var n="caso"/>
          <lit-tag v="dg"/>
        </let>
-->
        <choose>
          <when>
            <test>
                <equal>
                  <clip pos="2" side="sl" part="a_det"/>
                  <lit-tag v="det.def"/>
                </equal>
            </test>
            <out>
              <chunk name="nomdef_predet" case="caseFirstWord">
                <tags>
		  <tag><lit-tag v="SN"/></tag>
		  <tag><var n="caso"/></tag>
		</tags>
                <lu>
                  <clip pos="3" side="tl" part="lemh"/>
                  <clip pos="3" side="tl" part="a_nom"/>
                  <clip pos="3" side="tl" part="gen"/>
                  <clip pos="3" side="tl" part="nbr"/>
                  <lit-tag v="2.def"/>
                  <clip pos="3" side="tl" part="lemq"/>
                </lu>
		<b pos="1"/>
		<lu>
                  <lit v="tuturor"/>
                  <lit-tag v="predet.def.mf.sp"/>
                  <lit-tag v="2"/>
                </lu>
              </chunk>
            </out>
          </when>
          <otherwise>
            <choose>
              <when>
                <test>
                  <or>
                    <equal>
                      <clip pos="2" side="sl" part="a_det"/>
                      <lit-tag v="det.dem"/>
                    </equal>
                    <equal>
                      <clip pos="2" side="sl" part="a_det"/>
                      <lit-tag v="det.ind"/>
                    </equal>
                  </or>
                </test>
		<call-macro n="mod-gen">
		  <with-param pos="2"/>
		</call-macro>
                <out>
                  <chunk name="det_nom_predet" case="caseFirstWord">
                    <tags>
                      <tag><lit-tag v="SN"/></tag>
		      <tag><var n="caso"/></tag>
                    </tags>
                    <lu>
                      <clip pos="2" side="tl" part="lem"/>
                      <clip pos="2" side="tl" part="a_det"/>
                      <clip pos="2" side="tl" part="gen"/>
                      <clip pos="2" side="tl" part="nbr"/>
                      <lit-tag v="2"/>
                    </lu>
                    <b pos="1"/>
                    <lu>
                      <clip pos="3" side="tl" part="lemh"/>
                      <clip pos="3" side="tl" part="a_nom"/>
                      <clip pos="3" side="tl" part="gen"/>
                      <clip pos="3" side="tl" part="nbr"/>
                      <lit-tag v="nom.def"/>
                      <clip pos="3" side="tl" part="lemq"/>
                    </lu>
                    <b pos="2"/>
                    <lu>
                      <lit v="tuturor"/>
                      <lit-tag v="predet.def.mf.sp"/>
                      <lit-tag v="2"/>
                    </lu>
                  </chunk>
                </out>
              </when>
              <otherwise>
	    <choose>
              <when>
                <test>
                    <equal>
                      <clip pos="2" side="sl" part="a_det"/>
                      <lit-tag v="det.pos"/>
                    </equal>
                </test>
		<call-macro n="mod-gen">
		  <with-param pos="2"/>
		</call-macro>
                <out>
                  <chunk name="nom_adj_predet" case="caseFirstWord">
                    <tags>
                      <tag><lit-tag v="SN"/></tag>
                    </tags>
                    <lu>
                      <clip pos="3" side="tl" part="lemh"/>
                      <clip pos="3" side="tl" part="a_nom"/>
                      <clip pos="3" side="tl" part="gen"/>
                      <clip pos="3" side="tl" part="nbr"/>
                      <lit-tag v="nom.def"/>
                      <clip pos="3" side="tl" part="lemq"/>
                    </lu>
                    <b pos="1"/>
                    <lu>
                      <clip pos="2" side="tl" part="lem"/>
                      <lit-tag v="adj.pos"/>
                      <clip pos="2" side="tl" part="gen"/>
                      <clip pos="2" side="tl" part="nbr"/>
		      <lit-tag v="nom.ind"/>	
                    </lu>
                    <b pos="2"/>
                    <lu>
                      <lit v="tuturor"/>
                      <lit-tag v="predet.def.mf.sp"/>
                      <lit-tag v="nom"/>
                    </lu>
                  </chunk>
                </out>
              </when>
            </choose>
            </otherwise>
            </choose>
          </otherwise>
        </choose>
      </action>
    </rule>


    <rule comment="REGLA: de DET NOM de todo">
      <pattern>
        <pattern-item n="de"/>
        <pattern-item n="det"/>
        <pattern-item n="nom"/>
        <pattern-item n="de"/>
        <pattern-item n="todo"/>
      </pattern>
      <action>
        <call-macro n="firstWord">
          <with-param pos="1"/>
        </call-macro>
        <call-macro n="f_concord2">
          <with-param pos="3"/>
          <with-param pos="2"/>
        </call-macro>
        <let>
          <var n="caso"/>
          <lit-tag v="dg"/>
        </let>
        <choose>
          <when>
            <test>
                <equal>
                  <clip pos="2" side="sl" part="a_det"/>
                  <lit-tag v="det.def"/>
                </equal>
            </test>
            <out>
              <chunk name="nomdef_predet" case="caseFirstWord">
                <tags>
		  <tag><lit-tag v="SN"/></tag>
		  <tag><var n="caso"/></tag>
		</tags>
                <lu>
                  <clip pos="3" side="tl" part="lemh"/>
                  <clip pos="3" side="tl" part="a_nom"/>
                  <clip pos="3" side="tl" part="gen"/>
                  <clip pos="3" side="tl" part="nbr"/>
                  <lit-tag v="2.def"/>
                  <clip pos="3" side="tl" part="lemq"/>
                </lu>
		<b pos="1"/>
		<lu>
                  <lit v="tuturor"/>
                  <lit-tag v="predet.def.mf.sp"/>
                  <lit-tag v="2"/>
                </lu>
              </chunk>
            </out>
          </when>
          <otherwise>
            <choose>
              <when>
                <test>
                  <or>
                    <equal>
                      <clip pos="2" side="sl" part="a_det"/>
                      <lit-tag v="det.dem"/>
                    </equal>
                    <equal>
                      <clip pos="2" side="sl" part="a_det"/>
                      <lit-tag v="det.ind"/>
                    </equal>
                  </or>
                </test>
		<call-macro n="mod-gen">
		  <with-param pos="2"/>
		</call-macro>
                <out>
                  <chunk name="det_nom_predet" case="caseFirstWord">
                    <tags>
                      <tag><lit-tag v="SN"/></tag>
		      <tag><var n="caso"/></tag>
                    </tags>
                    <lu>
                      <clip pos="2" side="tl" part="lem"/>
                      <clip pos="2" side="tl" part="a_det"/>
                      <clip pos="2" side="tl" part="gen"/>
                      <clip pos="2" side="tl" part="nbr"/>
                      <lit-tag v="2"/>
                    </lu>
                    <b pos="1"/>
                    <lu>
                      <clip pos="3" side="tl" part="lemh"/>
                      <clip pos="3" side="tl" part="a_nom"/>
                      <clip pos="3" side="tl" part="gen"/>
                      <clip pos="3" side="tl" part="nbr"/>
                      <lit-tag v="nom.def"/>
                      <clip pos="3" side="tl" part="lemq"/>
                    </lu>
                    <b pos="2"/>
                    <lu>
                      <lit v="tuturor"/>
                      <lit-tag v="predet.def.mf.sp"/>
                      <lit-tag v="2"/>
                    </lu>
                  </chunk>
                </out>
              </when>
              <otherwise>
	    <choose>
              <when>
                <test>
                    <equal>
                      <clip pos="2" side="sl" part="a_det"/>
                      <lit-tag v="det.pos"/>
                    </equal>
                </test>
		<call-macro n="mod-gen">
		  <with-param pos="2"/>
		</call-macro>
                <out>
                  <chunk name="nom_adj_predet" case="caseFirstWord">
                    <tags>
                      <tag><lit-tag v="SN"/></tag>
                    </tags>
                    <lu>
                      <clip pos="3" side="tl" part="lemh"/>
                      <clip pos="3" side="tl" part="a_nom"/>
                      <clip pos="3" side="tl" part="gen"/>
                      <clip pos="3" side="tl" part="nbr"/>
                      <lit-tag v="nom.def"/>
                      <clip pos="3" side="tl" part="lemq"/>
                    </lu>
                    <b pos="1"/>
                    <lu>
                      <clip pos="2" side="tl" part="lem"/>
                      <lit-tag v="adj.pos"/>
                      <clip pos="2" side="tl" part="gen"/>
                      <clip pos="2" side="tl" part="nbr"/>
		      <lit-tag v="nom.ind"/>	
                    </lu>
                    <b pos="2"/>
                    <lu>
                      <lit v="tuturor"/>
                      <lit-tag v="predet.def.mf.sp"/>
                      <lit-tag v="nom"/>
                    </lu>
                  </chunk>
                </out>
              </when>
            </choose>
            </otherwise>
            </choose>
          </otherwise>
        </choose>
      </action>
    </rule>




    <rule comment="REGLA: todo NOM de DET NOM">
      <pattern>
        <pattern-item n="todo"/>
        <pattern-item n="nom"/>
        <pattern-item n="de"/>
        <pattern-item n="det"/>
        <pattern-item n="nom"/>
      </pattern>
      <action>
        <call-macro n="firstWord">
          <with-param pos="1"/>
        </call-macro>
        <call-macro n="f_concord2">
          <with-param pos="2"/>
          <with-param pos="1"/>
        </call-macro>
        <call-macro n="f_concord2">
          <with-param pos="4"/>
          <with-param pos="5"/>
        </call-macro>
        <call-macro n="mod-gen">
          <with-param pos="1"/>
        </call-macro>
        <call-macro n="mod-gen">
          <with-param pos="4"/>
        </call-macro>
        <choose> <!-- todo conocimiento -->
              <when>
                <test>
                  <!-- ... del niño -->
                  <equal>
                    <clip pos="4" side="sl" part="a_det"/>
                    <lit-tag v="det.def"/>
                  </equal>
                </test>
                <out>
                  <chunk name="predet_det_nom_det_nomdef" case="caseFirstWord">
                    <tags>
                      <tag><lit-tag v="SN"/></tag>
                      <tag><var n="caso"/></tag>
                    </tags>
                    <lu>
                      <clip pos="1" side="tl" part="lemh"/>
                      <clip pos="1" side="tl" part="a_det"/>
                      <clip pos="1" side="tl" part="gen"/>
                      <clip pos="1" side="tl" part="nbr"/>
                      <lit-tag v="2"/>
                      <clip pos="1" side="tl" part="lemq"/>
                    </lu>
                    <b pos="1"/>
                    <lu>
                      <clip pos="2" side="tl" part="lemh"/>
                      <clip pos="2" side="tl" part="a_nom"/>
                      <clip pos="2" side="tl" part="gen"/>
                      <clip pos="2" side="tl" part="nbr"/>
                      <lit-tag v="2.ind"/>
                      <clip pos="2" side="tl" part="lemq"/>
                    </lu>
                    <b pos="2"/>
                    <lu>
                      <lit v="al"/>
                      <lit-tag v="det.def"/>
                      <clip pos="5" side="tl" part="gen"/>
                      <clip pos="5" side="tl" part="nbr"/>
                    </lu>
                    <b pos="3"/>
                    <lu>
                      <clip pos="5" side="tl" part="lemh"/>
                      <clip pos="5" side="tl" part="a_nom"/>
                      <clip pos="5" side="tl" part="gen"/>
                      <clip pos="5" side="tl" part="nbr"/>
                      <lit-tag v="dg.def"/>
                      <clip pos="5" side="tl" part="lemq"/>
                    </lu>
                  </chunk>
                </out>
              </when>
            </choose>
            <choose>
              <when>
                <test>
                  <!-- ...de un niño / ...de este niño -->
                  <or>
                    <equal>
                      <clip pos="4" side="sl" part="a_det"/>
                      <lit-tag v="det.ind"/>
                    </equal>
                    <equal>
                      <clip pos="4" side="sl" part="a_det"/>
                      <lit-tag v="det.dem"/>
                    </equal>
                  </or>
                </test>
		<call-macro n="mod-gen">
		  <with-param pos="4"/>
		</call-macro>
                <out>
                  <chunk name="predet_nom_det_nom" case="caseFirstWord">
                    <tags>
                      <tag><lit-tag v="SN"/></tag>
                      <tag><var n="caso"/></tag>
                    </tags>
                    <lu>
                      <clip pos="1" side="tl" part="lemh"/>
                      <clip pos="1" side="tl" part="a_det"/>
                      <clip pos="1" side="tl" part="gen"/>
                      <clip pos="1" side="tl" part="nbr"/>
                      <lit-tag v="2"/>
                      <clip pos="1" side="tl" part="lemq"/>
                    </lu>
                    <b pos="1"/>
                    <lu>
                      <clip pos="2" side="tl" part="lemh"/>
                      <clip pos="2" side="tl" part="a_nom"/>
                      <clip pos="2" side="tl" part="gen"/>
                      <clip pos="2" side="tl" part="nbr"/>
                      <lit-tag v="2.def"/>
                      <clip pos="2" side="tl" part="lemq"/>
                    </lu>
                    <b pos="2"/>
                    <lu>
                      <clip pos="4" side="tl" part="lem"/>
                      <clip pos="4" side="tl" part="a_det"/>
                      <clip pos="4" side="tl" part="gen"/>
                      <clip pos="4" side="tl" part="nbr"/>
                      <lit-tag v="dg"/>
                    </lu>
                    <b pos="3"/>
                    <lu>
                      <clip pos="5" side="tl" part="lemh"/>
                      <clip pos="5" side="tl" part="a_nom"/>
                      <clip pos="5" side="tl" part="gen"/>
                      <clip pos="5" side="tl" part="nbr"/>
                      <lit-tag v="nom.ind"/>
                      <clip pos="5" side="tl" part="lemq"/>
                    </lu>
                  </chunk>
                </out>
              </when>
            </choose>
            <choose>
              <when>
                <test>
                  <!-- ...de mi niño -->
                  <equal>
                    <clip pos="4" side="sl" part="a_det"/>
                    <lit-tag v="det.pos"/>
                  </equal>
                </test>
                <call-macro n="mod-gen">
                  <with-param pos="4"/>
                </call-macro>
                <out>
                  <chunk name="predet_det_nom_adj" case="caseFirstWord">
                    <tags>
                      <tag><lit-tag v="SN"/></tag>
                      <tag><var n="caso"/></tag>
                    </tags>
                    <lu>
                      <clip pos="1" side="tl" part="lemh"/>
                      <clip pos="1" side="tl" part="a_det"/>
                      <clip pos="1" side="tl" part="gen"/>
                      <clip pos="1" side="tl" part="nbr"/>
                      <lit-tag v="2"/>
                      <clip pos="1" side="tl" part="lemq"/>
                    </lu>
                    <b pos="1"/>
                    <lu>
                      <clip pos="2" side="tl" part="lemh"/>
                      <clip pos="2" side="tl" part="a_nom"/>
                      <clip pos="2" side="tl" part="gen"/>
                      <clip pos="2" side="tl" part="nbr"/>
                      <lit-tag v="2.def"/>
                      <clip pos="2" side="tl" part="lemq"/>
                    </lu>
                    <b pos="2"/>
                    <lu>
                      <clip pos="5" side="tl" part="lemh"/>
                      <clip pos="5" side="tl" part="a_nom"/>
                      <clip pos="5" side="tl" part="gen"/>
                      <clip pos="5" side="tl" part="nbr"/>
                      <lit-tag v="dg.def"/>
                      <clip pos="5" side="tl" part="lemq"/>
                    </lu>
                    <b pos="3"/>
                    <lu>
                      <clip pos="4" side="tl" part="lem"/>
                      <lit-tag v="adj.pos"/>
                      <clip pos="4" side="tl" part="gen"/>
                      <clip pos="4" side="tl" part="nbr"/>
                      <lit-tag v="nom.ind"/>
                    </lu>
                  </chunk>
                </out>
              </when>
        </choose>
      </action>
    </rule>


    <rule comment="REGLA: todo DET NOM de DET NOM">
      <pattern>
        <pattern-item n="todo"/>
        <pattern-item n="det"/>
        <pattern-item n="nom"/>
        <pattern-item n="de"/>
        <pattern-item n="det"/>
        <pattern-item n="nom"/>
      </pattern>
      <action>
        <call-macro n="firstWord">
          <with-param pos="1"/>
        </call-macro>
        <call-macro n="f_concord3">
          <with-param pos="3"/>
          <with-param pos="2"/>
          <with-param pos="1"/>
        </call-macro>
        <call-macro n="f_concord2">
          <with-param pos="5"/>
          <with-param pos="6"/>
        </call-macro>
        <choose>
          <when>
            <test>
              <!-- los jugetes -->
              <equal>
                <clip pos="2" side="sl" part="a_det"/>
                <lit-tag v="det.def"/>
              </equal>
            </test>
            <call-macro n="mod-gen">
              <with-param pos="1"/>
            </call-macro>
            <choose>
              <when>
                <test>
                  <!-- ... del niño -->
                  <equal>
                    <clip pos="5" side="sl" part="a_det"/>
                    <lit-tag v="det.def"/>
                  </equal>
                </test>
                <out>
                  <chunk name="predet_nomdef_nomdef" case="caseFirstWord">
                    <tags>
                      <tag><lit-tag v="SN"/></tag>
                      <tag><var n="caso"/></tag>
                    </tags>
                    <lu>
                      <clip pos="1" side="tl" part="lemh"/>
                      <clip pos="1" side="tl" part="a_det"/>
                      <clip pos="1" side="tl" part="gen"/>
                      <clip pos="1" side="tl" part="nbr"/>
                      <lit-tag v="2"/>
                      <clip pos="1" side="tl" part="lemq"/>
                    </lu>
                    <b pos="1"/>
                    <lu>
                      <clip pos="3" side="tl" part="lemh"/>
                      <clip pos="3" side="tl" part="a_nom"/>
                      <clip pos="3" side="tl" part="gen"/>
                      <clip pos="3" side="tl" part="nbr"/>
                      <lit-tag v="2.def"/>
                      <clip pos="3" side="tl" part="lemq"/>
                    </lu>
                    <b pos="2"/>
                    <lu>
                      <clip pos="6" side="tl" part="lemh"/>
                      <clip pos="6" side="tl" part="a_nom"/>
                      <clip pos="6" side="tl" part="gen"/>
                      <clip pos="6" side="tl" part="nbr"/>
                      <lit-tag v="dg.def"/>
                      <clip pos="6" side="tl" part="lemq"/>
                    </lu>
                  </chunk>
                </out>
              </when>
            </choose>
            <choose>
              <when>
                <test>
                  <!-- ...de un niño / ...de este niño -->
                  <or>
                    <equal>
                      <clip pos="5" side="sl" part="a_det"/>
                      <lit-tag v="det.ind"/>
                    </equal>
                    <equal>
                      <clip pos="5" side="sl" part="a_det"/>
                      <lit-tag v="det.dem"/>
                    </equal>
                  </or>
                </test>
		<call-macro n="mod-gen">
		  <with-param pos="5"/>
		</call-macro>
                <out>
                  <chunk name="predet_nomdef_det_nom" case="caseFirstWord">
                    <tags>
                      <tag><lit-tag v="SN"/></tag>
                      <tag><var n="caso"/></tag>
                    </tags>
                    <lu>
                      <clip pos="1" side="tl" part="lemh"/>
                      <clip pos="1" side="tl" part="a_det"/>
                      <clip pos="1" side="tl" part="gen"/>
                      <clip pos="1" side="tl" part="nbr"/>
                      <lit-tag v="2"/>
                      <clip pos="1" side="tl" part="lemq"/>
                    </lu>
                    <b pos="1"/>
                    <lu>
                      <clip pos="3" side="tl" part="lemh"/>
                      <clip pos="3" side="tl" part="a_nom"/>
                      <clip pos="3" side="tl" part="gen"/>
                      <clip pos="3" side="tl" part="nbr"/>
                      <lit-tag v="2.def"/>
                      <clip pos="3" side="tl" part="lemq"/>
                    </lu>
                    <b pos="2"/>
                    <lu>
                      <clip pos="5" side="tl" part="lem"/>
                      <clip pos="5" side="tl" part="a_det"/>
                      <clip pos="5" side="tl" part="gen"/>
                      <clip pos="5" side="tl" part="nbr"/>
                      <lit-tag v="dg"/>
                    </lu>
                    <b pos="3"/>
                    <lu>
                      <clip pos="6" side="tl" part="lemh"/>
                      <clip pos="6" side="tl" part="a_nom"/>
                      <clip pos="6" side="tl" part="gen"/>
                      <clip pos="6" side="tl" part="nbr"/>
                      <lit-tag v="nom.ind"/>
                      <clip pos="6" side="tl" part="lemq"/>
                    </lu>
                  </chunk>
                </out>
              </when>
            </choose>
            <choose>
              <when>
                <test>
                  <!-- ...de mi niño -->
                  <equal>
                    <clip pos="5" side="sl" part="a_det"/>
                    <lit-tag v="det.pos"/>
                  </equal>
                </test>
                <call-macro n="mod-gen">
                  <with-param pos="5"/>
                </call-macro>
                <out>
                  <chunk name="predet_nomdef_nom_adj" case="caseFirstWord">
                    <tags>
                      <tag><lit-tag v="SN"/></tag>
                      <tag><var n="caso"/></tag>
                    </tags>
                    <lu>
                      <clip pos="1" side="tl" part="lemh"/>
                      <clip pos="1" side="tl" part="a_det"/>
                      <clip pos="1" side="tl" part="gen"/>
                      <clip pos="1" side="tl" part="nbr"/>
                      <lit-tag v="2"/>
                      <clip pos="1" side="tl" part="lemq"/>
                    </lu>
                    <b pos="1"/>
                    <lu>
                      <clip pos="3" side="tl" part="lemh"/>
                      <clip pos="3" side="tl" part="a_nom"/>
                      <clip pos="3" side="tl" part="gen"/>
                      <clip pos="3" side="tl" part="nbr"/>
                      <lit-tag v="2.def"/>
                      <clip pos="3" side="tl" part="lemq"/>
                    </lu>
                    <b pos="2"/>
                    <lu>
                      <clip pos="6" side="tl" part="lemh"/>
                      <clip pos="6" side="tl" part="a_nom"/>
                      <clip pos="6" side="tl" part="gen"/>
                      <clip pos="6" side="tl" part="nbr"/>
                      <lit-tag v="dg.def"/>
                      <clip pos="6" side="tl" part="lemq"/>
                    </lu>
                    <b pos="3"/>
                    <lu>
                      <clip pos="5" side="tl" part="lem"/>
                      <lit-tag v="adj.pos"/>
                      <clip pos="5" side="tl" part="gen"/>
                      <clip pos="5" side="tl" part="nbr"/>
                      <lit-tag v="nom.ind"/>
                    </lu>
                  </chunk>
                </out>
              </when>
            </choose>
          </when>
        </choose>
        <choose>
          <when>
            <test>
              <!-- unos jugetes / estes jugetes -->
              <or>
                <equal>
                  <clip pos="2" side="sl" part="a_det"/>
                  <lit-tag v="det.ind"/>
                </equal>
                <equal>
                  <clip pos="2" side="sl" part="a_det"/>
                  <lit-tag v="det.dem"/>
                </equal>
              </or>
            </test>
            <call-macro n="mod-gen">
              <with-param pos="1"/>
            </call-macro>
            <call-macro n="mod-gen">
              <with-param pos="2"/>
            </call-macro>
            <choose>
              <when>
                <test>
                  <!-- ... del niño -->
                  <equal>
                    <clip pos="5" side="sl" part="a_det"/>
                    <lit-tag v="det.def"/>
                  </equal>
                </test>
                <out>
                  <chunk name="predet_det_nom_nomdef" case="caseFirstWord">
                    <tags>
                      <tag><lit-tag v="SN"/></tag>
                      <tag><var n="caso"/></tag>
                    </tags>
                    <lu>
                      <clip pos="1" side="tl" part="lemh"/>
                      <clip pos="1" side="tl" part="a_det"/>
                      <clip pos="1" side="tl" part="gen"/>
                      <clip pos="1" side="tl" part="nbr"/>
                      <lit-tag v="2"/>
                      <clip pos="1" side="tl" part="lemq"/>
                    </lu>
                    <b pos="1"/>
                    <lu>
                      <clip pos="2" side="tl" part="lemh"/>
                      <clip pos="2" side="tl" part="a_det"/>
                      <clip pos="2" side="tl" part="gen"/>
                      <clip pos="2" side="tl" part="nbr"/>
                      <lit-tag v="2"/>
                      <clip pos="2" side="tl" part="lemq"/>
                    </lu>
                    <b pos="2"/>
                    <lu>
                      <clip pos="3" side="tl" part="lemh"/>
                      <clip pos="3" side="tl" part="a_nom"/>
                      <clip pos="3" side="tl" part="gen"/>
                      <clip pos="3" side="tl" part="nbr"/>
                      <lit-tag v="2.ind"/>
                      <clip pos="3" side="tl" part="lemq"/>
                    </lu>
                    <b pos="3"/>
                    <lu>
                      <clip pos="6" side="tl" part="lemh"/>
                      <clip pos="6" side="tl" part="a_nom"/>
                      <clip pos="6" side="tl" part="gen"/>
                      <clip pos="6" side="tl" part="nbr"/>
                      <lit-tag v="dg.def"/>
                      <clip pos="6" side="tl" part="lemq"/>
                    </lu>
                  </chunk>
                </out>
              </when>
            </choose>
            <choose>
              <when>
                <test>
                  <!-- ...de un niño / ...de este niño -->
                  <or>
                    <equal>
                      <clip pos="5" side="sl" part="a_det"/>
                      <lit-tag v="det.ind"/>
                    </equal>
                    <equal>
                      <clip pos="5" side="sl" part="a_det"/>
                      <lit-tag v="det.dem"/>
                    </equal>
                  </or>
                </test>
		<call-macro n="mod-gen">
		  <with-param pos="5"/>
		</call-macro>
                <out>
                  <chunk name="predet_det_nom_det_nom" case="caseFirstWord">
                    <tags>
                      <tag><lit-tag v="SN"/></tag>
                      <tag><var n="caso"/></tag>
                    </tags>
                    <lu>
                      <clip pos="1" side="tl" part="lemh"/>
                      <clip pos="1" side="tl" part="a_det"/>
                      <clip pos="1" side="tl" part="gen"/>
                      <clip pos="1" side="tl" part="nbr"/>
                      <lit-tag v="2"/>
                      <clip pos="1" side="tl" part="lemq"/>
                    </lu>
                    <b pos="1"/>
                    <lu>
                      <clip pos="2" side="tl" part="lemh"/>
                      <clip pos="2" side="tl" part="a_det"/>
                      <clip pos="2" side="tl" part="gen"/>
                      <clip pos="2" side="tl" part="nbr"/>
                      <lit-tag v="2"/>
                      <clip pos="2" side="tl" part="lemq"/>
                    </lu>
                    <b pos="2"/>
                    <lu>
                      <clip pos="3" side="tl" part="lemh"/>
                      <clip pos="3" side="tl" part="a_nom"/>
                      <clip pos="3" side="tl" part="gen"/>
                      <clip pos="3" side="tl" part="nbr"/>
                      <lit-tag v="2.def"/>
                      <clip pos="3" side="tl" part="lemq"/>
                    </lu>
                    <b pos="3"/>
                    <lu>
                      <clip pos="5" side="tl" part="lem"/>
                      <clip pos="5" side="tl" part="a_det"/>
                      <clip pos="5" side="tl" part="gen"/>
                      <clip pos="5" side="tl" part="nbr"/>
                      <lit-tag v="dg"/>
                    </lu>
                    <b pos="4"/>
                    <lu>
                      <clip pos="6" side="tl" part="lemh"/>
                      <clip pos="6" side="tl" part="a_nom"/>
                      <clip pos="6" side="tl" part="gen"/>
                      <clip pos="6" side="tl" part="nbr"/>
                      <lit-tag v="nom.ind"/>
                      <clip pos="6" side="tl" part="lemq"/>
                    </lu>
                  </chunk>
                </out>
              </when>
            </choose>
            <choose>
              <when>
                <test>
                  <!-- ...de mi niño -->
                  <equal>
                    <clip pos="5" side="sl" part="a_det"/>
                    <lit-tag v="det.pos"/>
                  </equal>
                </test>
                <call-macro n="mod-gen">
                  <with-param pos="5"/>
                </call-macro>
                <out>
                  <chunk name="predet_det_nom_nom_adj" case="caseFirstWord">
                    <tags>
                      <tag><lit-tag v="SN"/></tag>
                      <tag><var n="caso"/></tag>
                    </tags>
                    <lu>
                      <clip pos="1" side="tl" part="lemh"/>
                      <clip pos="1" side="tl" part="a_det"/>
                      <clip pos="1" side="tl" part="gen"/>
                      <clip pos="1" side="tl" part="nbr"/>
                      <lit-tag v="2"/>
                      <clip pos="1" side="tl" part="lemq"/>
                    </lu>
                    <b pos="1"/>
                    <lu>
                      <clip pos="2" side="tl" part="lemh"/>
                      <clip pos="2" side="tl" part="a_det"/>
                      <clip pos="2" side="tl" part="gen"/>
                      <clip pos="2" side="tl" part="nbr"/>
                      <lit-tag v="2"/>
                      <clip pos="2" side="tl" part="lemq"/>
                    </lu>
                    <b pos="2"/>
                    <lu>
                      <clip pos="3" side="tl" part="lemh"/>
                      <clip pos="3" side="tl" part="a_nom"/>
                      <clip pos="3" side="tl" part="gen"/>
                      <clip pos="3" side="tl" part="nbr"/>
                      <lit-tag v="2.def"/>
                      <clip pos="3" side="tl" part="lemq"/>
                    </lu>
                    <b pos="3"/>
                    <lu>
                      <clip pos="6" side="tl" part="lemh"/>
                      <clip pos="6" side="tl" part="a_nom"/>
                      <clip pos="6" side="tl" part="gen"/>
                      <clip pos="6" side="tl" part="nbr"/>
                      <lit-tag v="dg.def"/>
                      <clip pos="6" side="tl" part="lemq"/>
                    </lu>
                    <b pos="4"/>
                    <lu>
                      <clip pos="5" side="tl" part="lem"/>
                      <lit-tag v="adj.pos"/>
                      <clip pos="5" side="tl" part="gen"/>
                      <clip pos="5" side="tl" part="nbr"/>
                      <lit-tag v="nom.ind"/>
                    </lu>
                  </chunk>
                </out>
              </when>
            </choose>
          </when>
        </choose>
        <choose>
          <when>
            <test>
              <!-- mis jugetes -->
              <equal>
                <clip pos="2" side="sl" part="a_det"/>
                <lit-tag v="det.pos"/>
              </equal>
            </test>
            <call-macro n="mod-gen">
              <with-param pos="2"/>
            </call-macro>
            <call-macro n="mod-gen">
              <with-param pos="1"/>
            </call-macro>
            <choose>
              <when>
                <test>
                  <!-- ... del niño -->
                  <equal>
                    <clip pos="5" side="sl" part="a_det"/>
                    <lit-tag v="det.def"/>
                  </equal>
                </test>
                <out>
                  <chunk name="predet_nomdef_adj_nomdef" case="caseFirstWord">
                    <tags>
                      <tag><lit-tag v="SN"/></tag>
                      <tag><var n="caso"/></tag>
                    </tags>
                    <lu>
                      <clip pos="1" side="tl" part="lemh"/>
                      <clip pos="1" side="tl" part="a_det"/>
                      <clip pos="1" side="tl" part="gen"/>
                      <clip pos="1" side="tl" part="nbr"/>
                      <lit-tag v="2"/>
                      <clip pos="1" side="tl" part="lemq"/>
                    </lu>
                    <b pos="1"/>
                    <lu>
                      <clip pos="3" side="tl" part="lemh"/>
                      <clip pos="3" side="tl" part="a_nom"/>
                      <clip pos="3" side="tl" part="gen"/>
                      <clip pos="3" side="tl" part="nbr"/>
                      <lit-tag v="2.def"/>
                      <clip pos="3" side="tl" part="lemq"/>
                    </lu>
                    <b pos="2"/>
                    <lu>
                      <clip pos="2" side="tl" part="lem"/>
                      <lit-tag v="adj.pos"/>
                      <clip pos="2" side="tl" part="gen"/>
                      <clip pos="2" side="tl" part="nbr"/>
                      <lit-tag v="nom.ind"/>
                    </lu>
                    <b pos="3"/>
                    <lu>
                      <clip pos="6" side="tl" part="lemh"/>
                      <clip pos="6" side="tl" part="a_nom"/>
                      <clip pos="6" side="tl" part="gen"/>
                      <clip pos="6" side="tl" part="nbr"/>
                      <lit-tag v="dg.def"/>
                      <clip pos="6" side="tl" part="lemq"/>
                    </lu>
                  </chunk>
                </out>
              </when>
            </choose>
            <choose>
              <when>
                <test>
                  <!-- ...de un niño / ...de este niño -->
                  <or>
                    <equal>
                      <clip pos="5" side="sl" part="a_det"/>
                      <lit-tag v="det.ind"/>
                    </equal>
                    <equal>
                      <clip pos="5" side="sl" part="a_det"/>
                      <lit-tag v="det.dem"/>
                    </equal>
                  </or>
                </test>
		<call-macro n="mod-gen">
		  <with-param pos="5"/>
		</call-macro>
                <out>
                  <chunk name="predet_nomdef_adj_det_nom" case="caseFirstWord">
                    <tags>
                      <tag><lit-tag v="SN"/></tag>
                      <tag><var n="caso"/></tag>
                    </tags>
                    <lu>
                      <clip pos="1" side="tl" part="lemh"/>
                      <clip pos="1" side="tl" part="a_det"/>
                      <clip pos="1" side="tl" part="gen"/>
                      <clip pos="1" side="tl" part="nbr"/>
                      <lit-tag v="2"/>
                      <clip pos="1" side="tl" part="lemq"/>
                    </lu>
                    <b pos="1"/>
                    <lu>
                      <clip pos="3" side="tl" part="lemh"/>
                      <clip pos="3" side="tl" part="a_nom"/>
                      <clip pos="3" side="tl" part="gen"/>
                      <clip pos="3" side="tl" part="nbr"/>
                      <lit-tag v="2.def"/>
                      <clip pos="3" side="tl" part="lemq"/>
                    </lu>
                    <b pos="2"/>
                    <lu>
                      <clip pos="2" side="tl" part="lem"/>
                      <lit-tag v="adj.pos"/>
                      <clip pos="2" side="tl" part="gen"/>
                      <clip pos="2" side="tl" part="nbr"/>
                      <lit-tag v="nom.ind"/>
                    </lu>
                    <b pos="3"/>
                    <lu>
                      <clip pos="5" side="tl" part="lem"/>
                      <clip pos="5" side="tl" part="a_det"/>
                      <clip pos="5" side="tl" part="gen"/>
                      <clip pos="5" side="tl" part="nbr"/>
                      <lit-tag v="dg"/>
                    </lu>
                    <b pos="4"/>
                    <lu>
                      <clip pos="6" side="tl" part="lemh"/>
                      <clip pos="6" side="tl" part="a_nom"/>
                      <clip pos="6" side="tl" part="gen"/>
                      <clip pos="6" side="tl" part="nbr"/>
                      <lit-tag v="nom.ind"/>
                      <clip pos="6" side="tl" part="lemq"/>
                    </lu>
                  </chunk>
                </out>
              </when>
            </choose>
            <choose>
              <when>
                <test>
                  <!-- ...de mi niño -->
                  <equal>
                    <clip pos="5" side="sl" part="a_det"/>
                    <lit-tag v="det.pos"/>
                  </equal>
                </test>
                <call-macro n="mod-gen">
                  <with-param pos="5"/>
                </call-macro>
                <out>
                  <chunk name="predet_nomdef_adj_nomdef_adj" case="caseFirstWord">
                    <tags>
                      <tag><lit-tag v="SN"/></tag>
                      <tag><var n="caso"/></tag>
                    </tags>
                    <lu>
                      <clip pos="1" side="tl" part="lemh"/>
                      <clip pos="1" side="tl" part="a_det"/>
                      <clip pos="1" side="tl" part="gen"/>
                      <clip pos="1" side="tl" part="nbr"/>
                      <lit-tag v="2"/>
                      <clip pos="1" side="tl" part="lemq"/>
                    </lu>
                    <b pos="1"/>
                    <lu>
                      <clip pos="3" side="tl" part="lemh"/>
                      <clip pos="3" side="tl" part="a_nom"/>
                      <clip pos="3" side="tl" part="gen"/>
                      <clip pos="3" side="tl" part="nbr"/>
                      <lit-tag v="2.def"/>
                      <clip pos="3" side="tl" part="lemq"/>
                    </lu>
                    <b pos="2"/>
                    <lu>
                      <clip pos="2" side="tl" part="lem"/>
                      <lit-tag v="adj.pos"/>
                      <clip pos="2" side="tl" part="gen"/>
                      <clip pos="2" side="tl" part="nbr"/>
                      <lit-tag v="nom.ind"/>
                    </lu>
                    <b pos="3"/>
                    <lu>
                      <clip pos="6" side="tl" part="lemh"/>
                      <clip pos="6" side="tl" part="a_nom"/>
                      <clip pos="6" side="tl" part="gen"/>
                      <clip pos="6" side="tl" part="nbr"/>
                      <lit-tag v="dg.def"/>
                      <clip pos="6" side="tl" part="lemq"/>
                    </lu>
                    <b pos="4"/>
                    <lu>
                      <clip pos="5" side="tl" part="lem"/>
                      <lit-tag v="adj.pos"/>
                      <clip pos="5" side="tl" part="gen"/>
                      <clip pos="5" side="tl" part="nbr"/>
                      <lit-tag v="nom.ind"/>
                    </lu>
                  </chunk>
                </out>
              </when>
            </choose>
          </when>
        </choose>
      </action>
    </rule>


    <rule comment="REGLA: DET NUM NOM">
      <pattern>
        <pattern-item n="det"/>
        <pattern-item n="num"/>
        <pattern-item n="nom"/>
      </pattern>
      <action>
        <call-macro n="firstWord">
          <with-param pos="1"/>
        </call-macro>
        <call-macro n="f_concord2">
          <with-param pos="3"/>
          <with-param pos="1"/>
        </call-macro>
        <choose>
          <when>
            <test>
                <equal>
                  <clip pos="1" side="sl" part="a_det"/>
                  <lit-tag v="det.def"/>
                </equal>
            </test>
		<call-macro n="mod-gen">
		  <with-param pos="1"/>
		</call-macro>
            <out>
              <chunk name="det_num_nom" case="caseFirstWord">
                <tags>
		  <tag><lit-tag v="SN"/></tag>
		  <tag><var n="caso"/></tag>
		</tags>
                <lu>
                  <lit v="cel"/>
		  <clip pos="1" side="tl" part="a_det"/>
                  <clip pos="1" side="tl" part="gen"/> 
                  <clip pos="1" side="tl" part="nbr"/> 
                  <lit-tag v="2"/>
                </lu>
                <b pos="1"/>
                <lu>
                  <clip pos="2" side="tl" part="lemh"/>
                  <clip pos="2" side="tl" part="a_num"/>
                  <clip pos="2" side="tl" part="gen"/>
                  <clip pos="2" side="tl" part="nbr"/>
                  <clip pos="2" side="tl" part="lemq"/>
                </lu>
                <b pos="2"/>
                <lu>
                  <clip pos="3" side="tl" part="lemh"/>
                  <clip pos="3" side="tl" part="a_nom"/>
                  <clip pos="3" side="tl" part="gen"/>
                  <clip pos="3" side="tl" part="nbr"/>
                  <lit-tag v="2.ind"/>
                  <clip pos="3" side="tl" part="lemq"/>
                </lu>
              </chunk>
            </out>
          </when>
          <otherwise>
            <choose>
              <when>
                <test>
                  <or>
                    <equal>
                      <clip pos="1" side="sl" part="a_det"/>
                      <lit-tag v="det.dem"/>
                    </equal>
                    <equal>
                      <clip pos="1" side="sl" part="a_det"/>
                      <lit-tag v="det.ind"/>
                    </equal>
                  </or>
                </test>
		<call-macro n="mod-gen">
		  <with-param pos="1"/>
		</call-macro>
                <out>
                  <chunk name="det_num_nom" case="caseFirstWord">
                    <tags>
                      <tag><lit-tag v="SN"/></tag>
		      <tag><var n="caso"/></tag>
                    </tags>
                    <lu>
                      <clip pos="1" side="tl" part="lem"/>
                      <clip pos="1" side="tl" part="a_det"/>
                      <clip pos="1" side="tl" part="gen"/>
                      <clip pos="1" side="tl" part="nbr"/>
                      <lit-tag v="2"/>
                    </lu>
                    <b pos="1"/>
                    <lu>
                      <clip pos="2" side="tl" part="lemh"/>
                      <clip pos="2" side="tl" part="a_num"/>
                      <clip pos="2" side="tl" part="gen"/>
                      <clip pos="2" side="tl" part="nbr"/>
                      <clip pos="2" side="tl" part="lemq"/>
                    </lu>
                    <b pos="2"/>
                    <lu>
                      <clip pos="3" side="tl" part="lemh"/>
                      <clip pos="3" side="tl" part="a_nom"/>
                      <clip pos="3" side="tl" part="gen"/>
                      <clip pos="3" side="tl" part="nbr"/>
                      <lit-tag v="nom.ind"/>
                      <clip pos="3" side="tl" part="lemq"/>
                    </lu>
                  </chunk>
                </out>
              </when>
              <otherwise>
	    <choose>
              <when>
                <test>
                    <equal>
                      <clip pos="1" side="sl" part="a_det"/>
                      <lit-tag v="det.pos"/>
                    </equal>
                </test>
		<call-macro n="mod-gen">
		  <with-param pos="1"/>
		</call-macro>
                <out>
                  <chunk name="det_num_nom_adj" case="caseFirstWord">
                    <tags>
                      <tag><lit-tag v="SN"/></tag>
                    </tags>
                    <lu>
                      <lit v="cel"/>
		      <lit-tag v="det.def"/>
                      <clip pos="1" side="tl" part="gen"/> 
                      <clip pos="1" side="tl" part="nbr"/> 
                      <lit-tag v="nom"/>
                    </lu>
		    <b pos="1"/>
                    <lu>
                      <clip pos="2" side="tl" part="lemh"/>
                      <clip pos="2" side="tl" part="a_num"/>
                      <clip pos="2" side="tl" part="gen"/>
                      <clip pos="2" side="tl" part="nbr"/>
                      <clip pos="2" side="tl" part="lemq"/>
                    </lu>
                    <b pos="2"/>
                    <lu>
                      <clip pos="3" side="tl" part="lemh"/>
                      <clip pos="3" side="tl" part="a_nom"/>
                      <clip pos="3" side="tl" part="gen"/>
                      <clip pos="3" side="tl" part="nbr"/>
                      <lit-tag v="nom.def"/>
                      <clip pos="3" side="tl" part="lemq"/>
                    </lu>
                    <b/>
                    <lu>
                      <clip pos="1" side="tl" part="lem"/>
                      <lit-tag v="adj.pos"/>
                      <clip pos="1" side="tl" part="gen"/>
                      <clip pos="1" side="tl" part="nbr"/>
		      <lit-tag v="nom.ind"/>	
                    </lu>
                  </chunk>
                </out>
              </when>
            </choose>
            </otherwise>
            </choose>
          </otherwise>
        </choose>
      </action>
    </rule>

    <rule comment="REGLA: DET NUM ADJ NOM">
      <pattern>
        <pattern-item n="det"/>
        <pattern-item n="num"/>
        <pattern-item n="adjec"/>
        <pattern-item n="nom"/>
      </pattern>
      <action>
        <call-macro n="firstWord">
          <with-param pos="1"/>
        </call-macro>
        <call-macro n="f_concord2">
          <with-param pos="4"/>
          <with-param pos="1"/>
        </call-macro>
        <choose>
          <when>
            <test>
                <equal>
                  <clip pos="1" side="sl" part="a_det"/>
                  <lit-tag v="det.def"/>
                </equal>
            </test>
		<call-macro n="mod-gen">
		  <with-param pos="1"/>
		</call-macro>
		<call-macro n="mod-gen">
		  <with-param pos="3"/>
		</call-macro>
            <out>
              <chunk name="det_num_adj_nom" case="caseFirstWord">
                <tags>
		  <tag><lit-tag v="SN"/></tag>
		  <tag><var n="caso"/></tag>
		</tags>
                <lu>
                  <lit v="cel"/>
		  <clip pos="1" side="tl" part="a_det"/>
                  <clip pos="1" side="tl" part="gen"/> 
                  <clip pos="1" side="tl" part="nbr"/> 
                  <lit-tag v="2"/>
                </lu>
                <b pos="1"/>
                <lu>
                  <clip pos="2" side="tl" part="lemh"/>
                  <clip pos="2" side="tl" part="a_num"/>
                  <clip pos="2" side="tl" part="gen"/>
                  <clip pos="2" side="tl" part="nbr"/>
                  <clip pos="2" side="tl" part="lemq"/>
                </lu>
                <b pos="2"/>
                <lu>
                  <clip pos="3" side="tl" part="lemh"/>
                  <clip pos="3" side="tl" part="a_adj"/>
                  <clip pos="3" side="tl" part="gen"/>
                  <clip pos="3" side="tl" part="nbr"/>
                  <lit-tag v="2.ind"/>
                  <clip pos="3" side="tl" part="lemq"/>
                </lu>
                <b pos="3"/>
                <lu>
                  <clip pos="4" side="tl" part="lemh"/>
                  <clip pos="4" side="tl" part="a_nom"/>
                  <clip pos="4" side="tl" part="gen"/>
                  <clip pos="4" side="tl" part="nbr"/>
                  <lit-tag v="2.ind"/>
                  <clip pos="4" side="tl" part="lemq"/>
                </lu>

              </chunk>
            </out>
          </when>
          <otherwise>
            <choose>
              <when>
                <test>
                  <or>
                    <equal>
                      <clip pos="1" side="sl" part="a_det"/>
                      <lit-tag v="det.dem"/>
                    </equal>
                    <equal>
                      <clip pos="1" side="sl" part="a_det"/>
                      <lit-tag v="det.ind"/>
                    </equal>
                  </or>
                </test>
		<call-macro n="mod-gen">
		  <with-param pos="1"/>
		</call-macro>
		<call-macro n="mod-gen">
		  <with-param pos="3"/>
		</call-macro>
                <out>
                  <chunk name="det_num_adj_nom" case="caseFirstWord">
                    <tags>
                      <tag><lit-tag v="SN"/></tag>
		      <tag><var n="caso"/></tag>
                    </tags>
                    <lu>
                      <clip pos="1" side="tl" part="lem"/>
                      <clip pos="1" side="tl" part="a_det"/>
                      <clip pos="1" side="tl" part="gen"/>
                      <clip pos="1" side="tl" part="nbr"/>
                      <lit-tag v="2"/>
                    </lu>
                    <b pos="1"/>
                    <lu>
                      <clip pos="2" side="tl" part="lemh"/>
                      <clip pos="2" side="tl" part="a_num"/>
                      <clip pos="2" side="tl" part="gen"/>
                      <clip pos="2" side="tl" part="nbr"/>
                      <clip pos="2" side="tl" part="lemq"/>
                    </lu>
                    <b pos="2"/>
                    <lu>
                      <clip pos="3" side="tl" part="lemh"/>
                      <clip pos="4" side="tl" part="a_adj"/>
                      <clip pos="4" side="tl" part="gen"/>
                      <clip pos="4" side="tl" part="nbr"/>
                      <lit-tag v="nom.ind"/>
                      <clip pos="4" side="tl" part="lemq"/>
                    </lu>
                    <b pos="3"/>
                    <lu>
                      <clip pos="4" side="tl" part="lemh"/>
                      <clip pos="4" side="tl" part="a_nom"/>
                      <clip pos="4" side="tl" part="gen"/>
                      <clip pos="4" side="tl" part="nbr"/>
                      <lit-tag v="nom.ind"/>
                      <clip pos="4" side="tl" part="lemq"/>
                    </lu>

                  </chunk>
                </out>
              </when>
              <otherwise>
	    <choose>
              <when>
                <test>
                    <equal>
                      <clip pos="1" side="sl" part="a_det"/>
                      <lit-tag v="det.pos"/>
                    </equal>
                </test>
		<call-macro n="mod-gen">
		  <with-param pos="1"/>
		</call-macro>
		<call-macro n="mod-gen">
		  <with-param pos="3"/>
		</call-macro>
                <out>
                  <chunk name="det_num_adj_nom_adj" case="caseFirstWord">
                    <tags>
                      <tag><lit-tag v="SN"/></tag>
                    </tags>
                    <lu>
                      <lit v="cel"/>
		      <lit-tag v="det.def"/>
                      <clip pos="1" side="tl" part="gen"/> 
                      <clip pos="1" side="tl" part="nbr"/> 
                      <lit-tag v="nom"/>
                    </lu>
		    <b pos="1"/>
                    <lu>
                      <clip pos="2" side="tl" part="lemh"/>
                      <clip pos="2" side="tl" part="a_num"/>
                      <clip pos="2" side="tl" part="gen"/>
                      <clip pos="2" side="tl" part="nbr"/>
                      <clip pos="2" side="tl" part="lemq"/>
                    </lu>
                    <b pos="2"/>
                    <lu>
                      <clip pos="3" side="tl" part="lemh"/>
                      <clip pos="3" side="tl" part="a_adj"/>
                      <clip pos="3" side="tl" part="gen"/>
                      <clip pos="3" side="tl" part="nbr"/>
                      <lit-tag v="nom.ind"/>
                      <clip pos="3" side="tl" part="lemq"/>
                    </lu>
                    <b pos="3"/>
                    <lu>
                      <clip pos="4" side="tl" part="lemh"/>
                      <clip pos="4" side="tl" part="a_nom"/>
                      <clip pos="4" side="tl" part="gen"/>
                      <clip pos="4" side="tl" part="nbr"/>
                      <lit-tag v="nom.def"/>
                      <clip pos="4" side="tl" part="lemq"/>
                    </lu>
                    <b/>
                    <lu>
                      <clip pos="1" side="tl" part="lem"/>
                      <lit-tag v="adj.pos"/>
                      <clip pos="1" side="tl" part="gen"/>
                      <clip pos="1" side="tl" part="nbr"/>
		      <lit-tag v="nom.ind"/>	
                    </lu>

                  </chunk>
                </out>
              </when>
            </choose>
            </otherwise>
            </choose>
          </otherwise>
        </choose>
      </action>
    </rule>




    <rule comment="REGLA: DET NUM NOM ADJ">
      <pattern>
        <pattern-item n="det"/>
        <pattern-item n="num"/>
        <pattern-item n="nom"/>
        <pattern-item n="adjec"/>
      </pattern>
      <action>
        <call-macro n="firstWord">
          <with-param pos="1"/>
        </call-macro>
        <call-macro n="f_concord2">
          <with-param pos="3"/>
          <with-param pos="1"/>
        </call-macro>
        <choose>
          <when>
            <test>
                <equal>
                  <clip pos="1" side="sl" part="a_det"/>
                  <lit-tag v="det.def"/>
                </equal>
            </test>
		<call-macro n="mod-gen">
		  <with-param pos="1"/>
		</call-macro>
		<call-macro n="mod-gen">
		  <with-param pos="4"/>
		</call-macro>
            <out>
              <chunk name="det_num_nom_adj" case="caseFirstWord">
                <tags>
		  <tag><lit-tag v="SN"/></tag>
		  <tag><var n="caso"/></tag>
		</tags>
                <lu>
                  <lit v="cel"/>
		  <clip pos="1" side="tl" part="a_det"/>
                  <clip pos="1" side="tl" part="gen"/> 
                  <clip pos="1" side="tl" part="nbr"/> 
                  <lit-tag v="2"/>
                </lu>
                <b pos="1"/>
                <lu>
                  <clip pos="2" side="tl" part="lemh"/>
                  <clip pos="2" side="tl" part="a_num"/>
                  <clip pos="2" side="tl" part="gen"/>
                  <clip pos="2" side="tl" part="nbr"/>
                  <clip pos="2" side="tl" part="lemq"/>
                </lu>
                <b pos="2"/>
                <lu>
                  <clip pos="3" side="tl" part="lemh"/>
                  <clip pos="3" side="tl" part="a_nom"/>
                  <clip pos="3" side="tl" part="gen"/>
                  <clip pos="3" side="tl" part="nbr"/>
                  <lit-tag v="2.ind"/>
                  <clip pos="3" side="tl" part="lemq"/>
                </lu>
                <b pos="3"/>
                <lu>
                  <clip pos="4" side="tl" part="lemh"/>
                  <clip pos="4" side="tl" part="a_adj"/>
                  <clip pos="4" side="tl" part="gen"/>
                  <clip pos="4" side="tl" part="nbr"/>
                  <lit-tag v="2.ind"/>
                  <clip pos="4" side="tl" part="lemq"/>
                </lu>

              </chunk>
            </out>
          </when>
          <otherwise>
            <choose>
              <when>
                <test>
                  <or>
                    <equal>
                      <clip pos="1" side="sl" part="a_det"/>
                      <lit-tag v="det.dem"/>
                    </equal>
                    <equal>
                      <clip pos="1" side="sl" part="a_det"/>
                      <lit-tag v="det.ind"/>
                    </equal>
                  </or>
                </test>
		<call-macro n="mod-gen">
		  <with-param pos="1"/>
		</call-macro>
		<call-macro n="mod-gen">
		  <with-param pos="4"/>
		</call-macro>
                <out>
                  <chunk name="det_num_nom_adj" case="caseFirstWord">
                    <tags>
                      <tag><lit-tag v="SN"/></tag>
		      <tag><var n="caso"/></tag>
                    </tags>
                    <lu>
                      <clip pos="1" side="tl" part="lem"/>
                      <clip pos="1" side="tl" part="a_det"/>
                      <clip pos="1" side="tl" part="gen"/>
                      <clip pos="1" side="tl" part="nbr"/>
                      <lit-tag v="2"/>
                    </lu>
                    <b pos="1"/>
                    <lu>
                      <clip pos="2" side="tl" part="lemh"/>
                      <clip pos="2" side="tl" part="a_num"/>
                      <clip pos="2" side="tl" part="gen"/>
                      <clip pos="2" side="tl" part="nbr"/>
                      <clip pos="2" side="tl" part="lemq"/>
                    </lu>
                    <b pos="2"/>
                    <lu>
                      <clip pos="3" side="tl" part="lemh"/>
                      <clip pos="3" side="tl" part="a_nom"/>
                      <clip pos="3" side="tl" part="gen"/>
                      <clip pos="3" side="tl" part="nbr"/>
                      <lit-tag v="nom.ind"/>
                      <clip pos="3" side="tl" part="lemq"/>
                    </lu>
                    <b pos="3"/>
                    <lu>
                      <clip pos="4" side="tl" part="lemh"/>
                      <clip pos="4" side="tl" part="a_adj"/>
                      <clip pos="4" side="tl" part="gen"/>
                      <clip pos="4" side="tl" part="nbr"/>
                      <lit-tag v="nom.ind"/>
                      <clip pos="4" side="tl" part="lemq"/>
                    </lu>

                  </chunk>
                </out>
              </when>
              <otherwise>
	    <choose>
              <when>
                <test>
                    <equal>
                      <clip pos="1" side="sl" part="a_det"/>
                      <lit-tag v="det.pos"/>
                    </equal>
                </test>
		<call-macro n="mod-gen">
		  <with-param pos="1"/>
		</call-macro>
		<call-macro n="mod-gen">
		  <with-param pos="4"/>
		</call-macro>
                <out>
                  <chunk name="det_num_nom_adj_adj" case="caseFirstWord">
                    <tags>
                      <tag><lit-tag v="SN"/></tag>
                    </tags>
                    <lu>
                      <lit v="cel"/>
		      <lit-tag v="det.def"/>
                      <clip pos="1" side="tl" part="gen"/> 
                      <clip pos="1" side="tl" part="nbr"/> 
                      <lit-tag v="nom"/>
                    </lu>
		    <b pos="1"/>
                    <lu>
                      <clip pos="2" side="tl" part="lemh"/>
                      <clip pos="2" side="tl" part="a_num"/>
                      <clip pos="2" side="tl" part="gen"/>
                      <clip pos="2" side="tl" part="nbr"/>
                      <clip pos="2" side="tl" part="lemq"/>
                    </lu>
                    <b pos="2"/>
                    <lu>
                      <clip pos="3" side="tl" part="lemh"/>
                      <clip pos="3" side="tl" part="a_nom"/>
                      <clip pos="3" side="tl" part="gen"/>
                      <clip pos="3" side="tl" part="nbr"/>
                      <lit-tag v="nom.def"/>
                      <clip pos="3" side="tl" part="lemq"/>
                    </lu>
                    <b pos="3"/>
                    <lu>
                      <clip pos="1" side="tl" part="lem"/>
                      <lit-tag v="adj.pos"/>
                      <clip pos="1" side="tl" part="gen"/>
                      <clip pos="1" side="tl" part="nbr"/>
		      <lit-tag v="nom.ind"/>	
                    </lu>
                    <b/>
                    <lu>
                      <clip pos="4" side="tl" part="lemh"/>
                      <clip pos="4" side="tl" part="a_adj"/>
                      <clip pos="4" side="tl" part="gen"/>
                      <clip pos="4" side="tl" part="nbr"/>
                      <lit-tag v="nom.ind"/>
                      <clip pos="4" side="tl" part="lemq"/>
                    </lu>

                  </chunk>
                </out>
              </when>
            </choose>
            </otherwise>
            </choose>
          </otherwise>
        </choose>
      </action>
    </rule>



    <rule comment="REGLA: NUM NOM">
      <pattern>
        <pattern-item n="num"/>
        <pattern-item n="nom"/>
      </pattern>
      <action>
        <call-macro n="firstWord">
          <with-param pos="1"/>
        </call-macro>
        <call-macro n="f_concord2">
          <with-param pos="2"/>
	  <with-param pos="1"/>
        </call-macro>
		  <out>
        	    <chunk name="num_nom" case="caseFirstWord">
        	      <tags>
        	        <tag><lit-tag v="SN"/></tag>
	  	        <tag><var n="caso"/></tag>
        	      </tags>
        	      <lu>
        	        <clip pos="1" side="tl" part="lem"/>
        	        <clip pos="1" side="tl" part="a_num"/>
                        <clip pos="1" side="tl" part="gen"/>
                        <clip pos="1" side="tl" part="nbr"/>
        	      </lu>
        	      <b pos="1"/>
        	      <lu>
        	        <clip pos="2" side="tl" part="lemh"/>
        	        <clip pos="2" side="tl" part="a_nom"/>
                        <clip pos="2" side="tl" part="gen"/>
                        <clip pos="2" side="tl" part="nbr"/>
			<lit-tag v="2.ind"/>
        	        <clip pos="2" side="tl" part="lemq"/>
        	      </lu>
        	    </chunk>
            	   </out>
      </action>
    </rule>

    <rule comment="REGLA: NUM ADJ NOM">
      <pattern>
        <pattern-item n="num"/>
        <pattern-item n="adjec"/>
        <pattern-item n="nom"/>
      </pattern>
      <action>
        <call-macro n="firstWord">
          <with-param pos="1"/>
        </call-macro>
        <call-macro n="f_concord3">
	  <with-param pos="3"/>
          <with-param pos="2"/>
	  <with-param pos="1"/>
        </call-macro>
	<call-macro n="mod-gen">
          <with-param pos="2"/>
	</call-macro>
		  <out>
        	    <chunk name="num_adj_nom" case="caseFirstWord">
        	      <tags>
        	        <tag><lit-tag v="SN"/></tag>
	  	        <tag><var n="caso"/></tag>
        	      </tags>
        	      <lu>
        	        <clip pos="1" side="tl" part="lem"/>
        	        <clip pos="1" side="tl" part="a_num"/>
                        <clip pos="1" side="tl" part="gen"/>
                        <clip pos="1" side="tl" part="nbr"/>
        	      </lu>
        	      <b pos="1"/>
        	      <lu>
        	        <clip pos="2" side="tl" part="lemh"/>
        	        <clip pos="2" side="tl" part="a_adj"/>
                        <clip pos="2" side="tl" part="gen"/>
                        <clip pos="2" side="tl" part="nbr"/>
			<lit-tag v="2.ind"/>
        	        <clip pos="2" side="tl" part="lemq"/>
        	      </lu>
        	      <b pos="2"/>
        	      <lu>
        	        <clip pos="3" side="tl" part="lemh"/>
        	        <clip pos="3" side="tl" part="a_nom"/>
                        <clip pos="3" side="tl" part="gen"/>
                        <clip pos="3" side="tl" part="nbr"/>
			<lit-tag v="2.ind"/>
        	        <clip pos="3" side="tl" part="lemq"/>
        	      </lu>
        	    </chunk>
            	   </out>
      </action>
    </rule>
    

    <rule comment="REGLA: NUM NOM ADJ">
      <pattern>
        <pattern-item n="num"/>
        <pattern-item n="nom"/>
        <pattern-item n="adjec"/>
      </pattern>
      <action>
        <call-macro n="firstWord">
          <with-param pos="1"/>
        </call-macro>
        <call-macro n="f_concord3">
	  <with-param pos="2"/>
          <with-param pos="3"/>
	  <with-param pos="1"/>
        </call-macro>
	<call-macro n="mod-gen">
          <with-param pos="3"/>
	</call-macro>
		  <out>
        	    <chunk name="num_nom_adj" case="caseFirstWord">
        	      <tags>
        	        <tag><lit-tag v="SN"/></tag>
	  	        <tag><var n="caso"/></tag>
        	      </tags>
        	      <lu>
        	        <clip pos="1" side="tl" part="lem"/>
        	        <clip pos="1" side="tl" part="a_num"/>
                        <clip pos="1" side="tl" part="gen"/>
                        <clip pos="1" side="tl" part="nbr"/>
        	      </lu>
        	      <b pos="1"/>
        	      <lu>
        	        <clip pos="2" side="tl" part="lemh"/>
        	        <clip pos="2" side="tl" part="a_nom"/>
                        <clip pos="2" side="tl" part="gen"/>
                        <clip pos="2" side="tl" part="nbr"/>
			<lit-tag v="2.ind"/>
        	        <clip pos="2" side="tl" part="lemq"/>
        	      </lu>
        	      <b pos="2"/>
        	      <lu>
        	        <clip pos="3" side="tl" part="lemh"/>
        	        <clip pos="3" side="tl" part="a_adj"/>
                        <clip pos="3" side="tl" part="gen"/>
                        <clip pos="3" side="tl" part="nbr"/>
			<lit-tag v="2.ind"/>
        	        <clip pos="3" side="tl" part="lemq"/>
        	      </lu>

        	    </chunk>
            	   </out>
      </action>
    </rule>
    


    <rule comment="REGLA: ANTROPÒNIM">
      <pattern>
        <pattern-item n="ant"/>
      </pattern>
      <action>
        <call-macro n="firstWord">
          <with-param pos="1"/>
        </call-macro>
        <out>
          <chunk name="ant" case="caseFirstWord">
            <tags>
              <tag><lit-tag v="SN"/></tag>
            </tags>
            <lu>
        	<clip pos="1" side="tl" part="lem"/>
        	<lit-tag v="np.ant"/>
                <clip pos="1" side="tl" part="gen"/>
<!--gema: no hay info en los dicos para generar esta información <lit-tag v="sg.nom.ind"/>-->
            </lu>
          </chunk>
        </out>
      </action>
    </rule>

    <rule comment="REGLA: TOPÒNIM">
      <pattern>
        <pattern-item n="loc"/>
      </pattern>
      <action>
        <call-macro n="firstWord">
          <with-param pos="1"/>
        </call-macro>
        <out>
          <chunk name="loc" case="caseFirstWord">
            <tags>
              <tag><lit-tag v="SN"/></tag>
              <tag><var n="caso"/></tag>
            </tags>
            <lu>
        	<clip pos="1" side="tl" part="lem"/>
        	<lit-tag v="np.loc"/>
                <clip pos="1" side="tl" part="gen"/>
                <clip pos="1" side="tl" part="nbr"/>
		<lit-tag v="2.ind"/>
            </lu>
          </chunk>
        </out>
      </action>
    </rule>

    <rule comment="REGLA: NOM ADJ">
      <pattern>
        <pattern-item n="nom"/>
        <pattern-item n="adjec"/>
      </pattern>
      <action>
        <call-macro n="firstWord">
          <with-param pos="1"/>
        </call-macro>
        <call-macro n="f_concord2">
          <with-param pos="1"/>
          <with-param pos="2"/>
        </call-macro>
        <call-macro n="mod-gen">
          <with-param pos="2"/>
        </call-macro>
        <out>
          <chunk name="nom_adj" case="caseFirstWord">
            <tags>
              <tag>
                <lit-tag v="SN"/>
              </tag>
              <tag><var n="caso"/></tag>
            </tags>
            <lu>
              <clip pos="1" side="tl" part="lemh"/>
              <clip pos="1" side="tl" part="a_nom"/>
              <clip pos="1" side="tl" part="gen"/>
              <clip pos="1" side="tl" part="nbr"/>
	      <lit-tag v="2.ind"/>
              <clip pos="1" side="tl" part="lemq"/>
            </lu>
            <b pos="1"/>
            <lu>
              <clip pos="2" side="tl" part="lemh"/>
              <clip pos="2" side="tl" part="a_adj"/>
              <clip pos="2" side="tl" part="gen"/>
              <clip pos="2" side="tl" part="nbr"/>
	      <lit-tag v="nom.ind"/>
              <clip pos="2" side="tl" part="lemq"/>
            </lu>
          </chunk>
        </out>
      </action>
    </rule>

    <rule comment="REGLA: NOM ADV/PREADV ADJ">
      <pattern>
        <pattern-item n="nom"/>
        <pattern-item n="adv_preadv"/>
        <pattern-item n="adjec"/>
      </pattern>
      <action>
        <call-macro n="firstWord">
          <with-param pos="1"/>
        </call-macro>
        <call-macro n="f_concord2">
          <with-param pos="1"/>
          <with-param pos="3"/>
        </call-macro>
        <call-macro n="mod-gen">
          <with-param pos="3"/>
        </call-macro>
        <out>
          <chunk name="nom_adv_adj" case="caseFirstWord">
            <tags>
              <tag>
                <lit-tag v="SN"/>
              </tag>
              <tag><var n="caso"/></tag>
            </tags>
            <lu>
              <clip pos="1" side="tl" part="lemh"/>
              <clip pos="1" side="tl" part="a_nom"/>
              <clip pos="1" side="tl" part="gen"/>
              <clip pos="1" side="tl" part="nbr"/>
	      <lit-tag v="2.ind"/>
              <clip pos="1" side="tl" part="lemq"/>
            </lu>
            <b pos="2"/>
	    <lu>
              <clip pos="2" side="tl" part="whole"/>
	    </lu>
            <b pos="1"/>
            <lu>
              <clip pos="3" side="tl" part="lemh"/>
              <clip pos="3" side="tl" part="a_adj"/>
              <clip pos="3" side="tl" part="gen"/>
              <clip pos="3" side="tl" part="nbr"/>
	      <lit-tag v="nom.ind"/>
              <clip pos="3" side="tl" part="lemq"/>
            </lu>
          </chunk>
        </out>
      </action>
    </rule>



    <rule comment="REGLA: ADJ NOM">
      <pattern>
        <pattern-item n="adjec"/>
        <pattern-item n="nom"/>
      </pattern>
      <action>
        <call-macro n="firstWord">
          <with-param pos="1"/>
        </call-macro>
        <call-macro n="f_concord2">
          <with-param pos="2"/>
          <with-param pos="1"/>
        </call-macro>
        <call-macro n="mod-gen">
          <with-param pos="1"/>
        </call-macro>
        <out>
          <chunk name="adj_nom" case="caseFirstWord">
            <tags>
              <tag><lit-tag v="SA"/></tag>
              <tag><var n="caso"/></tag>
            </tags>
            <lu>
              <clip pos="1" side="tl" part="lemh"/>
              <clip pos="1" side="tl" part="a_adj"/>
              <clip pos="1" side="tl" part="gen"/>
              <clip pos="1" side="tl" part="nbr"/>
	      <lit-tag v="2.ind"/>
              <clip pos="1" side="tl" part="lemq"/>
            </lu>
            <b pos="1"/>
            <lu>
              <clip pos="2" side="tl" part="lemh"/>
              <clip pos="2" side="tl" part="a_nom"/>
              <clip pos="2" side="tl" part="gen"/>
              <clip pos="2" side="tl" part="nbr"/>
              <lit-tag v="nom.ind"/>
	      <clip pos="2" side="tl" part="lemq"/>
            </lu>
          </chunk>
        </out>
      </action>
    </rule>


    <rule comment="REGLA: NOM ADJ ADJ">
      <pattern>
        <pattern-item n="nom"/>
        <pattern-item n="adjec"/>
        <pattern-item n="adjec"/>
      </pattern>
      <action>
        <call-macro n="firstWord">
          <with-param pos="1"/>
        </call-macro>
        <call-macro n="f_concord3">
          <with-param pos="1"/>
          <with-param pos="2"/>
          <with-param pos="3"/>
        </call-macro>
        <call-macro n="mod-gen">
          <with-param pos="2"/>
        </call-macro>
        <call-macro n="mod-gen">
          <with-param pos="3"/>
        </call-macro>
        <out>
          <chunk name="nom_adj_adj" case="caseFirstWord">
            <tags>
              <tag><lit-tag v="SN"/></tag>
              <tag><var n="caso"/></tag>
            </tags>
            <lu>
              <clip pos="1" side="tl" part="lemh"/>
              <clip pos="1" side="tl" part="a_nom"/>
              <clip pos="1" side="tl" part="gen"/>
              <clip pos="1" side="tl" part="nbr"/>
              <lit-tag v="2.ind"/>
	      <clip pos="1" side="tl" part="lemq"/>
            </lu>
            <b pos="1"/>
            <lu>
              <clip pos="2" side="tl" part="lemh"/>
              <clip pos="2" side="tl" part="a_adj"/>
              <clip pos="2" side="tl" part="gen"/>
              <clip pos="2" side="tl" part="nbr"/>
              <lit-tag v="nom.ind"/>
              <clip pos="2" side="tl" part="lemq"/>
            </lu>
            <b pos="2"/>
            <lu>
              <clip pos="3" side="tl" part="lemh"/>
              <clip pos="3" side="tl" part="a_adj"/>
              <clip pos="3" side="tl" part="gen"/>
              <clip pos="3" side="tl" part="nbr"/>
              <lit-tag v="nom.ind"/>
              <clip pos="3" side="tl" part="lemq"/>
            </lu>
          </chunk>
        </out>
      </action>
    </rule>

    <rule comment="REGLA: DET NOM ADJ">
      <pattern>
        <pattern-item n="det"/>
        <pattern-item n="nom"/>
	<pattern-item n="adjec"/>
      </pattern>
      <action>
        <call-macro n="firstWord">
          <with-param pos="1"/>
        </call-macro>
        <call-macro n="f_concord3">
          <with-param pos="2"/>
	  <with-param pos="1"/>
          <with-param pos="3"/>
        </call-macro>        
        <call-macro n="mod-gen">
          <with-param pos="3"/>
        </call-macro>
        <choose>
          <when>
            <test>
                <equal>
                  <clip pos="1" side="sl" part="a_det"/>
                  <lit-tag v="det.def"/>
                </equal>
            </test>
            <out>
              <chunk name="nomdef_adj" case="caseFirstWord">
                <tags>
		  <tag><lit-tag v="SN"/></tag>
		  <tag><var n="caso"/></tag>
		</tags>
                <lu>
                  <clip pos="2" side="tl" part="lemh"/>
                  <clip pos="2" side="tl" part="a_nom"/>
                  <clip pos="2" side="tl" part="gen"/>
                  <clip pos="2" side="tl" part="nbr"/>
                  <lit-tag v="2.def"/>
                  <clip pos="2" side="tl" part="lemq"/>
                </lu>
		<b pos="2"/>
		<lu>
              	  <clip pos="3" side="tl" part="lemh"/>
              	  <clip pos="3" side="tl" part="a_adj"/>
                  <clip pos="3" side="tl" part="gen"/>
                  <clip pos="3" side="tl" part="nbr"/>
	          <lit-tag v="nom.ind"/>
                  <clip pos="3" side="tl" part="lemq"/>
              </lu>
              </chunk>
            </out>
          </when>
          <otherwise>
            <choose>
              <when>
                <test>
                  <or>
                    <equal>
                      <clip pos="1" side="sl" part="a_det"/>
                      <lit-tag v="det.dem"/>
                    </equal>
                    <equal>
                      <clip pos="1" side="sl" part="a_det"/>
                      <lit-tag v="det.ind"/>
                    </equal>
                  </or>
                </test>
		<call-macro n="mod-gen">
		  <with-param pos="1"/>
		</call-macro>
                <out>
                  <chunk name="det_nom_adj" case="caseFirstWord">
                    <tags>
                      <tag><lit-tag v="SN"/></tag>
		      <tag><var n="caso"/></tag>
                    </tags>
                    <lu>
                      <clip pos="1" side="tl" part="lem"/>
                      <clip pos="1" side="tl" part="a_det"/>
                      <clip pos="1" side="tl" part="gen"/>
                      <clip pos="1" side="tl" part="nbr"/>
                      <lit-tag v="2"/>
                    </lu>
                    <b pos="1"/>
                    <lu>
                      <clip pos="2" side="tl" part="lemh"/>
                      <clip pos="2" side="tl" part="a_nom"/>
                      <clip pos="2" side="tl" part="gen"/>
                      <clip pos="2" side="tl" part="nbr"/>
                      <lit-tag v="nom.ind"/>
                      <clip pos="2" side="tl" part="lemq"/>
                    </lu>
		    <b pos="2"/>
		    <lu>
              	      <clip pos="3" side="tl" part="lemh"/>
              	      <clip pos="3" side="tl" part="a_adj"/>
                      <clip pos="3" side="tl" part="gen"/>
                      <clip pos="3" side="tl" part="nbr"/>
	              <lit-tag v="nom.ind"/>
                      <clip pos="3" side="tl" part="lemq"/>
                    </lu>
                  </chunk>
                </out>
              </when>
              <otherwise>
	    <choose>
              <when>
                <test>
                    <equal>
                      <clip pos="1" side="sl" part="a_det"/>
                      <lit-tag v="det.pos"/>
                    </equal>
                </test>
		<!--
		<call-macro n="mod-gen">
		  <with-param pos="1"/>
		</call-macro>
		-->
		<call-macro n="mod-gen">
		  <with-param pos="3"/>
		</call-macro>
                <out>
                  <chunk name="nom_adj_adj" case="caseFirstWord">
                    <tags>
                      <tag><lit-tag v="SN"/></tag>
                    </tags>
                    <lu>
                      <clip pos="2" side="tl" part="lemh"/>
                      <clip pos="2" side="tl" part="a_nom"/>
                      <clip pos="2" side="tl" part="gen"/>
                      <clip pos="2" side="tl" part="nbr"/>
                      <lit-tag v="nom.def"/>
                      <clip pos="2" side="tl" part="lemq"/>
                    </lu>
                    <b pos="1"/>
                    <lu>
                      <clip pos="1" side="tl" part="lem"/>
                      <lit-tag v="adj.pos"/>
		      <!-- fran: he puesto que coge el género del adjetivo porque el mod-gen hace cosas raras con mf -->
                      <clip pos="3" side="tl" part="gen"/>
                      <clip pos="1" side="tl" part="nbr"/>
		      <lit-tag v="nom.ind"/>	
                    </lu>		    
		    <b pos="2"/>
		    <lu>
              	      <clip pos="3" side="tl" part="lemh"/>
              	      <clip pos="3" side="tl" part="a_adj"/>
                      <clip pos="3" side="tl" part="gen"/>
                      <clip pos="3" side="tl" part="nbr"/>
	              <lit-tag v="nom.ind"/>
                      <clip pos="3" side="tl" part="lemq"/>
                    </lu>
                  </chunk>
                </out>
              </when>
            </choose>
            </otherwise>
            </choose>
          </otherwise>
        </choose>
      </action>
    </rule>

    <rule comment="REGLA: a DET NOM ADJ">
      <pattern>
        <pattern-item n="a"/>
        <pattern-item n="det"/>
        <pattern-item n="nom"/>
	<pattern-item n="adjec"/>
      </pattern>
      <action>
        <call-macro n="firstWord">
          <with-param pos="1"/>
        </call-macro>
        <call-macro n="f_concord3">
          <with-param pos="3"/>
          <with-param pos="4"/>
	  <with-param pos="2"/>
        </call-macro>        
        <call-macro n="mod-gen">
          <with-param pos="4"/>
        </call-macro>
<!--
        <let>
          <var n="caso"/>
          <lit-tag v="dg"/>
        </let>
-->
        <choose>
          <when>
            <test>
                <equal>
                  <clip pos="2" side="sl" part="a_det"/>
                  <lit-tag v="det.def"/>
                </equal>
            </test>
            <out>
              <chunk name="nomdef_adj" case="caseFirstWord">
                <tags>
		  <tag><lit-tag v="SN"/></tag>
		  <tag><var n="caso"/></tag>
		</tags>
                <lu>
                  <clip pos="3" side="tl" part="lemh"/>
                  <clip pos="3" side="tl" part="a_nom"/>
                  <clip pos="3" side="tl" part="gen"/>
                  <clip pos="3" side="tl" part="nbr"/>
                  <lit-tag v="2.def"/>
                  <clip pos="3" side="tl" part="lemq"/>
                </lu>
		<b pos="1"/>
		<lu>
              	  <clip pos="4" side="tl" part="lemh"/>
              	  <clip pos="4" side="tl" part="a_adj"/>
                  <clip pos="4" side="tl" part="gen"/>
                  <clip pos="4" side="tl" part="nbr"/>
	          <lit-tag v="nom.ind"/>
                  <clip pos="4" side="tl" part="lemq"/>
              </lu>
              </chunk>
            </out>
          </when>
          <otherwise>
            <choose>
              <when>
                <test>
                  <or>
                    <equal>
                      <clip pos="2" side="sl" part="a_det"/>
                      <lit-tag v="det.dem"/>
                    </equal>
                    <equal>
                      <clip pos="2" side="sl" part="a_det"/>
                      <lit-tag v="det.ind"/>
                    </equal>
                  </or>
                </test>
		<call-macro n="mod-gen">
		  <with-param pos="2"/>
		</call-macro>
                <out>
                  <chunk name="det_nom_adj" case="caseFirstWord">
                    <tags>
                      <tag><lit-tag v="SN"/></tag>
		      <tag><var n="caso"/></tag>
                    </tags>
                    <lu>
                      <clip pos="2" side="tl" part="lem"/>
                      <clip pos="2" side="tl" part="a_det"/>
                      <clip pos="2" side="tl" part="gen"/>
                      <clip pos="2" side="tl" part="nbr"/>
                      <lit-tag v="2"/>
                    </lu>
                    <b pos="1"/>
                    <lu>
                      <clip pos="3" side="tl" part="lemh"/>
                      <clip pos="3" side="tl" part="a_nom"/>
                      <clip pos="3" side="tl" part="gen"/>
                      <clip pos="3" side="tl" part="nbr"/>
                      <lit-tag v="nom.ind"/>
                      <clip pos="3" side="tl" part="lemq"/>
                    </lu>
		    <b pos="2"/>
		    <lu>
              	      <clip pos="4" side="tl" part="lemh"/>
              	      <clip pos="4" side="tl" part="a_adj"/>
                      <clip pos="4" side="tl" part="gen"/>
                      <clip pos="4" side="tl" part="nbr"/>
	              <lit-tag v="nom.ind"/>
                      <clip pos="4" side="tl" part="lemq"/>
                    </lu>
                  </chunk>
                </out>
              </when>
              <otherwise>
	    <choose>
              <when>
                <test>
                    <equal>
                      <clip pos="1" side="sl" part="a_det"/>
                      <lit-tag v="det.pos"/>
                    </equal>
                </test>
		<call-macro n="mod-gen">
		  <with-param pos="1"/>
		</call-macro>
                <out>
                  <chunk name="nom_adj_adj" case="caseFirstWord">
                    <tags>
                      <tag><lit-tag v="SN"/></tag>
                    </tags>
                    <lu>
                      <clip pos="3" side="tl" part="lemh"/>
                      <clip pos="3" side="tl" part="a_nom"/>
                      <clip pos="3" side="tl" part="gen"/>
                      <clip pos="3" side="tl" part="nbr"/>
                      <lit-tag v="nom.def"/>
                      <clip pos="3" side="tl" part="lemq"/>
                    </lu>
                    <b pos="1"/>
                    <lu>
                      <clip pos="2" side="tl" part="lem"/>
                      <lit-tag v="adj.pos"/>
                      <clip pos="2" side="tl" part="gen"/>
                      <clip pos="2" side="tl" part="nbr"/>
		      <lit-tag v="nom.ind"/>	
                    </lu>		    
		    <b pos="2"/>
		    <lu>
              	      <clip pos="4" side="tl" part="lemh"/>
              	      <clip pos="4" side="tl" part="a_adj"/>
                      <clip pos="4" side="tl" part="gen"/>
                      <clip pos="4" side="tl" part="nbr"/>
	              <lit-tag v="nom.ind"/>
                      <clip pos="4" side="tl" part="lemq"/>
                    </lu>
                  </chunk>
                </out>
              </when>
            </choose>
            </otherwise>
            </choose>
          </otherwise>
        </choose>
      </action>
    </rule>


    <rule comment="REGLA: DET NOM ADV/PREADV ADJ">
      <pattern>
        <pattern-item n="det"/>
        <pattern-item n="nom"/>
        <pattern-item n="adv_preadv"/>
	<pattern-item n="adjec"/>
      </pattern>
      <action>
        <call-macro n="firstWord">
          <with-param pos="1"/>
        </call-macro>
        <call-macro n="f_concord3">
          <with-param pos="2"/>
          <with-param pos="4"/>
	  <with-param pos="1"/>
        </call-macro>        
        <call-macro n="mod-gen">
          <with-param pos="4"/>
        </call-macro>
        <choose>
          <when>
            <test>
                <equal>
                  <clip pos="1" side="sl" part="a_det"/>
                  <lit-tag v="det.def"/>
                </equal>
            </test>
            <out>
              <chunk name="nomdef_adv_adj" case="caseFirstWord">
                <tags>
		  <tag><lit-tag v="SN"/></tag>
		  <tag><var n="caso"/></tag>
		</tags>
                <lu>
                  <clip pos="2" side="tl" part="lemh"/>
                  <clip pos="2" side="tl" part="a_nom"/>
                  <clip pos="2" side="tl" part="gen"/>
                  <clip pos="2" side="tl" part="nbr"/>
                  <lit-tag v="2.def"/>
                  <clip pos="2" side="tl" part="lemq"/>
                </lu>
		<b pos="1"/>
		<lu>
              	  <clip pos="3" side="tl" part="whole"/>
		</lu>
		<b pos="2"/>
		<lu>
              	  <clip pos="4" side="tl" part="lemh"/>
              	  <clip pos="4" side="tl" part="a_adj"/>
                  <clip pos="4" side="tl" part="gen"/>
                  <clip pos="4" side="tl" part="nbr"/>
	          <lit-tag v="nom.ind"/>
                  <clip pos="4" side="tl" part="lemq"/>
              </lu>
              </chunk>
            </out>
          </when>
          <otherwise>
            <choose>
              <when>
                <test>
                  <or>
                    <equal>
                      <clip pos="1" side="sl" part="a_det"/>
                      <lit-tag v="det.dem"/>
                    </equal>
                    <equal>
                      <clip pos="1" side="sl" part="a_det"/>
                      <lit-tag v="det.ind"/>
                    </equal>
                  </or>
                </test>
		<call-macro n="mod-gen">
		  <with-param pos="1"/>
		</call-macro>
		<call-macro n="mod-gen">
		  <with-param pos="4"/>
		</call-macro>
                <out>
                  <chunk name="det_nom_adv_adj" case="caseFirstWord">
                    <tags>
                      <tag><lit-tag v="SN"/></tag>
		      <tag><var n="caso"/></tag>
                    </tags>
                    <lu>
                      <clip pos="1" side="tl" part="lem"/>
                      <clip pos="1" side="tl" part="a_det"/>
                      <clip pos="1" side="tl" part="gen"/>
                      <clip pos="1" side="tl" part="nbr"/>
                      <lit-tag v="2"/>
                    </lu>
                    <b pos="1"/>
                    <lu>
                      <clip pos="2" side="tl" part="lemh"/>
                      <clip pos="2" side="tl" part="a_nom"/>
                      <clip pos="2" side="tl" part="gen"/>
                      <clip pos="2" side="tl" part="nbr"/>
                      <lit-tag v="nom.ind"/>
                      <clip pos="2" side="tl" part="lemq"/>
                    </lu>
		    <b pos="2"/>
                    <lu>
                      <clip pos="3" side="tl" part="whole"/>
                    </lu>
		    <b pos="3"/>
		    <lu>
              	      <clip pos="4" side="tl" part="lemh"/>
              	      <clip pos="4" side="tl" part="a_adj"/>
                      <clip pos="4" side="tl" part="gen"/>
                      <clip pos="4" side="tl" part="nbr"/>
	              <lit-tag v="nom.ind"/>
                      <clip pos="4" side="tl" part="lemq"/>
                    </lu>
                  </chunk>
                </out>
              </when>
              <otherwise>
	    <choose>
              <when>
                <test>
                    <equal>
                      <clip pos="1" side="sl" part="a_det"/>
                      <lit-tag v="det.pos"/>
                    </equal>
                </test>
		<call-macro n="mod-gen">
		  <with-param pos="1"/>
		</call-macro>
		<call-macro n="mod-gen">
		  <with-param pos="4"/>
		</call-macro>
                <out>
                  <chunk name="nom_adj_adv_adj" case="caseFirstWord">
                    <tags>
                      <tag><lit-tag v="SN"/></tag>
                    </tags>
                    <lu>
                      <clip pos="2" side="tl" part="lemh"/>
                      <clip pos="2" side="tl" part="a_nom"/>
                      <clip pos="2" side="tl" part="gen"/>
                      <clip pos="2" side="tl" part="nbr"/>
                      <lit-tag v="nom.def"/>
                      <clip pos="2" side="tl" part="lemq"/>
                    </lu>
                    <b pos="1"/>
                    <lu>
                      <clip pos="1" side="tl" part="lem"/>
                      <lit-tag v="adj.pos"/>
                      <clip pos="1" side="tl" part="gen"/>
                      <clip pos="1" side="tl" part="nbr"/>
		      <lit-tag v="nom.ind"/>	
                    </lu>		    
		    <b pos="2"/>
                    <lu>
                      <clip pos="3" side="tl" part="whole"/>
                    </lu>
		    <b pos="3"/>
		    <lu>
              	      <clip pos="4" side="tl" part="lemh"/>
              	      <clip pos="4" side="tl" part="a_adj"/>
                      <clip pos="4" side="tl" part="gen"/>
                      <clip pos="4" side="tl" part="nbr"/>
	              <lit-tag v="nom.ind"/>
                      <clip pos="4" side="tl" part="lemq"/>
                    </lu>
                  </chunk>
                </out>
              </when>
            </choose>
            </otherwise>
            </choose>
          </otherwise>
        </choose>
      </action>
    </rule>



    <rule comment="REGLA: DET NOM ADJ ADJ">
      <pattern>
        <pattern-item n="det"/>
        <pattern-item n="nom"/>
	<pattern-item n="adjec"/>
	<pattern-item n="adjec"/>
      </pattern>
      <action>
        <call-macro n="firstWord">
          <with-param pos="1"/>
        </call-macro>
        <call-macro n="f_concord4">
          <with-param pos="2"/>
          <with-param pos="3"/>
          <with-param pos="4"/>
	  <with-param pos="1"/>
        </call-macro>        
        <call-macro n="mod-gen">
          <with-param pos="3"/>
        </call-macro>
        <call-macro n="mod-gen">
          <with-param pos="4"/>
        </call-macro>
        <choose>
          <when>
            <test>
                <equal>
                  <clip pos="1" side="sl" part="a_det"/>
                  <lit-tag v="det.def"/>
                </equal>
            </test>
            <out>
              <chunk name="nomdef_adj_adj" case="caseFirstWord">
                <tags>
		  <tag><lit-tag v="SN"/></tag>
		  <tag><var n="caso"/></tag>
		</tags>
                <lu>
                  <clip pos="2" side="tl" part="lemh"/>
                  <clip pos="2" side="tl" part="a_nom"/>
                  <clip pos="2" side="tl" part="gen"/>
                  <clip pos="2" side="tl" part="nbr"/>
                  <lit-tag v="2.def"/>
                  <clip pos="2" side="tl" part="lemq"/>
                </lu>
		<b pos="2"/>
		<lu>
              	  <clip pos="3" side="tl" part="lemh"/>
              	  <clip pos="3" side="tl" part="a_adj"/>
                  <clip pos="3" side="tl" part="gen"/>
                  <clip pos="3" side="tl" part="nbr"/>
	          <lit-tag v="nom.ind"/>
                  <clip pos="3" side="tl" part="lemq"/>
                </lu>
		<b pos="3"/>
		<lu>
              	  <clip pos="4" side="tl" part="lemh"/>
              	  <clip pos="4" side="tl" part="a_adj"/>
                  <clip pos="4" side="tl" part="gen"/>
                  <clip pos="4" side="tl" part="nbr"/>
	          <lit-tag v="nom.ind"/>
                  <clip pos="4" side="tl" part="lemq"/>
                </lu>

              </chunk>
            </out>
          </when>
          <otherwise>
            <choose>
              <when>
                <test>
                  <or>
                    <equal>
                      <clip pos="1" side="sl" part="a_det"/>
                      <lit-tag v="det.dem"/>
                    </equal>
                    <equal>
                      <clip pos="1" side="sl" part="a_det"/>
                      <lit-tag v="det.ind"/>
                    </equal>
                  </or>
                </test>
		<call-macro n="mod-gen">
		  <with-param pos="1"/>
		</call-macro>
                <out>
                  <chunk name="det_nom_adj_adj" case="caseFirstWord">
                    <tags>
                      <tag><lit-tag v="SN"/></tag>
		      <tag><var n="caso"/></tag>
                    </tags>
                    <lu>
                      <clip pos="1" side="tl" part="lem"/>
                      <clip pos="1" side="tl" part="a_det"/>
                      <clip pos="1" side="tl" part="gen"/>
                      <clip pos="1" side="tl" part="nbr"/>
                      <lit-tag v="2"/>
                    </lu>
                    <b pos="1"/>
                    <lu>
                      <clip pos="2" side="tl" part="lemh"/>
                      <clip pos="2" side="tl" part="a_nom"/>
                      <clip pos="2" side="tl" part="gen"/>
                      <clip pos="2" side="tl" part="nbr"/>
                      <lit-tag v="nom.def"/>
                      <clip pos="2" side="tl" part="lemq"/>
                    </lu>
		    <b pos="2"/>
		    <lu>
              	      <clip pos="3" side="tl" part="lemh"/>
              	      <clip pos="3" side="tl" part="a_adj"/>
                      <clip pos="3" side="tl" part="gen"/>
                      <clip pos="3" side="tl" part="nbr"/>
	              <lit-tag v="nom.ind"/>
                      <clip pos="3" side="tl" part="lemq"/>
                    </lu>
		    <b pos="3"/>
		    <lu>
              	      <clip pos="4" side="tl" part="lemh"/>
              	      <clip pos="4" side="tl" part="a_adj"/>
                      <clip pos="4" side="tl" part="gen"/>
                      <clip pos="4" side="tl" part="nbr"/>
	              <lit-tag v="nom.ind"/>
                      <clip pos="4" side="tl" part="lemq"/>
                    </lu>

                  </chunk>
                </out>
              </when>
              <otherwise>
	    <choose>
              <when>
                <test>
                    <equal>
                      <clip pos="1" side="sl" part="a_det"/>
                      <lit-tag v="det.pos"/>
                    </equal>
                </test>
		<call-macro n="mod-gen">
		  <with-param pos="1"/>
		</call-macro>
                <out>
                  <chunk name="nom_adj_adj_adj" case="caseFirstWord">
                    <tags>
                      <tag><lit-tag v="SN"/></tag>
                    </tags>
                    <lu>
                      <clip pos="2" side="tl" part="lemh"/>
                      <clip pos="2" side="tl" part="a_nom"/>
                      <clip pos="2" side="tl" part="gen"/>
                      <clip pos="2" side="tl" part="nbr"/>
                      <lit-tag v="nom.def"/>
                      <clip pos="2" side="tl" part="lemq"/>
                    </lu>
                    <b pos="1"/>
                    <lu>
                      <clip pos="1" side="tl" part="lem"/>
                      <lit-tag v="adj.pos"/>
                      <clip pos="1" side="tl" part="gen"/>
                      <clip pos="1" side="tl" part="nbr"/>
		      <lit-tag v="nom.ind"/>	
                    </lu>		    
		    <b pos="2"/>
		    <lu>
              	      <clip pos="3" side="tl" part="lemh"/>
              	      <clip pos="3" side="tl" part="a_adj"/>
                      <clip pos="3" side="tl" part="gen"/>
                      <clip pos="3" side="tl" part="nbr"/>
	              <lit-tag v="nom.ind"/>
                      <clip pos="3" side="tl" part="lemq"/>
                    </lu>
		    <b pos="3"/>
		    <lu>
              	      <clip pos="4" side="tl" part="lemh"/>
              	      <clip pos="4" side="tl" part="a_adj"/>
                      <clip pos="4" side="tl" part="gen"/>
                      <clip pos="4" side="tl" part="nbr"/>
	              <lit-tag v="nom.ind"/>
                      <clip pos="4" side="tl" part="lemq"/>
                    </lu>
                  </chunk>
                </out>
              </when>
            </choose>
            </otherwise>
            </choose>
          </otherwise>
        </choose>
      </action>
    </rule>


    <rule comment="REGLA: DET ADV ADJ">
      <pattern>
        <pattern-item n="det"/>
        <pattern-item n="adv"/>
	<pattern-item n="adjec"/>
      </pattern>
      <action>
        <call-macro n="firstWord">
          <with-param pos="1"/>
        </call-macro>
        <call-macro n="f_concord2">
          <with-param pos="1"/>
	  <with-param pos="3"/>
        </call-macro>        
        <call-macro n="mod-gen">
          <with-param pos="3"/>
        </call-macro>
        <choose>
          <when>
            <test>
                <equal>
                  <clip pos="1" side="sl" part="a_det"/>
                  <lit-tag v="det.def"/>
                </equal>
            </test>
            <call-macro n="mod-gen">
              <with-param pos="1"/>
            </call-macro>
            <call-macro n="mod-gen">
              <with-param pos="3"/>
            </call-macro>
            <out>
          <chunk name="det_adv_adj" case="caseFirstWord">
            <tags>
              <tag><lit-tag v="SN"/></tag>
              <tag><var n="caso"/></tag>
            </tags>
                <lu>
                  <clip pos="1" side="tl" part="lem"/>
                  <clip pos="1" side="tl" part="a_det"/>
                  <clip pos="1" side="tl" part="gen"/>  
                  <clip pos="1" side="tl" part="nbr"/>
                  <lit-tag v="nom"/>  	
                </lu>
		<b pos="1"/>
                <lu>
                  <clip pos="2" side="tl" part="whole"/>
                </lu>
                <b pos="2"/>
                <lu>
                  <clip pos="3" side="tl" part="lemh"/>
                  <clip pos="3" side="tl" part="a_adj"/>
                  <clip pos="3" side="tl" part="gen"/>
                  <clip pos="3" side="tl" part="nbr"/>
                  <lit-tag v="nom.ind"/>
                  <clip pos="3" side="tl" part="lemq"/>
                </lu>
              </chunk>
            </out>
          </when>
          <otherwise>
            <choose>
              <when>
                <test>
                  <or>
                    <equal>
                      <clip pos="1" side="sl" part="a_det"/>
                      <lit-tag v="det.dem"/>
                    </equal>
                    <equal>
                      <clip pos="1" side="sl" part="a_det"/>
                      <lit-tag v="det.ind"/>
                    </equal>
                  </or>
                </test>
		<call-macro n="mod-gen">
		  <with-param pos="1"/>
		</call-macro>
		<call-macro n="mod-gen">
		  <with-param pos="3"/>
		</call-macro>
                <out>
                  <chunk name="det_adv_adj" case="caseFirstWord">
                    <tags>
                      <tag><lit-tag v="SN"/></tag>
		      <tag><var n="caso"/></tag>
                    </tags>
                    <lu>
                      <clip pos="1" side="tl" part="lem"/>
                      <clip pos="1" side="tl" part="a_det"/>
                      <clip pos="1" side="tl" part="gen"/>
                      <clip pos="1" side="tl" part="nbr"/>
                      <lit-tag v="2"/>
                    </lu>
                    <b pos="1"/>
                    <lu>
                      <clip pos="2" side="tl" part="whole"/>
                    </lu>
		    <b pos="2"/>
		    <lu>
              	      <clip pos="3" side="tl" part="lemh"/>
              	      <clip pos="3" side="tl" part="a_adj"/>
                      <clip pos="3" side="tl" part="gen"/>
                      <clip pos="3" side="tl" part="nbr"/>
	              <lit-tag v="nom.ind"/>
                      <clip pos="3" side="tl" part="lemq"/>
                    </lu>
                  </chunk>
                </out>
              </when>
              <otherwise>
	    <choose>
              <when>
                <test>
                    <equal>
                      <clip pos="1" side="sl" part="a_det"/>
                      <lit-tag v="det.pos"/>
                    </equal>
                </test>
		<call-macro n="mod-gen">
		  <with-param pos="1"/>
		</call-macro>
		<call-macro n="mod-gen">
		  <with-param pos="3"/>
		</call-macro>
                <out>
                  <chunk name="adv_adj_adj" case="caseFirstWord">
                    <tags>
                      <tag><lit-tag v="SN"/></tag>
                    </tags>
		    <lu>
		      <clip pos="2" side="tl" part="whole"/>
                    </lu>
                    <b pos="1"/>
		    <lu>
              	      <clip pos="3" side="tl" part="lemh"/>
              	      <clip pos="3" side="tl" part="a_adj"/>
                      <clip pos="3" side="tl" part="gen"/>
                      <clip pos="3" side="tl" part="nbr"/>
	              <lit-tag v="nom.ind"/>
                      <clip pos="3" side="tl" part="lemq"/>
                    </lu>
                    <b pos="2"/>
                    <lu>
                      <clip pos="1" side="tl" part="lem"/>
                      <lit-tag v="adj.pos"/>
                      <clip pos="1" side="tl" part="gen"/>
                      <clip pos="1" side="tl" part="nbr"/>
		      <lit-tag v="nom.ind"/>	
                    </lu>		    
                  </chunk>
                </out>
              </when>
            </choose>
            </otherwise>
            </choose>
          </otherwise>
        </choose>
      </action>
    </rule>



    <rule comment="REGLA: DET ADJ NOM">
      <pattern>
        <pattern-item n="det"/>
	<pattern-item n="adjec"/>
        <pattern-item n="nom"/>
      </pattern>
      <action>
        <call-macro n="firstWord">
          <with-param pos="1"/>
        </call-macro>
	<!--
        <call-macro n="f_concord3">
          <with-param pos="3"/>
          <with-param pos="2"/>
	  <with-param pos="1"/>
        </call-macro>        
	-->
        <call-macro n="f_concord2">
          <with-param pos="3"/>
          <with-param pos="1"/>
	</call-macro>
        <call-macro n="f_concord2">
          <with-param pos="3"/>
          <with-param pos="2"/>
	</call-macro>
        <call-macro n="mod-gen">
          <with-param pos="2"/>
        </call-macro>
        <choose>
          <when>
            <test>
                <equal>
                  <clip pos="1" side="sl" part="a_det"/>
                  <lit-tag v="det.def"/>
                </equal>
            </test>
        <call-macro n="mod-gen">
          <with-param pos="1"/>
        </call-macro>
            <out>
          <chunk name="nomdef_det_adj" case="caseFirstWord">
            <tags>
              <tag><lit-tag v="SN"/></tag>
              <tag><var n="caso"/></tag>
            </tags>
                <lu>
                  <clip pos="3" side="tl" part="lemh"/>
                  <clip pos="3" side="tl" part="a_nom"/>
                  <clip pos="3" side="tl" part="gen"/>
                  <clip pos="3" side="tl" part="nbr"/>
                  <lit-tag v="2.def"/>
                  <clip pos="3" side="tl" part="lemq"/>
                </lu>
                <b pos="1"/>
                <lu>
                  <clip pos="1" side="tl" part="lem"/>
                  <clip pos="1" side="tl" part="a_det"/>
                  <clip pos="1" side="tl" part="gen"/>  
                  <clip pos="1" side="tl" part="nbr"/>
                  <lit-tag v="nom"/>  	
                </lu>
                <b pos="2"/>
                <lu>
                  <clip pos="2" side="tl" part="lemh"/>
                  <clip pos="2" side="tl" part="a_adj"/>
                  <clip pos="2" side="tl" part="gen"/>
                  <clip pos="2" side="tl" part="nbr"/>
                  <lit-tag v="nom.ind"/>
                  <clip pos="2" side="tl" part="lemq"/>
                </lu>
              </chunk>
            </out>
          </when>
          <otherwise>
            <choose>
              <when>
                <test>
                  <or>
                    <equal>
                      <clip pos="1" side="sl" part="a_det"/>
                      <lit-tag v="det.dem"/>
                    </equal>
                    <equal>
                      <clip pos="1" side="sl" part="a_det"/>
                      <lit-tag v="det.ind"/>
                    </equal>
                  </or>
                </test>
		<call-macro n="mod-gen">
		  <with-param pos="1"/>
		</call-macro>
                <out>
                  <chunk name="det_adj_nom" case="caseFirstWord">
                    <tags>
                      <tag><lit-tag v="SN"/></tag>
		      <tag><var n="caso"/></tag>
                    </tags>
                    <lu>
                      <clip pos="1" side="tl" part="lem"/>
                      <clip pos="1" side="tl" part="a_det"/>
                      <clip pos="1" side="tl" part="gen"/>
                      <clip pos="1" side="tl" part="nbr"/>
                      <lit-tag v="2"/>
                    </lu>
                    <b pos="1"/>
		    <lu>
              	      <clip pos="2" side="tl" part="lemh"/>
              	      <clip pos="2" side="tl" part="a_adj"/>
                      <clip pos="2" side="tl" part="gen"/>
                      <clip pos="2" side="tl" part="nbr"/>
	              <lit-tag v="nom.ind"/>
                      <clip pos="2" side="tl" part="lemq"/>
                    </lu>
		    <b pos="2"/>
                    <lu>
                      <clip pos="3" side="tl" part="lemh"/>
                      <clip pos="3" side="tl" part="a_nom"/>
                      <clip pos="3" side="tl" part="gen"/>
                      <clip pos="3" side="tl" part="nbr"/>
                      <lit-tag v="nom.ind"/>
                      <clip pos="3" side="tl" part="lemq"/>
                    </lu>

                  </chunk>
                </out>
              </when>
              <otherwise>
	    <!-- ESTA PARTE NO FUNCIONA -->
	    <choose>
              <when>
                <test>
                    <equal>
                      <clip pos="1" side="sl" part="a_det"/>
                      <lit-tag v="det.pos"/>
                    </equal>
                </test>
		<call-macro n="mod-gen">
		  <with-param pos="1"/>
		</call-macro>
                <out>
                  <chunk name="nom_adj_adj" case="caseFirstWord">
                    <tags>
                      <tag><lit-tag v="SN"/></tag>
                    </tags>
                    <lu>
                      <clip pos="2" side="tl" part="lemh"/>
                      <clip pos="2" side="tl" part="a_nom"/>
                      <clip pos="2" side="tl" part="gen"/>
                      <clip pos="2" side="tl" part="nbr"/>
                      <lit-tag v="nom.ind"/>
                      <clip pos="2" side="tl" part="lemq"/>
                    </lu>
                    <b pos="1"/>
                    <lu>
                      <clip pos="1" side="tl" part="lem"/>
                      <lit-tag v="adj.pos"/>
                      <clip pos="1" side="tl" part="gen"/>
                      <clip pos="1" side="tl" part="nbr"/>
		      <lit-tag v="nom.ind"/>	
                    </lu>		    
		    <b pos="2"/>
		    <lu>
              	      <clip pos="3" side="tl" part="lemh"/>
              	      <clip pos="3" side="tl" part="a_adj"/>
                      <clip pos="3" side="tl" part="gen"/>
                      <clip pos="3" side="tl" part="nbr"/>
	              <lit-tag v="nom.ind"/>
                      <clip pos="3" side="tl" part="lemq"/>
                    </lu>
                  </chunk>
                </out>
              </when>
            </choose>
            </otherwise>
            </choose>
          </otherwise>
        </choose>
      </action>
    </rule>


<!--

    <rule comment="REGLA: DET ADJ NOM">
      <pattern>
        <pattern-item n="det"/>
        <pattern-item n="adjec"/>
        <pattern-item n="nom"/>
      </pattern>
      <action>
        <call-macro n="firstWord">
          <with-param pos="1"/>
        </call-macro>
        <call-macro n="f_concord3">
          <with-param pos="3"/>
          <with-param pos="2"/>
	  <with-param pos="1"/>
        </call-macro>
        <call-macro n="mod-gen">
          <with-param pos="1"/>
        </call-macro>
        <call-macro n="mod-gen">
          <with-param pos="2"/>
        </call-macro>


        <out>
          <chunk name="nomdef_det_adj" case="caseFirstWord">
            <tags>
              <tag><lit-tag v="SN"/></tag>
              <tag><var n="caso"/></tag>
            </tags>
            <lu>
              <clip pos="3" side="tl" part="lemh"/>
              <clip pos="3" side="tl" part="a_nom"/>
              <clip pos="3" side="tl" part="gen"/>
              <clip pos="3" side="tl" part="nbr"/>
              <lit-tag v="2.def"/>
              <clip pos="3" side="tl" part="lemq"/>
            </lu>
            <b pos="1"/>
	    <lu>
	     <clip pos="1" side="tl" part="lem"/>
	     <clip pos="1" side="tl" part="a_det"/>
  	     <clip pos="1" side="tl" part="gen"/>  
             <clip pos="1" side="tl" part="nbr"/>
             <lit-tag v="nom"/>  	
	    </lu>
	   <b pos="2"/>
            <lu>
              <clip pos="2" side="tl" part="lemh"/>
              <clip pos="2" side="tl" part="a_adj"/>
              <clip pos="2" side="tl" part="gen"/>
              <clip pos="2" side="tl" part="nbr"/>
              <lit-tag v="nom.ind"/>
              <clip pos="2" side="tl" part="lemq"/>
            </lu>
          </chunk>
        </out>
      </action>
    </rule>
-->

    <rule comment="REGLA: DET ADJ">
      <pattern>
        <pattern-item n="det"/>
        <pattern-item n="adjec"/>
      </pattern>
      <action>
        <call-macro n="firstWord">
          <with-param pos="1"/>
        </call-macro>
        <call-macro n="f_concord2">
          <with-param pos="2"/>
	  <with-param pos="1"/>
        </call-macro>
        <call-macro n="mod-gen">
          <with-param pos="1"/>
        </call-macro>
        <call-macro n="mod-gen">
          <with-param pos="2"/>
        </call-macro>

        <out>
          <chunk name="det_adj" case="caseFirstWord">
            <tags>
              <tag><lit-tag v="SA"/></tag>              
	      <tag><var n="caso"/></tag>
            </tags>
           <lu>
             <clip pos="1" side="tl" part="lem"/>  
             <clip pos="1" side="tl" part="a_det"/>
             <clip pos="1" side="tl" part="gen"/>
             <clip pos="1" side="tl" part="nbr"/>
             <lit-tag v="2"/>
            </lu>
           <b pos="1"/>
            <lu>
              <clip pos="2" side="tl" part="lemh"/>
              <clip pos="2" side="tl" part="a_adj"/>
              <clip pos="2" side="tl" part="gen"/>
              <clip pos="2" side="tl" part="nbr"/>
	      <lit-tag v="nom.ind"/>
              <clip pos="2" side="tl" part="lemq"/>
            </lu>
          </chunk>
        </out>
      </action>
    </rule>


    <rule comment="REGLA: DET (quan no acompanya res o va amb desconeguda)">
      <pattern>
        <pattern-item n="det"/>
      </pattern>
      <action>
        <call-macro n="firstWord">
          <with-param pos="1"/>
        </call-macro>
	<call-macro n="f_concord1">
          <with-param pos="1"/>
        </call-macro>
          <call-macro n="mod-gen">
            <with-param pos="1"/>
          </call-macro>
	<choose>
	  <when>
	    <test>
		<equal>
		    <clip pos="1" side="sl" part="a_det"/>
                    <lit-tag v="det.pos"/>
	        </equal>
	    </test>
        <out>
          <chunk name="adj" case="caseFirstWord">
            <tags> 
              <tag>
                <lit-tag v="SA"/>
              </tag>
            </tags>
            <lu>
              <clip pos="1" side="tl" part="lem"/>  
              <lit-tag v="adj.pos"/>
              <clip pos="1" side="tl" part="gen"/>
              <clip pos="1" side="tl" part="nbr"/>
	      <lit-tag v="nom.ind"/>
            </lu> 
          </chunk>
        </out>
       </when>
       <when>
	    <test>
		<equal>
		    <clip pos="1" side="sl" part="lem"/>
                    <lit v="todo"/>
	        </equal>
	    </test>
        <out>
          <chunk name="predet" case="caseFirstWord">
            <tags>
              <tag><lit-tag v="DET"/></tag>
              <tag><var n="caso"/></tag>
            </tags>
            <lu>
	      <lit v="tuturor"/>
              <lit-tag v="predet.def.mf.sp.2"/>
            </lu>
          </chunk>

        </out>
       </when>

	<otherwise>
        <out>
          <chunk name="det" case="caseFirstWord">
            <tags>
              <tag>
                <lit-tag v="DET"/>
              </tag>
            </tags>
            <lu>
              <clip pos="1" side="tl" part="lem"/>
              <clip pos="1" side="tl" part="a_det"/>
              <clip pos="1" side="tl" part="gen"/>
              <clip pos="1" side="tl" part="nbr"/>
              <lit-tag v="nom"/>
            </lu>
          </chunk>
        </out>
      </otherwise>
    </choose>
      </action>
    </rule>

<!-- *************************************** REGLES DE SV *********************************************** -->
    <rule comment="REGLA: VERBser">
      <pattern>
        <pattern-item n="ser"/>
      </pattern>
      <action>
        <call-macro n="firstWord">
          <with-param pos="1"/>
        </call-macro>
        <call-macro n="conj_verb1">
          <with-param pos="1"/>
        </call-macro>
        <out>
          <chunk name="verb_ser" case="caseFirstWord">
            <tags>
              <tag>
                <lit-tag v="SV"/>
              </tag>
              <tag>
                <clip pos="1" side="tl" part="a_verb"/>
              </tag>
              <tag>
                <clip pos="1" side="tl" part="temps"/>
              </tag>
              <tag>
                <clip pos="1" side="tl" part="pers"/>
              </tag>
              <tag>
                <clip pos="1" side="tl" part="nbr"/>
              </tag>
            </tags>
            <lu>
	      <var n="verbfinal"/>
            </lu>
          </chunk>
        </out>
      </action>
    </rule>

    <rule comment="REGLA: VERB">
      <pattern>
        <pattern-item n="verbpers"/>
      </pattern>
      <action>
        <call-macro n="firstWord">
          <with-param pos="1"/>
        </call-macro>
        <call-macro n="conj_verb1">
          <with-param pos="1"/>
        </call-macro>
        <call-macro n="set-case-prep1">
          <with-param pos="1"/>
        </call-macro>
        <out>
          <chunk namefrom="lema_SV" case="caseFirstWord">
            <tags>
              <tag><lit-tag v="SV"/></tag>
              <tag><clip pos="1" side="tl" part="a_verb"/></tag>
              <tag><var n="temps_chunk"/></tag>
              <tag><clip pos="1" side="tl" part="pers"/></tag>
              <tag><clip pos="1" side="tl" part="nbr"/></tag>
            </tags>
            <lu>
              <var n="verbfinal"/>
            </lu>
          </chunk>

        </out>
      </action>
    </rule>

    <rule comment="REGLA: verbpers a">
      <pattern>
        <pattern-item n="verbpers"/>
        <pattern-item n="a"/>
      </pattern>
      <action>
        <call-macro n="firstWord">
          <with-param pos="1"/>
        </call-macro>
        <call-macro n="conj_verb1">
          <with-param pos="1"/>
        </call-macro>
        <call-macro n="set-case-prep1">
          <with-param pos="1"/>
        </call-macro>

	<choose>
	  <when>
	    <test>
	      <not>
                <equal>
                  <var n="caso"/>
                  <lit-tag v="dg"/>
                </equal>
	      </not>
            </test>
            <out>
              <chunk namefrom="lema_SV" case="caseFirstWord">
                <tags>
                  <tag><lit-tag v="SV"/></tag>
                  <tag><clip pos="1" side="tl" part="a_verb"/></tag>
                  <tag><var n="temps_chunk"/></tag>
                  <tag><clip pos="1" side="tl" part="pers"/></tag>
                  <tag><clip pos="1" side="tl" part="nbr"/></tag>
                </tags>
                <lu>
                  <var n="verbfinal"/>
                </lu>
                <b pos="1"/>
                <lu>
                  <var n="prepfinal"/>
                </lu>
              </chunk>
            </out>
	 </when>
	 <otherwise>
            <out>
              <chunk namefrom="lema_SV" case="caseFirstWord">
                <tags>
                  <tag><lit-tag v="SV"/></tag>
                  <tag><clip pos="1" side="tl" part="a_verb"/></tag>
                  <tag><var n="temps_chunk"/></tag>
                  <tag><clip pos="1" side="tl" part="pers"/></tag>
                  <tag><clip pos="1" side="tl" part="nbr"/></tag>
                </tags>
                <lu>
                  <var n="verbfinal"/>
                </lu>
              </chunk>
            </out>
          </otherwise>
        </choose>
      </action>
    </rule>

    <rule comment="REGLA: haber PP">
      <pattern>
        <pattern-item n="haver"/>
        <pattern-item n="pp"/>
      </pattern>
      <action>
        <call-macro n="firstWord">
          <with-param pos="1"/>
        </call-macro>
        <call-macro n="conj_verb2">
          <with-param pos="1"/>
          <with-param pos="2"/>
        </call-macro>
        <out>
          <chunk namefrom="lema_SV" case="caseFirstWord">
            <tags>
              <tag><lit-tag v="SV"/></tag>
              <tag><clip pos="2" side="tl" part="a_verb"/></tag>
              <tag><var n="temps_chunk"/></tag>
              <tag><clip pos="1" side="tl" part="pers"/></tag>
              <tag><clip pos="1" side="tl" part="nbr"/></tag>
            </tags>
            <lu>
              <var n="verbfinal"/>
            </lu>
          </chunk>
        </out>
      </action>
    </rule>


    <rule comment="REGLA: ir a INF">
      <pattern>
        <pattern-item n="irpres"/>
        <pattern-item n="a"/>
        <pattern-item n="inf"/>
      </pattern>
      <action>
	<let> <!--fran: això és bastant lleig però no m'ocurre cap altra manera-->
	  <clip pos="3" side="sl" part="whole"/>
	  <concat>
            <clip pos="3" side="sl" part="lemh"/>
            <clip pos="1" side="sl" part="a_verb"/>
	    <lit-tag v="fti"/>
            <clip pos="1" side="sl" part="pers"/>
            <clip pos="1" side="sl" part="nbr"/>
            <clip pos="3" side="sl" part="lemq"/>
	  </concat>
	</let>
        <call-macro n="firstWord">
          <with-param pos="1"/>
        </call-macro>
	<call-macro n="conj_verb1">
          <with-param pos="3"/>
	</call-macro>
        <out>
          <chunk namefrom="lema_SV" case="caseFirstWord">
            <tags>
              <tag><lit-tag v="SV"/></tag>
              <tag><clip pos="3" side="tl" part="a_verb"/></tag>
              <tag><var n="temps_chunk"/></tag>
              <tag><clip pos="1" side="tl" part="pers"/></tag>
              <tag><clip pos="1" side="tl" part="nbr"/></tag>
            </tags>
            <lu>
              <var n="verbfinal"/>
            </lu>
          </chunk>
        </out>
      </action>
    </rule>


    <rule comment="REGLA: ir a INF prnenc">
      <pattern>
        <pattern-item n="irpres"/>
        <pattern-item n="a"/>
        <pattern-item n="inf"/>
        <pattern-item n="prnenc"/>
      </pattern>
      <action>
	<let> <!--fran: això és bastant lleig però no m'ocurre cap altra manera-->
	  <clip pos="3" side="sl" part="whole"/>
	  <concat>
            <clip pos="3" side="sl" part="lemh"/>
            <clip pos="1" side="sl" part="a_verb"/>
	    <lit-tag v="fti"/>
            <clip pos="1" side="sl" part="pers"/>
            <clip pos="1" side="sl" part="nbr"/>
            <clip pos="3" side="sl" part="lemq"/>
	  </concat>
	</let>
        <call-macro n="firstWord">
          <with-param pos="1"/>
        </call-macro>
	<call-macro n="conj_verb1">
          <with-param pos="3"/>
	</call-macro>
	<call-macro n="mod-gen">
          <with-param pos="4"/>
	</call-macro>
        <out>
          <chunk namefrom="lema_SV" case="caseFirstWord">
            <tags>
              <tag><lit-tag v="SV"/></tag>
              <tag><clip pos="3" side="tl" part="a_verb"/></tag>
              <tag><var n="temps_chunk"/></tag>
              <tag><clip pos="1" side="tl" part="pers"/></tag>
              <tag><clip pos="1" side="tl" part="nbr"/></tag>
            </tags>
              <lu>
                <clip pos="4" side="tl" part="lemh"/>
		<clip pos="4" side="tl" part="a_prn"/>
		<lit-tag v="pro"/>
                <clip pos="4" side="tl" part="pers"/>
                <clip pos="4" side="tl" part="gen"/>
                <clip pos="4" side="tl" part="nbr"/>
	        <lit-tag v="nom"/>
                <clip pos="4" side="tl" part="lemq"/>
              </lu>
	    <b pos="1"/>
            <lu>
              <var n="verbfinal"/>
            </lu>
          </chunk>
        </out>
      </action>
    </rule>


    <rule comment="REGLA: ir a INF prnenc prnenc">
      <pattern>
        <pattern-item n="irpres"/>
        <pattern-item n="a"/>
        <pattern-item n="inf"/>
        <pattern-item n="prnenc"/>
        <pattern-item n="prnenc"/>
      </pattern>
      <action>
	<let> <!--fran: això és bastant lleig però no m'ocurre cap altra manera-->
	  <clip pos="3" side="sl" part="whole"/>
	  <concat>
            <clip pos="3" side="sl" part="lemh"/>
            <clip pos="1" side="sl" part="a_verb"/>
	    <lit-tag v="fti"/>
            <clip pos="1" side="sl" part="pers"/>
            <clip pos="1" side="sl" part="nbr"/>
            <clip pos="3" side="sl" part="lemq"/>
	  </concat>
	</let>

        <call-macro n="firstWord">
          <with-param pos="1"/>
        </call-macro>
	<call-macro n="conj_verb1">
          <with-param pos="3"/>
	</call-macro>

	<choose>
	  <when>
            <test>
	      <and>
                <equal>
	          <clip pos="4" side="tl" part="lem"/>
	          <lit v="îl"/>
	        </equal>
                <equal>
	          <clip pos="4" side="tl" part="gen"/>
	          <lit-tag v="mf"/>
	        </equal>
                <equal>
	          <clip pos="4" side="tl" part="nbr"/>
	          <lit-tag v="ND"/>
	        </equal>
              </and>
            </test>
	    <let>
              <clip pos="4" side="tl" part="nbr"/>
	      <lit-tag v="sg"/>
	    </let>
	    <let>
              <clip pos="4" side="tl" part="gen"/>
	      <lit-tag v="mn"/>
	    </let>
	  </when>
	</choose>

	<call-macro n="mod-gen">
          <with-param pos="5"/>
	</call-macro>

        <out>
          <chunk namefrom="lema_SV" case="caseFirstWord">
            <tags>
              <tag><lit-tag v="SV"/></tag>
              <tag><clip pos="3" side="tl" part="a_verb"/></tag>
              <tag><var n="temps_chunk"/></tag>
              <tag><clip pos="1" side="tl" part="pers"/></tag>
              <tag><clip pos="1" side="tl" part="nbr"/></tag>
            </tags>
              <lu>
                <clip pos="4" side="tl" part="lemh"/>
		<clip pos="4" side="tl" part="a_prn"/>
		<lit-tag v="pro"/>
                <clip pos="4" side="tl" part="pers"/>
                <clip pos="4" side="tl" part="gen"/>
                <clip pos="4" side="tl" part="nbr"/>
	        <lit-tag v="dg"/>
                <clip pos="4" side="tl" part="lemq"/>
              </lu>
	      <b pos="1"/>
              <lu>
                <clip pos="5" side="tl" part="lemh"/>
		<clip pos="5" side="tl" part="a_prn"/>
		<lit-tag v="pro"/>
                <clip pos="5" side="tl" part="pers"/>
                <clip pos="5" side="tl" part="gen"/>
                <clip pos="5" side="tl" part="nbr"/>
	        <lit-tag v="nom"/>
                <clip pos="5" side="tl" part="lemq"/>
              </lu>
	    <b pos="2"/>
            <lu>
              <var n="verbfinal"/>
            </lu>
          </chunk>
        </out>
      </action>
    </rule>



    <rule comment="REGLA: ger">
      <pattern>
        <pattern-item n="ger"/>
      </pattern>
      <action>
        <call-macro n="firstWord">
          <with-param pos="1"/>
        </call-macro>
        <out>
          <chunk name="ger" case="caseFirstWord">
            <tags>
              <tag><clip pos="1" side="tl" part="a_verb"/></tag>
              <tag><clip pos="1" side="tl" part="temps"/></tag>
            </tags>
            <lu>
              <clip pos="1" side="tl" part="lemh"/>
              <clip pos="1" side="tl" part="a_verb"/>
              <clip pos="1" side="tl" part="temps"/>
              <clip pos="1" side="tl" part="lemq"/>
            </lu>
          </chunk>
        </out>
        <let>
          <var n="caseFirstWord"/>
          <lit v="aa"/>
        </let>
      </action>
    </rule>

    <rule comment="REGLA: estar GER">
      <pattern>
        <pattern-item n="estar"/>
        <pattern-item n="ger"/>
      </pattern>
      <action>
	<let> <!--fran: això és bastant lleig però no m'ocurre cap altra manera-->
	  <clip pos="1" side="tl" part="whole"/>
	  <concat>
            <clip pos="2" side="tl" part="lemh"/>
            <clip pos="1" side="tl" part="a_verb"/>
            <clip pos="1" side="tl" part="temps"/>
            <clip pos="1" side="tl" part="pers"/>
            <clip pos="1" side="tl" part="nbr"/>
            <clip pos="2" side="tl" part="lemq"/>
	  </concat>
	</let>
        <call-macro n="firstWord">
          <with-param pos="1"/>
        </call-macro>
	<call-macro n="conj_verb1">
          <with-param pos="1"/>
	</call-macro>
        <out>
          <chunk namefrom="lema_SV" case="caseFirstWord">
            <tags>
              <tag><lit-tag v="SV"/></tag>
              <tag><clip pos="1" side="tl" part="a_verb"/></tag>
              <tag><var n="temps_chunk"/></tag>
              <tag><clip pos="1" side="tl" part="pers"/></tag>
              <tag><clip pos="1" side="tl" part="nbr"/></tag>
            </tags>
            <lu>
	      <var n="verbfinal"/>
            </lu>
          </chunk>
        </out>
        <let>
          <var n="caseFirstWord"/>
          <lit v="aa"/>
        </let>
      </action>
    </rule>

    <rule comment="REGLA: estar GER prnenc">
      <pattern>
        <pattern-item n="estar"/>
        <pattern-item n="ger"/>
        <pattern-item n="prnenc"/>
      </pattern>
      <action>
	<let> <!--fran: això és bastant lleig però no m'ocurre cap altra manera-->
	  <clip pos="1" side="tl" part="whole"/>
	  <concat>
            <clip pos="2" side="tl" part="lemh"/>
            <clip pos="1" side="tl" part="a_verb"/>
            <clip pos="1" side="tl" part="temps"/>
            <clip pos="1" side="tl" part="pers"/>
            <clip pos="1" side="tl" part="nbr"/>
            <clip pos="2" side="tl" part="lemq"/>
	  </concat>
	</let>
        <call-macro n="firstWord">
          <with-param pos="1"/>
        </call-macro>
	<call-macro n="conj_verb1">
          <with-param pos="1"/>
	</call-macro>
        <out>
          <chunk namefrom="lema_SV" case="caseFirstWord">
            <tags>
              <tag><lit-tag v="SV"/></tag>
              <tag><clip pos="1" side="tl" part="a_verb"/></tag>
              <tag><var n="temps_chunk"/></tag>
              <tag><clip pos="1" side="tl" part="pers"/></tag>
              <tag><clip pos="1" side="tl" part="nbr"/></tag>
            </tags>
            <lu>
              <clip pos="3" side="tl" part="lemh"/>
              <clip pos="3" side="tl" part="a_prn"/>
	      <lit-tag v="pro"/>
              <clip pos="3" side="tl" part="pers"/>
              <clip pos="3" side="tl" part="gen"/>
              <clip pos="3" side="tl" part="nbr"/>
              <lit-tag v="nom"/>
              <clip pos="3" side="tl" part="lemq"/>
            </lu>
	    <b pos="1"/>
            <lu>
	      <var n="verbfinal"/>
            </lu>
          </chunk>
        </out>
        <let>
          <var n="caseFirstWord"/>
          <lit v="aa"/>
        </let>
      </action>
    </rule>


    <rule comment="REGLA: ger prnenc">
      <pattern>
        <pattern-item n="ger"/>
        <pattern-item n="prnenc"/>
      </pattern>
      <action>
        <call-macro n="firstWord">
          <with-param pos="1"/>
        </call-macro>
	<!--
        <call-macro n="mod-gen">
          <with-param pos="2"/>
        </call-macro>
	-->
        <out>
          <chunk name="ger" case="caseFirstWord">
            <tags>
              <tag><clip pos="1" side="tl" part="a_verb"/></tag>
              <tag><clip pos="1" side="tl" part="temps"/></tag>
            </tags>
	    <mlu>
              <lu>
                <clip pos="1" side="tl" part="lemh"/>
                <clip pos="1" side="tl" part="a_verb"/>
                <clip pos="1" side="tl" part="temps"/>
                <clip pos="1" side="tl" part="lemq"/>
              </lu>
              <lu>
                <clip pos="2" side="tl" part="lemh"/>
		<clip pos="2" side="tl" part="a_prn"/>
		<clip pos="2" side="tl" part="tipus_prn"/>
                <clip pos="2" side="tl" part="pers"/>
                <clip pos="2" side="tl" part="gen"/>
                <clip pos="2" side="tl" part="nbr"/>
	        <lit-tag v="dg"/>
                <clip pos="2" side="tl" part="lemq"/>
              </lu>
	    </mlu>
          </chunk>
        </out>
        <let>
          <var n="caseFirstWord"/>
          <lit v="aa"/>
        </let>
      </action>
    </rule>


    <rule comment="REGLA: INF">
      <pattern>
        <pattern-item n="inf"/>
      </pattern>
      <action>
        <call-macro n="firstWord">
          <with-param pos="1"/>
        </call-macro>
        <out>
          <chunk name="inf" case="caseFirstWord">
            <tags>
              <tag><lit-tag v="SV"/></tag>
              <tag><clip pos="1" side="tl" part="a_verb"/></tag>
              <tag><clip pos="1" side="tl" part="temps"/></tag>
              <tag><lit-tag v="sg"/></tag>
            </tags>
	    <lu>
              <lit v="a"/>
              <lit-tag v="pr"/>
	    </lu>
	    <b/>
            <lu>
              <clip pos="1" side="tl" part="whole"/>
            </lu>
          </chunk>
        </out>
      </action>
    </rule>

    <rule comment="REGLA: que INF">
      <pattern>
        <pattern-item n="que"/>
        <pattern-item n="inf"/>
      </pattern>
      <action>
        <call-macro n="firstWord">
          <with-param pos="1"/>
        </call-macro>
	<let>
	  <clip pos="2" side="tl" part="whole"/>
	  <concat>
	    <clip pos="2" side="tl" part="lemh"/>
	    <clip pos="2" side="tl" part="a_verb"/>
	    <lit-tag v="pp"/>
	    <var n="genero"/>
	    <var n="numero"/>
	    <clip pos="2" side="tl" part="lemq"/>
	  </concat>
	</let>
	<call-macro n="mod-gen-pp">
          <with-param pos="2"/>
	</call-macro>
        <out>
          <chunk name="de" case="caseFirstWord">
            <tags>
              <tag><lit-tag v="PREP"/></tag>
            </tags>
            <lu>
	      <lit v="de"/>
	      <lit-tag v="pr"/>
            </lu>
          </chunk>
	  <b/>
          <chunk name="inf" case="caseFirstWord">
            <tags>
              <tag><lit-tag v="SV"/></tag>
              <tag><clip pos="2" side="tl" part="a_verb"/></tag>
              <tag><clip pos="2" side="tl" part="temps"/></tag>
              <tag><lit-tag v="sg"/></tag>
            </tags>
            <lu>
              <clip pos="2" side="tl" part="lemh"/>
              <clip pos="2" side="tl" part="a_verb"/>
              <clip pos="2" side="tl" part="temps"/>
              <var n="genero_pp"/>
              <var n="numero_pp"/>
              <clip pos="2" side="tl" part="lemq"/>
            </lu>
          </chunk>
        </out>
      </action>
    </rule>

    <rule comment="REGLA: de INF">
      <pattern>
        <pattern-item n="de"/>
        <pattern-item n="inf"/>
      </pattern>
      <action>
        <call-macro n="firstWord">
          <with-param pos="1"/>
        </call-macro>
	<let>
	  <clip pos="2" side="tl" part="whole"/>
	  <concat>
	    <clip pos="2" side="tl" part="lemh"/>
	    <clip pos="2" side="tl" part="a_verb"/>
	    <lit-tag v="pp"/>
	    <var n="genero"/>
	    <var n="numero"/>
	    <clip pos="2" side="tl" part="lemq"/>
	  </concat>
	</let>
	<call-macro n="mod-gen-pp">
          <with-param pos="2"/>
	</call-macro>
        <out>
          <chunk name="de" case="caseFirstWord">
            <tags>
              <tag><lit-tag v="PREP"/></tag>
            </tags>
            <lu>
              <clip pos="1" side="tl" part="whole"/>
            </lu>
          </chunk>
	  <b/>
          <chunk name="inf" case="caseFirstWord">
            <tags>
              <tag><lit-tag v="SV"/></tag>
              <tag><clip pos="2" side="tl" part="a_verb"/></tag>
              <tag><clip pos="2" side="tl" part="temps"/></tag>
              <tag><lit-tag v="sg"/></tag>
            </tags>
            <lu>
              <clip pos="2" side="tl" part="lemh"/>
              <clip pos="2" side="tl" part="a_verb"/>
              <clip pos="2" side="tl" part="temps"/>
              <var n="genero_pp"/>
              <var n="numero_pp"/>
              <clip pos="2" side="tl" part="lemq"/>
            </lu>
          </chunk>
        </out>
      </action>
    </rule>

    <rule comment="REGLA: verbpers INF">
      <pattern>
        <pattern-item n="verbpers"/>
        <pattern-item n="inf"/>
      </pattern>
      <action>
        <call-macro n="firstWord">
          <with-param pos="1"/>
        </call-macro>
	<call-macro n="conj_verb1">
          <with-param pos="1"/>
	</call-macro>
        <out>
          <chunk name="verbpers_să_verbpers" case="caseFirstWord">
            <tags>
              <tag><lit-tag v="SV"/></tag>
              <tag><clip pos="1" side="tl" part="a_verb"/></tag>
              <tag><clip pos="1" side="tl" part="temps"/></tag>
              <tag><clip pos="1" side="tl" part="pers"/></tag>
              <tag><clip pos="1" side="tl" part="nbr"/></tag>
            </tags>
            <lu>
	      <var n="verbfinal"/>
	    </lu>
	    <b pos="1"/>
	    <lu>
              <lit v="să"/>
	      <lit-tag v="cnjsub"/>
	    </lu>
	    <b/>
            <lu>
              <clip pos="2" side="tl" part="lemh"/>
              <clip pos="2" side="tl" part="a_verb"/>
	      <lit-tag v="prs"/>
              <clip pos="1" side="tl" part="pers"/>
              <clip pos="1" side="tl" part="nbr"/>
              <clip pos="2" side="tl" part="lemq"/>
            </lu>
          </chunk>
        </out>
      </action>
    </rule>

    <rule comment="REGLA: verbpers a INF">
      <pattern>
        <pattern-item n="verbpers"/>
        <pattern-item n="a"/>
        <pattern-item n="inf"/>
      </pattern>
      <action>
        <call-macro n="firstWord">
          <with-param pos="1"/>
        </call-macro>
	<call-macro n="conj_verb1">
          <with-param pos="1"/>
	</call-macro>
        <out>
          <chunk name="verbpers_să_verbpers" case="caseFirstWord">
            <tags>
              <tag><lit-tag v="SV"/></tag>
              <tag><clip pos="1" side="tl" part="a_verb"/></tag>
              <tag><clip pos="1" side="tl" part="temps"/></tag>
              <tag><clip pos="1" side="tl" part="pers"/></tag>
              <tag><clip pos="1" side="tl" part="nbr"/></tag>
            </tags>
            <lu>
	      <var n="verbfinal"/>
	    </lu>
	    <b pos="1"/>
	    <lu>
              <lit v="să"/>
	      <lit-tag v="cnjsub"/>
	    </lu>
	    <b/>
            <lu>
              <clip pos="3" side="tl" part="lemh"/>
              <clip pos="3" side="tl" part="a_verb"/>
	      <lit-tag v="prs"/>
              <clip pos="1" side="tl" part="pers"/>
              <clip pos="1" side="tl" part="nbr"/>
              <clip pos="3" side="tl" part="lemq"/>
            </lu>
          </chunk>
        </out>
      </action>
    </rule>


    <rule comment="REGLA: tener que INF">
      <pattern>
        <pattern-item n="tener"/>
        <pattern-item n="que"/>
        <pattern-item n="inf"/>
      </pattern>
      <action>
        <call-macro n="firstWord">
          <with-param pos="1"/>
        </call-macro>
	<choose>
          <when>
            <test>
	      <or>
                <equal>
                  <clip pos="1" side="tl" part="temps"/>
	          <lit-tag v="pii"/>
	        </equal>
                <equal>
                  <clip pos="1" side="tl" part="temps"/>
	          <lit-tag v="ifi"/>
	        </equal>
	      </or>
	    </test>
	    <let>
              <var n="verbfinal"/>
	      <concat>
                <lit v="avea"/>
		<lit-tag v="vbavea.pri"/>
		<clip pos="1" side="tl" part="pers"/>
		<clip pos="1" side="tl" part="nbr"/>
	        <lit v="$ ^"/>
	        <lit v="trebui"/>
	        <lit-tag v="vbmod.pp.mn.sg"/>
	      </concat>
	    </let>
	  </when>
          <when>
            <test>
                <equal>
                  <clip pos="1" side="tl" part="temps"/>
	          <lit-tag v="cni"/>
	        </equal>
	    </test>
	    <let>
              <var n="verbfinal"/>
	      <concat>
                <lit v="avea"/>
		<lit-tag v="vbavea.cni"/>
		<clip pos="1" side="tl" part="pers"/>
		<clip pos="1" side="tl" part="nbr"/>
	        <lit v="$ ^"/>
	        <lit v="trebui"/>
	        <lit-tag v="vbmod.pri.p3.sg"/>
	      </concat>
	    </let>
	  </when>
          <when>
            <test>
                <equal>
                  <clip pos="1" side="tl" part="temps"/>
	          <lit-tag v="fti"/>
	        </equal>
	    </test>
	    <let>
              <var n="verbfinal"/>
	      <concat>
                <lit v="vrea"/>
		<lit-tag v="vaux.pri"/>
		<clip pos="1" side="tl" part="pers"/>
		<clip pos="1" side="tl" part="nbr"/>
	        <lit v="$ ^"/>
	        <lit v="trebui"/>
	        <lit-tag v="vbmod.pri.p3.sg"/>
	      </concat>
	    </let>
	  </when>
          <otherwise>
	    <let>
              <var n="verbfinal"/>
	      <concat>
	        <lit v="trebui"/>
	        <lit-tag v="vbmod.pri.p3.sg"/>
	      </concat>
	    </let>
	  </otherwise>
	</choose>
        <out>
          <chunk name="trebui_să_verbpers" case="caseFirstWord">
            <tags>
              <tag><lit-tag v="SV"/></tag>
              <tag><clip pos="1" side="tl" part="a_verb"/></tag>
              <tag><clip pos="1" side="tl" part="temps"/></tag>
              <tag><clip pos="1" side="tl" part="pers"/></tag>
              <tag><clip pos="1" side="tl" part="nbr"/></tag>
            </tags>
            <lu>
	      <var n="verbfinal"/>
	    </lu>
	    <b pos="1"/>
	    <lu>
              <lit v="să"/>
	      <lit-tag v="cnjsub"/>
	    </lu>
	    <b pos="2"/>
            <lu>
              <clip pos="3" side="tl" part="lemh"/>
              <clip pos="3" side="tl" part="a_verb"/>
	      <lit-tag v="prs"/>
              <clip pos="1" side="tl" part="pers"/>
              <clip pos="1" side="tl" part="nbr"/>
              <clip pos="3" side="tl" part="lemq"/>
            </lu>
          </chunk>
        </out>
      </action>
    </rule>



    <rule comment="REGLA: verbpers que verbpers">
      <pattern>
        <pattern-item n="verbpers"/>
        <pattern-item n="que"/>
        <pattern-item n="verbpers"/>
      </pattern>
      <action>
        <call-macro n="firstWord">
          <with-param pos="1"/>
        </call-macro>
	<call-macro n="conj_verb1">
          <with-param pos="1"/>
	</call-macro>
        <out>
          <chunk name="verbpers_să_verbpers" case="caseFirstWord">
            <tags>
              <tag><lit-tag v="SV"/></tag>
              <tag><clip pos="1" side="tl" part="a_verb"/></tag>
              <tag><clip pos="1" side="tl" part="temps"/></tag>
              <tag><clip pos="1" side="tl" part="pers"/></tag>
              <tag><clip pos="1" side="tl" part="nbr"/></tag>
            </tags>
            <lu>
	      <var n="verbfinal"/>
	    </lu>
	    <b pos="1"/>
	    <lu>
              <lit v="să"/>
	      <lit-tag v="cnjsub"/>
	    </lu>
	    <b/>
            <lu>
              <clip pos="3" side="tl" part="lemh"/>
              <clip pos="3" side="tl" part="a_verb"/>
	      <lit-tag v="prs"/>
              <clip pos="3" side="tl" part="pers"/>
              <clip pos="3" side="tl" part="nbr"/>
              <clip pos="3" side="tl" part="lemq"/>
            </lu>
          </chunk>
        </out>
      </action>
    </rule>

    <!-- **************** AMB PRONOMS ************************* -->

    <rule comment="REGLA: IMP prnenc">
      <pattern>
        <pattern-item n="imp"/>
        <pattern-item n="prnenc"/>
      </pattern>
      <action>
        <call-macro n="firstWord">
          <with-param pos="1"/>
        </call-macro>
        <out>
          <chunk name="inf" case="caseFirstWord">
            <tags>
              <tag><lit-tag v="SV"/></tag>
              <tag><clip pos="1" side="tl" part="a_verb"/></tag>
              <tag><clip pos="1" side="tl" part="temps"/></tag>
              <tag><lit-tag v="sg"/></tag>
            </tags>
	    <mlu>
              <lu>
                <clip pos="1" side="tl" part="whole"/>
              </lu>
              <lu>
                <clip pos="2" side="tl" part="lemh"/>
		<clip pos="2" side="tl" part="a_prn"/>
		<clip pos="2" side="tl" part="tipus_prn"/>
                <clip pos="2" side="tl" part="pers"/>
                <clip pos="2" side="tl" part="gen"/>
                <clip pos="2" side="tl" part="nbr"/>
	        <lit-tag v="nom"/>
                <clip pos="2" side="tl" part="lemq"/>
              </lu>
	    </mlu>
          </chunk>
        </out>
      </action>
    </rule>


    <rule comment="REGLA: IMP prnenc prnenc">
      <pattern>
        <pattern-item n="imp"/>
        <pattern-item n="prnenc"/>
        <pattern-item n="prnenc"/>
      </pattern>
      <action>
        <call-macro n="firstWord">
          <with-param pos="1"/>
        </call-macro>
        <call-macro n="mod-gen">
          <with-param pos="3"/>
        </call-macro>
	<choose>
	  <when>
            <test>
	      <and>
                <equal>
	          <clip pos="2" side="tl" part="lem"/>
	          <lit v="îl"/>
	        </equal>
                <equal>
	          <clip pos="2" side="tl" part="gen"/>
	          <lit-tag v="mf"/>
	        </equal>
                <equal>
	          <clip pos="2" side="tl" part="nbr"/>
	          <lit-tag v="ND"/>
	        </equal>
              </and>
            </test>
	    <let>
              <clip pos="2" side="tl" part="nbr"/>
	      <lit-tag v="sg"/>
	    </let>
	    <let>
              <clip pos="2" side="tl" part="gen"/>
	      <lit-tag v="mfn"/>
	    </let>
	  </when>
	</choose>
        <out>
          <chunk name="inf" case="caseFirstWord">
            <tags>
              <tag><lit-tag v="SV"/></tag>
              <tag><clip pos="1" side="tl" part="a_verb"/></tag>
              <tag><clip pos="1" side="tl" part="temps"/></tag>
              <tag><lit-tag v="sg"/></tag>
            </tags>
	    <mlu>
              <lu>
                <clip pos="1" side="tl" part="whole"/>
              </lu>
              <lu>
                <clip pos="2" side="tl" part="lemh"/>
		<clip pos="2" side="tl" part="a_prn"/>
		<clip pos="2" side="tl" part="tipus_prn"/>
                <clip pos="2" side="tl" part="pers"/>
                <clip pos="2" side="tl" part="gen"/>
                <clip pos="2" side="tl" part="nbr"/>
	        <lit-tag v="dg"/>
                <clip pos="2" side="tl" part="lemq"/>
              </lu>
              <lu>
                <clip pos="3" side="tl" part="lemh"/>
		<clip pos="3" side="tl" part="a_prn"/>
		<clip pos="3" side="tl" part="tipus_prn"/>
                <clip pos="3" side="tl" part="pers"/>
                <clip pos="3" side="tl" part="gen"/>
                <clip pos="3" side="tl" part="nbr"/>
	        <lit-tag v="nom"/>
                <clip pos="3" side="tl" part="lemq"/>
              </lu>
	    </mlu>
          </chunk>
        </out>
      </action>
    </rule>



    <rule comment="REGLA: INF prnenc">
      <pattern>
        <pattern-item n="inf"/>
        <pattern-item n="prnenc"/>
      </pattern>
      <action>
        <call-macro n="firstWord">
          <with-param pos="1"/>
        </call-macro>
        <out>
          <chunk name="inf" case="caseFirstWord">
            <tags>
              <tag><lit-tag v="SV"/></tag>
              <tag><clip pos="1" side="tl" part="a_verb"/></tag>
              <tag><clip pos="1" side="tl" part="temps"/></tag>
              <tag><lit-tag v="sg"/></tag>
            </tags>
	    <lu>
              <lit v="a"/>
              <lit-tag v="pr"/>
	    </lu>
	    <b/>
            <lu>
              <clip pos="2" side="tl" part="lemh"/>
              <lit-tag v="prn.pro"/>
              <clip pos="2" side="tl" part="pers"/>
              <clip pos="2" side="tl" part="gen"/>
              <clip pos="2" side="tl" part="nbr"/>
	      <lit-tag v="dg"/>
              <clip pos="2" side="tl" part="lemq"/>
            </lu>
	    <b/>
            <lu>
              <clip pos="1" side="tl" part="whole"/>
            </lu>
          </chunk>
        </out>
      </action>
    </rule>

    <rule comment="REGLA: INF prnenc prnenc">
      <pattern>
        <pattern-item n="inf"/>
        <pattern-item n="prnenc"/>
        <pattern-item n="prnenc"/>
      </pattern>
      <action>
        <call-macro n="firstWord">
          <with-param pos="1"/>
        </call-macro>
        <out>
          <chunk name="inf" case="caseFirstWord">
            <tags>
              <tag><lit-tag v="SV"/></tag>
              <tag><clip pos="1" side="tl" part="a_verb"/></tag>
              <tag><clip pos="1" side="tl" part="temps"/></tag>
              <tag><lit-tag v="sg"/></tag>
            </tags>
	    <lu>
              <lit v="a"/>
              <lit-tag v="pr"/>
	    </lu>
	    <b pos="1"/>
            <lu>
              <clip pos="2" side="tl" part="lemh"/>
              <lit-tag v="prn.pro"/>
              <clip pos="2" side="tl" part="pers"/>
              <clip pos="2" side="tl" part="gen"/>
              <clip pos="2" side="tl" part="nbr"/>
	      <lit-tag v="dg"/>
              <clip pos="2" side="tl" part="lemq"/>
            </lu>
	    <b pos="2"/>
            <lu>
              <clip pos="3" side="tl" part="lemh"/>
              <lit-tag v="prn.pro"/>
              <clip pos="3" side="tl" part="pers"/>
              <clip pos="3" side="tl" part="gen"/>
              <clip pos="3" side="tl" part="nbr"/>
	      <lit-tag v="nom"/>
              <clip pos="3" side="tl" part="lemq"/>
            </lu>
	    <b/>

            <lu>
              <clip pos="1" side="tl" part="whole"/>
            </lu>
          </chunk>
        </out>
      </action>
    </rule>



    <rule comment="REGLA: verbpers INF prnenc">
      <pattern>
        <pattern-item n="verbpers"/>
        <pattern-item n="inf"/>
        <pattern-item n="prnenc"/>
      </pattern>
      <action>
        <call-macro n="firstWord">
          <with-param pos="1"/>
        </call-macro>
	<call-macro n="conj_verb1">
          <with-param pos="1"/>
	</call-macro>
	<call-macro n="mod-gen">
          <with-param pos="3"/>
	</call-macro>
        <out>
          <chunk name="verbpers_să_verbpers" case="caseFirstWord">
            <tags>
              <tag><lit-tag v="SV"/></tag>
              <tag><clip pos="1" side="tl" part="a_verb"/></tag>
              <tag><clip pos="1" side="tl" part="temps"/></tag>
              <tag><clip pos="1" side="tl" part="pers"/></tag>
              <tag><clip pos="1" side="tl" part="nbr"/></tag>
            </tags>
            <lu>
	      <var n="verbfinal"/>
	    </lu>
	    <b pos="1"/>
	    <lu>
              <lit v="să"/>
	      <lit-tag v="cnjsub"/>
	    </lu>
	    <b pos="2"/>
	    <lu>
                <clip pos="3" side="tl" part="lemh"/>
		<clip pos="3" side="tl" part="a_prn"/>
		<lit-tag v="pro"/>
                <clip pos="3" side="tl" part="pers"/>
                <clip pos="3" side="tl" part="gen"/>
                <clip pos="3" side="tl" part="nbr"/>
	        <lit-tag v="nom"/>
                <clip pos="3" side="tl" part="lemq"/>
	    </lu>
	    <b/>
            <lu>
              <clip pos="2" side="tl" part="lemh"/>
              <clip pos="2" side="tl" part="a_verb"/>
	      <lit-tag v="prs"/>
              <clip pos="1" side="tl" part="pers"/>
              <clip pos="1" side="tl" part="nbr"/>
              <clip pos="2" side="tl" part="lemq"/>
            </lu>
          </chunk>
        </out>
      </action>
    </rule>


    <rule comment="REGLA: prnpro prnpro verbpers">
      <pattern>
        <pattern-item n="prnpro"/>
        <pattern-item n="prnpro"/>
        <pattern-item n="verbpers"/>
      </pattern>
      <action>

        <call-macro n="firstWord">
          <with-param pos="1"/>
        </call-macro>
	<call-macro n="conj_verb1">
          <with-param pos="3"/>
	</call-macro>

	<choose>
	  <when>
            <test>
	      <and>
                <equal>
	          <clip pos="1" side="tl" part="lem"/>
	          <lit v="îl"/>
	        </equal>
                <equal>
	          <clip pos="1" side="tl" part="gen"/>
	          <lit-tag v="mf"/>
	        </equal>
                <equal>
	          <clip pos="1" side="tl" part="nbr"/>
	          <lit-tag v="ND"/>
	        </equal>
              </and>
            </test>
	    <let>
              <clip pos="1" side="tl" part="nbr"/>
	      <lit-tag v="sg"/>
	    </let>
	    <let>
              <clip pos="1" side="tl" part="gen"/>
	      <lit-tag v="mn"/>
	    </let>
	  </when>
	</choose>
        <out>
          <chunk name="pro_pro_verbpers" case="caseFirstWord">
            <tags>
              <tag><lit-tag v="SV"/></tag>
              <tag><clip pos="3" side="tl" part="a_verb"/></tag>
              <tag><clip pos="3" side="tl" part="temps"/></tag>
              <tag><clip pos="3" side="tl" part="pers"/></tag>
              <tag><clip pos="3" side="tl" part="nbr"/></tag>
            </tags>
	    <lu>
                <clip pos="1" side="tl" part="lemh"/>
		<clip pos="1" side="tl" part="a_prn"/>
		<clip pos="1" side="tl" part="tipus_prn"/>
                <clip pos="1" side="tl" part="pers"/>
                <clip pos="1" side="tl" part="gen"/>
                <clip pos="1" side="tl" part="nbr"/>
	        <lit-tag v="dg"/>
                <clip pos="1" side="tl" part="lemq"/>
	    </lu>
	    <b pos="1"/>
	    <lu>
                <clip pos="2" side="tl" part="lemh"/>
		<clip pos="2" side="tl" part="a_prn"/>
		<clip pos="2" side="tl" part="tipus_prn"/>
                <clip pos="2" side="tl" part="pers"/>
                <clip pos="2" side="tl" part="gen"/>
                <clip pos="2" side="tl" part="nbr"/>
	        <lit-tag v="nom"/>
                <clip pos="2" side="tl" part="lemq"/>
	    </lu>
	    <b pos="2"/>
            <lu>
	      <var n="verbfinal"/>
	    </lu>
          </chunk>
        </out>
      </action>
    </rule>


    <rule comment="REGLA: prnpro prnpro verbpers INF">
      <pattern>
        <pattern-item n="prnpro"/>
        <pattern-item n="prnpro"/>
        <pattern-item n="verbpers"/>
        <pattern-item n="inf"/>
      </pattern>
      <action>
        <call-macro n="firstWord">
          <with-param pos="1"/>
        </call-macro>
	<call-macro n="conj_verb1">
          <with-param pos="3"/>
	</call-macro>
	<choose>
	  <when>
            <test>
	      <and>
                <equal>
	          <clip pos="1" side="tl" part="lem"/>
	          <lit v="îl"/>
	        </equal>
                <equal>
	          <clip pos="1" side="tl" part="gen"/>
	          <lit-tag v="mf"/>
	        </equal>
                <equal>
	          <clip pos="1" side="tl" part="nbr"/>
	          <lit-tag v="ND"/>
	        </equal>
              </and>
            </test>
	    <let>
              <clip pos="1" side="tl" part="nbr"/>
	      <lit-tag v="sg"/>
	    </let>
	    <let>
              <clip pos="1" side="tl" part="gen"/>
	      <lit-tag v="mn"/>
	    </let>
	  </when>
	</choose>


        <out>
          <chunk name="verbpers_să_pro_pro_verbpers" case="caseFirstWord">
            <tags>
              <tag><lit-tag v="SV"/></tag>
              <tag><clip pos="3" side="tl" part="a_verb"/></tag>
              <tag><clip pos="3" side="tl" part="temps"/></tag>
              <tag><clip pos="3" side="tl" part="pers"/></tag>
              <tag><clip pos="3" side="tl" part="nbr"/></tag>
            </tags>
            <lu>
	      <var n="verbfinal"/>
	    </lu>
	    <b pos="1"/>
	    <lu>
              <lit v="să"/>
	      <lit-tag v="cnjsub"/>
	    </lu>
	    <b pos="2"/>
	    <lu>
                <clip pos="1" side="tl" part="lemh"/>
		<clip pos="1" side="tl" part="a_prn"/>
		<clip pos="1" side="tl" part="tipus_prn"/>
                <clip pos="1" side="tl" part="pers"/>
                <clip pos="1" side="tl" part="gen"/>
                <clip pos="1" side="tl" part="nbr"/>
	        <lit-tag v="dg"/>
                <clip pos="1" side="tl" part="lemq"/>
	    </lu>
	    <b pos="2"/>
	    <lu>
                <clip pos="2" side="tl" part="lemh"/>
		<clip pos="2" side="tl" part="a_prn"/>
		<clip pos="2" side="tl" part="tipus_prn"/>
                <clip pos="2" side="tl" part="pers"/>
                <clip pos="2" side="tl" part="gen"/>
                <clip pos="2" side="tl" part="nbr"/>
	        <lit-tag v="nom"/>
                <clip pos="2" side="tl" part="lemq"/>
	    </lu>
	    <b/>
            <lu>
              <clip pos="4" side="tl" part="lemh"/>
              <clip pos="4" side="tl" part="a_verb"/>
	      <lit-tag v="prs"/>
              <clip pos="3" side="tl" part="pers"/>
              <clip pos="3" side="tl" part="nbr"/>
              <clip pos="3" side="tl" part="lemq"/>
            </lu>
          </chunk>
        </out>
      </action>
    </rule>



    <rule comment="REGLA: verbpers INF prnenc prnenc">
      <pattern>
        <pattern-item n="verbpers"/>
        <pattern-item n="inf"/>
        <pattern-item n="prnenc"/>
        <pattern-item n="prnenc"/>
      </pattern>
      <action>

        <call-macro n="firstWord">
          <with-param pos="1"/>
        </call-macro>
	<call-macro n="conj_verb1">
          <with-param pos="1"/>
	</call-macro>
	<call-macro n="mod-gen">
          <with-param pos="4"/>
	</call-macro>

	<choose>
	  <when>
            <test>
	      <and>
                <equal>
	          <clip pos="3" side="tl" part="lem"/>
	          <lit v="îl"/>
	        </equal>
                <equal>
	          <clip pos="3" side="tl" part="gen"/>
	          <lit-tag v="mf"/>
	        </equal>
                <equal>
	          <clip pos="3" side="tl" part="nbr"/>
	          <lit-tag v="ND"/>
	        </equal>
              </and>
            </test>
	    <let>
              <clip pos="3" side="tl" part="nbr"/>
	      <lit-tag v="sg"/>
	    </let>
	    <let>
              <clip pos="3" side="tl" part="gen"/>
	      <lit-tag v="mn"/>
	    </let>
	  </when>
	</choose>

        <out>
          <chunk name="verbpers_să_pro_pro_verbpers" case="caseFirstWord">
            <tags>
              <tag><lit-tag v="SV"/></tag>
              <tag><clip pos="1" side="tl" part="a_verb"/></tag>
              <tag><clip pos="1" side="tl" part="temps"/></tag>
              <tag><clip pos="1" side="tl" part="pers"/></tag>
              <tag><clip pos="1" side="tl" part="nbr"/></tag>
            </tags>
            <lu>
	      <var n="verbfinal"/>
	    </lu>
	    <b pos="1"/>
	    <lu>
              <lit v="să"/>
	      <lit-tag v="cnjsub"/>
	    </lu>
	    <b pos="2"/>
	    <lu>
                <clip pos="3" side="tl" part="lemh"/>
		<clip pos="3" side="tl" part="a_prn"/>
		<lit-tag v="pro"/>
                <clip pos="3" side="tl" part="pers"/>
                <clip pos="3" side="tl" part="gen"/>
                <clip pos="3" side="tl" part="nbr"/>
	        <lit-tag v="dg"/>
                <clip pos="3" side="tl" part="lemq"/>
	    </lu>
	    <b pos="2"/>
	    <lu>
                <clip pos="4" side="tl" part="lemh"/>
		<clip pos="4" side="tl" part="a_prn"/>
		<lit-tag v="pro"/>
                <clip pos="4" side="tl" part="pers"/>
                <clip pos="4" side="tl" part="gen"/>
                <clip pos="4" side="tl" part="nbr"/>
	        <lit-tag v="nom"/>
                <clip pos="4" side="tl" part="lemq"/>
	    </lu>
	    <b/>
            <lu>
              <clip pos="2" side="tl" part="lemh"/>
              <clip pos="2" side="tl" part="a_verb"/>
	      <lit-tag v="prs"/>
              <clip pos="1" side="tl" part="pers"/>
              <clip pos="1" side="tl" part="nbr"/>
              <clip pos="2" side="tl" part="lemq"/>
            </lu>
          </chunk>
        </out>
      </action>
    </rule>



<!--************************************ ALTRES ************************************************ -->
    <rule comment="prnpro">
<!--per quan va seguit d'un verb desconegut-->
      <pattern>
        <pattern-item n="prnpro"/>
      </pattern>
      <action>
        <call-macro n="firstWord">
          <with-param pos="1"/>
        </call-macro>
        <call-macro n="f_concord1">
          <with-param pos="1"/>
        </call-macro>
        <out>
          <chunk name="pro" case="caseFirstWord">
            <tags>
              <tag><lit-tag v="prn.pro"/></tag>
	      <!--
              <tag><clip pos="1" side="tl" part="tipoenc_pro"/></tag>
	      -->
	      <tag><clip pos="1" side="tl" part="pers"/></tag>
	      <tag><clip pos="1" side="tl" part="gen"/></tag>
	      <tag><clip pos="1" side="tl" part="nbr"/></tag>
	      <tag><lit-tag v="nom"/></tag>
            </tags>
            <lu>
              <clip pos="1" side="tl" part="lem"/>
              <lit-tag v="prn.pro"/>
              <clip pos="1" side="tl" part="tipoenc_pro"/>
              <clip pos="1" side="tl" part="pers"/>
              <clip pos="1" side="tl" part="gen"/>
              <clip pos="1" side="tl" part="nbr"/>
	      <lit-tag v="6"/>
            </lu>
          </chunk>
        </out>
        <let>
          <var n="caseFirstWord"/>
          <lit v="aa"/>
        </let>
      </action>
    </rule>

    <rule comment="prnenc">
<!--per quan va seguit d'un verb desconegut-->
      <pattern>
        <pattern-item n="prnenc"/>
      </pattern>
      <action>
        <call-macro n="firstWord">
          <with-param pos="1"/>
        </call-macro>
        <out>
          <chunk name="enc" case="caseFirstWord">
            <tags>
              <tag><lit-tag v="prn.enc"/></tag>
	      <!--
              <tag><clip pos="1" side="tl" part="tipoenc_pro"/></tag>
	      -->
	      <tag><clip pos="1" side="tl" part="pers"/></tag>
	      <tag><clip pos="1" side="tl" part="gen"/></tag>
	      <tag><clip pos="1" side="tl" part="nbr"/></tag>
	      <tag><lit-tag v="nom"/></tag>
            </tags>
            <lu>
              <clip pos="1" side="tl" part="lem"/>
              <lit-tag v="prn.enc"/>
              <clip pos="1" side="tl" part="tipoenc_pro"/>
              <clip pos="1" side="tl" part="pers"/>
              <clip pos="1" side="tl" part="gen"/>
              <clip pos="1" side="tl" part="nbr"/>
	      <lit-tag v="6"/>
            </lu>
          </chunk>
        </out>
        <let>
          <var n="caseFirstWord"/>
          <lit v="aa"/>
        </let>
      </action>
    </rule>

    

    <rule comment="PRN personal que pot ser subjecte">
      <pattern>
        <pattern-item n="prnperssubj"/>
      </pattern>
      <action>
        <call-macro n="firstWord">
          <with-param pos="1"/>
        </call-macro>
        <out>
          <chunk name="prnpersubj" case="caseFirstWord">
            <tags>
             <tag><lit-tag v="SN"/></tag>
             <tag><var n="caso"/></tag>
            </tags>
            <lu>
              <clip pos="1" side="tl" part="lem"/>
              <clip pos="1" side="tl" part="a_prn"/>
              <clip pos="1" side="tl" part="tipus_prn"/>
              <clip pos="1" side="tl" part="pers"/>
              <clip pos="1" side="tl" part="gen"/>
              <clip pos="1" side="tl" part="nbr"/>
              <lit-tag v="2"/>
            </lu>
          </chunk>
        </out>
        <let>
          <var n="caseFirstWord"/>
          <lit v="aa"/>
        </let>
     </action>
    </rule>

    <rule comment="PRN no personal que pot ser subjecte">
      <pattern>
        <pattern-item n="prnsubj"/>
      </pattern>
      <action>
        <call-macro n="firstWord">
          <with-param pos="1"/>
        </call-macro>
        <out>
          <chunk name="prnsubj" case="caseFirstWord">
            <tags>
             <tag><lit-tag v="SN"/></tag>
             <tag><var n="caso"/></tag>
            </tags>
            <lu>
              <clip pos="1" side="tl" part="lem"/>
              <clip pos="1" side="tl" part="a_prn"/>
              <clip pos="1" side="tl" part="tipus_prn"/>
              <clip pos="1" side="tl" part="pers"/>
              <clip pos="1" side="tl" part="gen"/>
              <clip pos="1" side="tl" part="nbr"/>
              <lit-tag v="2"/>
            </lu>
          </chunk>
        </out>
        <let>
          <var n="caseFirstWord"/>
          <lit v="aa"/>
        </let>
      </action>
    </rule>

    <rule comment="PRNITG">
      <pattern>
        <pattern-item n="prnitg"/>
      </pattern>
      <action>
        <call-macro n="firstWord">
          <with-param pos="1"/>
        </call-macro>
        <out>
          <chunk name="prnpersubj" case="caseFirstWord">
            <tags>
             <tag><lit-tag v="SN"/></tag>
            </tags>
            <lu>
              <clip pos="1" side="tl" part="lem"/>
              <clip pos="1" side="tl" part="a_prn"/>
              <clip pos="1" side="tl" part="tipus_prn"/>
              <clip pos="1" side="tl" part="pers"/>
              <clip pos="1" side="tl" part="gen"/>
              <clip pos="1" side="tl" part="nbr"/>
            </lu>
          </chunk>
        </out>
        <let>
          <var n="caseFirstWord"/>
          <lit v="aa"/>
        </let>
      </action>
    </rule>

    <rule comment="PRNREL">
      <pattern>
        <pattern-item n="rel"/>
      </pattern>
      <action>
        <call-macro n="firstWord">
          <with-param pos="1"/>
        </call-macro>
	<call-macro n="mod-gen">
          <with-param pos="1"/>
        </call-macro>
	<choose>
	  <when>
	    <test>
	    <or>
              <equal>
              <clip pos="1" side="sl" part="lem"/>  
              <lit v="cuyo"/>
              </equal>
	      <equal>
              <clip pos="1" side="sl" part="lem"/>  
	      <lit v="al cual"/>
	      </equal>
	    </or>
            </test>	
	      <let>
		<var n="caso"/>
		<lit-tag v="dg"/>
	      </let>
	  </when>
	</choose>
	<choose>
	<when>
	  <test>
	    <not>
		<equal>
		  <clip pos="1" side="sl" part="a_rel"/>
		  <lit-tag v="rel.adv"/>	
		</equal>
	    </not>
	  </test>
        <out>
          <chunk name="rel" case="caseFirstWord">
            <tags>
              <tag><lit-tag v="SN"/></tag>
	      <tag><var n="caso"/></tag>
	    </tags>	
            <lu>
              <clip pos="1" side="tl" part="lem"/>
              <clip pos="1" side="tl" part="a_rel"/>
              <clip pos="1" side="tl" part="gen"/>
              <clip pos="1" side="tl" part="nbr"/>
	      <lit-tag v="2"/>
            </lu>
          </chunk>
        </out>
	</when>
	<otherwise>
        <out>
          <chunk name="rel" case="caseFirstWord">
            <tags>
              <tag><lit-tag v="ADV"/></tag>
	    </tags>	
            <lu>
              <clip pos="1" side="tl" part="lem"/>
              <clip pos="1" side="tl" part="a_rel"/>
              <clip pos="1" side="tl" part="gen"/>
              <clip pos="1" side="tl" part="nbr"/>
            </lu>
          </chunk>
        </out>
	</otherwise>
	</choose>
        <let>
          <var n="caseFirstWord"/>
          <lit v="aa"/>
        </let>
      </action>
    </rule>

    <rule comment="cnjcoo">
      <pattern>
        <pattern-item n="cnjcoo"/>
      </pattern>
      <action>
        <call-macro n="firstWord">
          <with-param pos="1"/>
        </call-macro>
        <out>
          <chunk name="cnjcoo" case="caseFirstWord">
            <tags>
              <tag>
                <clip pos="1" side="tl" part="tags"/>
              </tag>
            </tags>
            <lu>
              <clip pos="1" side="tl" part="whole"/>
            </lu>
          </chunk>
        </out>
      </action>
    </rule>

    <rule comment="CNJ">
      <pattern>
        <pattern-item n="cnj"/>
      </pattern>
      <action>
        <call-macro n="firstWord">
          <with-param pos="1"/>
        </call-macro>
        <out>
          <chunk name="cnj" case="caseFirstWord">
            <tags>
              <tag>
                <clip pos="1" side="tl" part="tags"/>
              </tag>
            </tags>
            <lu>
              <clip pos="1" side="tl" part="whole"/>
            </lu>
          </chunk>
        </out>
        <let>
          <var n="caseFirstWord"/>
          <lit v="aa"/>
        </let>
      </action>
    </rule>

    <rule comment="PREP">
      <pattern>
        <pattern-item n="prep"/>
      </pattern>
      <action>
        <call-macro n="firstWord">
          <with-param pos="1"/>
        </call-macro>
        <let>
          <var n="lema"/>
          <clip pos="1" side="tl" part="lem"/>
        </let>
        <out>
          <chunk namefrom="lema" case="caseFirstWord">
            <tags>
              <tag>
                <lit-tag v="PREP"/>
              </tag>
            </tags>
            <lu>
              <clip pos="1" side="tl" part="whole"/>
            </lu>
          </chunk>
        </out>
        <let>
          <var n="caseFirstWord"/>
          <lit v="aa"/>
        </let>
      </action>
    </rule>

    <rule comment="NUMERAL en cifra">
      <pattern>
        <pattern-item n="cifra"/>
      </pattern>
      <action>
        <out>
          <chunk name="cifra" case="caseFirstWord">
            <tags>
              <tag>
                <lit-tag v="SN"/>
              </tag>
              <tag>
                <lit-tag v="mf"/>
              </tag>
              <tag>
                <lit-tag v="sp"/>
              </tag>
            </tags>
            <lu>
              <clip pos="1" side="tl" part="lem"/>
              <clip pos="1" side="tl" part="a_num"/>
            </lu>
          </chunk>
        </out>
        <let>
          <var n="caseFirstWord"/>
          <lit v="aa"/>
        </let>
      </action>
    </rule>

<!--*************************************** REGLES DE SV ******************************************** -->


    <rule>
<!-- REGLA: reset variables-->
      <pattern>
        <pattern-item n="sent"/>
      </pattern>
      <action>
        <let>
          <var n="numero"/>
          <lit-tag v="sg"/>
        </let>
        <let>
          <var n="genero"/>
          <lit-tag v="m"/>
        </let>
        <choose>
          <when>
            <test>
              <not>
                <or>
                  <equal>
                    <clip pos="1" side="sl" part="lem"/>
                    <lit v=";"/>
                  </equal>
                  <equal>
                    <clip pos="1" side="sl" part="lem"/>
                    <lit v=":"/>
                  </equal>
                </or>
              </not>
            </test>
            <let>
              <var n="EOS"/>
              <lit v="true"/>
            </let>
          </when>
        </choose>
        <out>
          <chunk name="punt">
            <tags>
              <tag>
                <lit-tag v="sent"/>
              </tag>
            </tags>
            <lu>
              <clip pos="1" side="tl" part="whole"/>
            </lu>
          </chunk>
        </out>
      </action>
    </rule>


    <rule>
<!-- REGLA: elimina ? i !-->
      <pattern>
        <pattern-item n="lquest"/>
      </pattern>
      <action>
      </action>
    </rule>

  </section-rules>
</transfer>
